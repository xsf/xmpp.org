<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0045: Multi-User Chat</title><link rel="stylesheet" type="text/css" href="../xmpp.css" /><link href="../prettify.css" type="text/css" rel="stylesheet" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><script type="text/javascript" src="../prettify.js"></script><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0" /><meta name="DC.Title" content="Multi-User Chat" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Description" content="This specification defines an XMPP protocol extension for multi-user text chat, whereby multiple XMPP users can exchange messages in the context of a room or channel, similar to Internet Relay Chat (IRC). In addition to standard chatroom features such as room topics and invitations, the protocol defines a strong room control model, including the ability to kick and ban users, to name room moderators and administrators, to require membership or passwords in order to join the room, etc." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2012-02-08" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0045" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright &#xA9; 1999 - 2014 by the XMPP Standards Foundation (XSF)." /></head><body onload="prettyPrint()"><h1>XEP-0045: Multi-User Chat</h1><table><tr valign="top"><td><strong>Abstract:</strong></td><td>This specification defines an XMPP protocol extension for multi-user text chat, whereby multiple XMPP users can exchange messages in the context of a room or channel, similar to Internet Relay Chat (IRC). In addition to standard chatroom features such as room topics and invitations, the protocol defines a strong room control model, including the ability to kick and ban users, to name room moderators and administrators, to require membership or passwords in order to join the room, etc.</td></tr><tr valign="top"><td><strong>Author:</strong></td><td>Peter Saint-Andre</td></tr><tr valign="top"><td><strong>Copyright:</strong></td><td>© 1999 - 2015 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</td></tr><tr valign="top"><td><strong>Status:</strong></td><td>Draft</td></tr><tr valign="top"><td><strong>Type:</strong></td><td>Standards Track</td></tr><tr valign="top"><td><strong>Version:</strong></td><td>1.25</td></tr><tr valign="top"><td><strong>Last Updated:</strong></td><td>2012-02-08</td></tr></table><hr /><p style="color:green">NOTICE: The protocol defined herein is a <strong>Draft Standard</strong> of the XMPP Standards Foundation. Implementations are encouraged and the protocol is appropriate for deployment in production systems, but some changes to the protocol are possible before it becomes a Final Standard.</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#scope">Scope</a><br />3.  <a href="#reqs">Requirements</a><br />4.  <a href="#terms">Terminology</a><br />   
      4.1.  <a href="#terms-general">General Terms</a><br />   
      4.2.  <a href="#terms-rooms">Room Types</a><br />   
      4.3.  <a href="#terms-personae">Dramatis Personae</a><br />5.  <a href="#associations">Roles, Affiliations, and Privileges</a><br />   
      5.1.  <a href="#roles">Roles</a><br />      
      5.1.1.  <a href="#roles-priv">Privileges</a><br />      
      5.1.2.  <a href="#roles-default">Default Roles</a><br />      
      5.1.3.  <a href="#roles-change">Changing Roles</a><br />   
      5.2.  <a href="#affil">Affiliations</a><br />      
      5.2.1.  <a href="#affil-priv">Privileges</a><br />      
      5.2.2.  <a href="#affil-change">Changing Affiliations</a><br />6.  <a href="#entity">Entity Use Cases</a><br />   
      6.1.  <a href="#disco-service">Discovering a MUC Service</a><br />   
      6.2.  <a href="#disco-service-features">Discovering the Features Supported by a MUC Service</a><br />   
      6.3.  <a href="#disco-rooms">Discovering Rooms</a><br />   
      6.4.  <a href="#disco-roominfo">Querying for Room Information</a><br />   
      6.5.  <a href="#disco-roomitems">Querying for Room Items</a><br />   
      6.6.  <a href="#disco-occupant">Querying a Room Occupant</a><br />   
      6.7.  <a href="#disco-client">Discovering Client Support for MUC</a><br />7.  <a href="#user">Occupant Use Cases</a><br />   
      7.1.  <a href="#order">Order of Events</a><br />   
      7.2.  <a href="#enter">Entering a Room</a><br />      
      7.2.1.  <a href="#enter-gc">Groupchat 1.0 Protocol</a><br />      
      7.2.2.  <a href="#enter-muc">Basic MUC Protocol</a><br />      
      7.2.3.  <a href="#enter-pres">Presence Broadcast</a><br />      
      7.2.4.  <a href="#enter-nonanon">Non-Anonymous Rooms</a><br />      
      7.2.5.  <a href="#enter-semianon">Semi-Anonymous Rooms</a><br />      
      7.2.6.  <a href="#enter-pw">Password-Protected Rooms</a><br />      
      7.2.7.  <a href="#enter-members">Members-Only Rooms</a><br />      
      7.2.8.  <a href="#enter-banned">Banned Users</a><br />      
      7.2.9.  <a href="#enter-conflict">Nickname Conflict</a><br />      
      7.2.10.  <a href="#enter-maxusers">Max Users</a><br />      
      7.2.11.  <a href="#enter-locked">Locked Room</a><br />      
      7.2.12.  <a href="#enter-nonexistent">Nonexistent Room</a><br />      
      7.2.13.  <a href="#enter-logging">Room Logging</a><br />      
      7.2.14.  <a href="#enter-history">Discussion History</a><br />      
      7.2.15.  <a href="#enter-managehistory">Managing Discussion History</a><br />      
      7.2.16.  <a href="#enter-subject">Room Subject</a><br />      
      7.2.17.  <a href="#enter-live">Live Messages</a><br />      
      7.2.18.  <a href="#enter-errorcodes">Error Conditions</a><br />   
      7.3.  <a href="#subject-occupant">Occupant Modification of the Room Subject</a><br />   
      7.4.  <a href="#message">Sending a Message to All Occupants</a><br />   
      7.5.  <a href="#privatemessage">Sending a Private Message</a><br />   
      7.6.  <a href="#changenick">Changing Nickname</a><br />   
      7.7.  <a href="#changepres">Changing Availability Status</a><br />   
      7.8.  <a href="#invite">Inviting Another User to a Room</a><br />      
      7.8.1.  <a href="#invite-direct">Direct Invitation</a><br />      
      7.8.2.  <a href="#invite-mediated">Mediated Invitation</a><br />   
      7.9.  <a href="#continue">Converting a One-to-One Chat Into a Multi-User Conference</a><br />   
      7.10.  <a href="#register">Registering with a Room</a><br />   
      7.11.  <a href="#getmemberlist">Getting the Member List</a><br />   
      7.12.  <a href="#reservednick">Discovering Reserved Room Nickname</a><br />   
      7.13.  <a href="#requestvoice">Requesting Voice</a><br />   
      7.14.  <a href="#exit">Exiting a Room</a><br />8.  <a href="#moderator">Moderator Use Cases</a><br />   
      8.1.  <a href="#subject-mod">Modifying the Room Subject</a><br />   
      8.2.  <a href="#kick">Kicking an Occupant</a><br />   
      8.3.  <a href="#grantvoice">Granting Voice to a Visitor</a><br />   
      8.4.  <a href="#revokevoice">Revoking Voice from a Participant</a><br />   
      8.5.  <a href="#modifyvoice">Modifying the Voice List</a><br />   
      8.6.  <a href="#voiceapprove">Approving Voice Requests</a><br />9.  <a href="#admin">Admin Use Cases</a><br />   
      9.1.  <a href="#ban">Banning a User</a><br />   
      9.2.  <a href="#modifyban">Modifying the Ban List</a><br />   
      9.3.  <a href="#grantmember">Granting Membership</a><br />   
      9.4.  <a href="#revokemember">Revoking Membership</a><br />   
      9.5.  <a href="#modifymember">Modifying the Member List</a><br />   
      9.6.  <a href="#grantmod">Granting Moderator Status</a><br />   
      9.7.  <a href="#revokemod">Revoking Moderator Status</a><br />   
      9.8.  <a href="#modifymod">Modifying the Moderator List</a><br />   
      9.9.  <a href="#regapprove">Approving Registration Requests</a><br />10.  <a href="#owner">Owner Use Cases</a><br />   
      10.1.  <a href="#createroom">Creating a Room</a><br />      
      10.1.1.  <a href="#createroom-general">General Considerations</a><br />      
      10.1.2.  <a href="#createroom-instant">Creating an Instant Room</a><br />      
      10.1.3.  <a href="#createroom-reserved">Creating a Reserved Room</a><br />   
      10.2.  <a href="#roomconfig">Subsequent Room Configuration</a><br />      
      10.2.1.  <a href="#roomconfig-notify">Notification of Configuration Changes</a><br />   
      10.3.  <a href="#grantowner">Granting Owner Status</a><br />   
      10.4.  <a href="#revokeowner">Revoking Owner Status</a><br />   
      10.5.  <a href="#modifyowner">Modifying the Owner List</a><br />   
      10.6.  <a href="#grantadmin">Granting Admin Status</a><br />   
      10.7.  <a href="#revokeadmin">Revoking Admin Status</a><br />   
      10.8.  <a href="#modifyadmin">Modifying the Admin List</a><br />   
      10.9.  <a href="#destroyroom">Destroying a Room</a><br />11.  <a href="#statuscodes">Status Codes</a><br />12.  <a href="#i18n">Internationalization Considerations</a><br />13.  <a href="#security">Security Considerations</a><br />   
      13.1.  <a href="#security-auth">User Authentication and Authorization</a><br />   
      13.2.  <a href="#security-e2e">End-to-End Encryption</a><br />   
      13.3.  <a href="#security-privacy">Privacy</a><br />   
      13.4.  <a href="#security-leaks">Information Leaks</a><br />   
      13.5.  <a href="#security-anon">Anonymity</a><br />   
      13.6.  <a href="#security-dos">Denial of Service</a><br />   
      13.7.  <a href="#security-other">Other Considerations</a><br />14.  <a href="#iana">IANA Considerations</a><br />15.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      15.1.  <a href="#registrar-protocol">Protocol Namespaces</a><br />   
      15.2.  <a href="#registrar-discocat">Service Discovery Category/Type</a><br />   
      15.3.  <a href="#registrar-features">Service Discovery Features</a><br />   
      15.4.  <a href="#registrar-nodes">Well-Known Service Discovery Nodes</a><br />   
      15.5.  <a href="#registrar-formtype">Field Standardization</a><br />      
      15.5.1.  <a href="#registrar-formtype-register">muc#register FORM_TYPE</a><br />      
      15.5.2.  <a href="#registrar-formtype-request">muc#request FORM_TYPE</a><br />      
      15.5.3.  <a href="#registrar-formtype-owner">muc#roomconfig FORM_TYPE</a><br />      
      15.5.4.  <a href="#registrar-formtype-roominfo">muc#roominfo FORM_TYPE</a><br />   
      15.6.  <a href="#registrar-statuscodes">Status Codes Registry</a><br />      
      15.6.1.  <a href="#registrar-statuscodes-process">Process</a><br />      
      15.6.2.  <a href="#registrar-statuscodes-init">Initial Submission</a><br />   
      15.7.  <a href="#registrar-querytypes">URI Query Types</a><br />      
      15.7.1.  <a href="#registrar-querytypes-join">join</a><br />      
      15.7.2.  <a href="#registrar-querytypes-invite">invite</a><br />16.  <a href="#bizrules">Business Rules</a><br />   
      16.1.  <a href="#bizrules-jids">Addresses</a><br />   
      16.2.  <a href="#bizrules-message">Message</a><br />   
      16.3.  <a href="#bizrules-presence">Presence</a><br />   
      16.4.  <a href="#bizrules-iq">IQ</a><br />17.  <a href="#impl">Implementation Notes</a><br />   
      17.1.  <a href="#impl-service">Services</a><br />      
      17.1.1.  <a href="#impl-service-traffic">Allowable Traffic</a><br />      
      17.1.2.  <a href="#impl-service-ghosts">Ghost Users</a><br />   
      17.2.  <a href="#impl-client">Clients</a><br />      
      17.2.1.  <a href="#impl-client-irc">IRC Command Mapping</a><br />      
      17.2.2.  <a href="#impl-client-presence">Presence Subscriptions</a><br />18.  <a href="#schemas">XML Schemas</a><br />   
      18.1.  <a href="#schemas-muc">http://jabber.org/protocol/muc</a><br />   
      18.2.  <a href="#schemas-user">http://jabber.org/protocol/muc#user</a><br />   
      18.3.  <a href="#schemas-admin">http://jabber.org/protocol/muc#admin</a><br />   
      18.4.  <a href="#schemas-owner">http://jabber.org/protocol/muc#owner</a><br />19.  <a href="#ack">Acknowledgements</a></p><p><a href="#appendices">Appendices</a><br />    <a href="#appendix-docinfo">A: Document Information</a><br />    <a href="#appendix-authorinfo">B: Author Information</a><br />    <a href="#appendix-legal">C: Legal Notices</a><br />    <a href="#appendix-xmpp">D: Relation to XMPP</a><br />    <a href="#appendix-discuss">E: Discussion Venue</a><br />    <a href="#appendix-conformance">F: Requirements Conformance</a><br />    <a href="#appendix-notes">G: Notes</a><br />    <a href="#appendix-revs">H: Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <p>Traditionally, instant messaging is thought to consist of one-to-one chat rather than many-to-many chat, which is called variously "groupchat" or "text conferencing". Groupchat functionality is familiar from systems such as Internet Relay Chat (IRC) and the chatroom functionality offered by popular consumer IM services. The Jabber/XMPP community developed and implemented a basic groupchat protocol as long ago as 1999. That "groupchat 1.0" (GC) protocol provided a minimal feature set for chat rooms but was rather limited in scope. This specification (Multi-User Chat or MUC) builds on the older groupchat 1.0 protocol in a backwards-compatible manner but provides advanced features such as invitations, room moderation and administration, and specialized room types.</p>
<h2>2.
       <a name="scope" id="scope">Scope</a></h2>
  <p>This document addresses common requirements related to configuration of, participation in, and administration of individual text-based conference rooms. All of the requirements addressed herein apply at the level of the individual room and are "common" in the sense that they have been widely discussed within the Jabber/XMPP community or are familiar from existing text-based conference environments (e.g., Internet Relay Chat as defined in <span class="ref"><a href="http://tools.ietf.org/html/rfc1459">RFC 1459</a></span>  [<a href="#nt-idp1749456">1</a>] and its successors: <span class="ref"><a href="http://tools.ietf.org/html/rfc2810">RFC 2810</a></span>  [<a href="#nt-idp1751648">2</a>], <span class="ref"><a href="http://tools.ietf.org/html/rfc2811">RFC 2811</a></span>  [<a href="#nt-idp1753632">3</a>], <span class="ref"><a href="http://tools.ietf.org/html/rfc2812">RFC 2812</a></span>  [<a href="#nt-idp1754912">4</a>], <span class="ref"><a href="http://tools.ietf.org/html/rfc2813">RFC 2813</a></span>  [<a href="#nt-idp1757232">5</a>]).</p>
  <p>This document explicitly does <span class="em">not</span> address the following:</p>
  <ul>
    <li>Relationships between rooms (e.g., hierarchies of rooms)</li>
    <li>Management of multi-user chat services (e.g., managing permissions across an entire service or registering a global room nickname); such use cases are specified in <span class="ref"><a href="http://xmpp.org/extensions/xep-0133.html">Service Administration (XEP-0133)</a></span>  [<a href="#nt-idp1760880">6</a>]</li>
    <li>Moderation of individual messages</li>
    <li>Encryption of messages sent through a room</li>
    <li>Advanced features such as attaching files to a room, integrating whiteboards, and using MUC rooms as a way to manage the signalling for multi-user audio or video conferencing (see <span class="ref"><a href="http://xmpp.org/extensions/xep-0272.html">Multiparty Jingle (XEP-0272)</a></span>  [<a href="#nt-idp1764176">7</a>])</li>
    <li>Interaction between MUC deployments and foreign chat systems (e.g., gateways to IRC or to legacy IM systems)</li>
    <li>Mirroring or replication of rooms among multiple MUC deployments</li>
  </ul>
  <p>This limited scope is not meant to disparage such topics, which are of inherent interest; however, it is meant to focus the discussion in this document and to present a comprehensible protocol that can be implemented by client and service developers alike. Future specifications might address the topics mentioned above.</p>
<h2>3.
       <a name="reqs" id="reqs">Requirements</a></h2>
  <p>This document addresses the minimal functionality provided by Jabber-based multi-user chat services that existed in 2002 when development of MUC began. For the sake of backwards-compatibility, this document uses the original groupchat 1.0 protocol for this baseline functionality, with the result that:</p>
  <ul>
    <li>Each room is identified as a "room JID" &lt;room@service&gt; (e.g., &lt;jdev@conference.jabber.org&gt;), where "room" is the name of the room and "service" is the hostname at which the multi-user chat service is running.</li>
    <li>Each occupant in a room is identified as an "occupant JID" &lt;room@service/nick&gt;, where "nick" is the room nickname of the occupant as specified on entering the room or subsequently changed during the occupant's visit.</li>
    <li>A user enters a room (i.e., becomes an occupant) by sending directed presence to &lt;room@service/nick&gt;.</li>
    <li>An occupant can change his or her room nickname and availability status within the room by sending presence information to &lt;room@service/newnick&gt;.</li>
    <li>Messages sent within multi-user chat rooms are of a special type "groupchat" and are addressed to the room itself (room@service), then reflected to all occupants.</li>
    <li>An occupant exits a room by sending presence of type "unavailable" to its current &lt;room@service/nick&gt;.</li>
  </ul>
  <p>The additional features and functionality addressed in MUC include the following:</p>
  <ol start="1">
    <li>native conversation logging (no in-room bot required)</li>
    <li>enabling users to request membership in a room</li>
    <li>enabling occupants to view an occupant's full JID in a non-anonymous room</li>
    <li>enabling moderators to view an occupant's full JID in a semi-anonymous room</li>
    <li>allowing only moderators to change the room subject</li>
    <li>enabling moderators to kick participants and visitors from the room</li>
    <li>enabling moderators to grant and revoke voice (i.e., the privilege to speak) in a moderated room, and to manage the voice list</li>
    <li>enabling admins to grant and revoke moderator status, and to manage the moderator list</li>
    <li>enabling admins to ban users from the room, and to manage the ban list</li>
    <li>enabling admins to grant and revoke membership privileges, and to manage the member list for a members-only room</li>
    <li>enabling owners to configure various room parameters (e.g., limiting the number of occupants)</li>
    <li>enabling owners to specify other owners</li>
    <li>enabling owners to grant and revoke admin status, and to manage the admin list</li>
    <li>enabling owners to destroy the room</li>
  </ol>
  <p>In addition, this document provides protocol elements for supporting the following room types:</p>
  <ol start="1">
    <li>public vs. hidden</li>
    <li>persistent vs. temporary</li>
    <li>password-protected vs. unsecured</li>
    <li>members-only vs. open</li>
    <li>moderated vs. unmoderated</li>
    <li>non-anonymous vs. semi-anonymous</li>
  </ol>
  <p>The extensions needed to implement these requirements are qualified by the 'http://jabber.org/protocol/muc' namespace (and the #owner, #admin, and #user fragments on the main namespace URI).</p>
<h2>4.
       <a name="terms" id="terms">Terminology</a></h2>
  <div class="indent"><h3>4.1 <a name="terms-general" id="terms-general">General Terms</a></h3>
    <div class="indent"><dl>
      <di><dt><strong>Affiliation</strong></dt><dd>A long-lived association or connection with a room; the possible affiliations are "owner", "admin", "member", and "outcast" (naturally it is also possible to have no affiliation); affiliation is distinct from role. An affiliation lasts across a user's visits to a room.</dd></di>
      <di><dt><strong>Ban</strong></dt><dd>To remove a user from a room such that the user is not allowed to re-enter the room (until and unless the ban has been removed). A banned user has an affiliation of "outcast".</dd></di>
      <di><dt><strong>Bare JID</strong></dt><dd>The &lt;user@host&gt; by which a user is identified outside the context of any existing session or resource; contrast with Full JID and Occupant JID.</dd></di>
      <di><dt><strong>Full JID</strong></dt><dd>The &lt;user@host/resource&gt; by which an online user is identified outside the context of a room; contrast with Bare JID and Occupant JID.</dd></di>
      <di><dt><strong>GC</strong></dt><dd>The minimal "groupchat 1.0" protocol developed within the Jabber community in 1999; MUC is backwards-compatible with GC.</dd></di>
      <di><dt><strong>History</strong></dt><dd>A limited number of message stanzas sent to a new occupant to provide the context of current discussion.</dd></di>
      <di><dt><strong>Invitation</strong></dt><dd>A special message sent from one user to another asking the recipient to join a room; the invitation can be sent directly (see <span class="ref"><a href="http://xmpp.org/extensions/xep-0249.html">Direct MUC Invitations (XEP-0249)</a></span>  [<a href="#nt-idp1793712">8</a>]) or mediated through the room (as described under <a href="#invite">Inviting Another User to a Room</a>).</dd></di>
      <di><dt><strong>IRC</strong></dt><dd>Internet Relay Chat.</dd></di>
      <di><dt><strong>Kick</strong></dt><dd>To temporarily remove a participant or visitor from a room; the user is allowed to re-enter the room at any time. A kicked user has a role of "none".</dd></di>
      <di><dt><strong>Logging</strong></dt><dd>Storage of discussions that occur within a room for public retrieval outside the context of the room.</dd></di>
      <di><dt><strong>Member</strong></dt><dd>A user who is on the "whitelist" for a members-only room or who is registered with an open room. A member has an affiliation of "member".</dd></di>
      <di><dt><strong>Moderator</strong></dt><dd>A room role that is usually associated with room admins but that can be granted to non-admins; is allowed to kick users, grant and revoke voice, etc. A moderator has a role of "moderator".</dd></di>
      <di><dt><strong>MUC</strong></dt><dd>The multi-user chat protocol for text-based conferencing specified in this document.</dd></di>
      <di><dt><strong>Multi-Session Nick</strong></dt><dd>If allowed by the service, a user can associate more than one full JID with the same occupant JID (e.g., the user juliet@capulet.lit is allowed to log in simultaneously as the nick "JuliC" in the characters@chat.shakespeare.lit chatroom from both juliet@capulet.lit/balcony and juliet@capulet.lit/chamber). Multi-session nicks are not currently defined in this document.</dd></di>
      <di><dt><strong>Occupant</strong></dt><dd>Any user who is in a room (this is an "abstract class" and does not correspond to any specific role).</dd></di>
      <di><dt><strong>Occupant JID</strong></dt><dd>The &lt;room@service/nick&gt; by which an occupant is identified within the context of a room; contrast with Bare JID and Full JID.</dd></di>
      <di><dt><strong>Outcast</strong></dt><dd>A user who has been banned from a room. An outcast has an affiliation of "outcast".</dd></di>
      <di><dt><strong>Participant</strong></dt><dd>An occupant who does not have admin status; in a moderated room, a participant is further defined as having voice (in contrast to a visitor). A participant has a role of "participant".</dd></di>
      <di><dt><strong>Private Message</strong></dt><dd>A message sent from one occupant directly to another's occupant JID (not to the room itself for broadcasting to all occupants).</dd></di>
      <di><dt><strong>Role</strong></dt><dd>A temporary position or privilege level within a room, distinct from a user's long-lived affiliation with the room; the possible roles are "moderator", "participant", and "visitor" (it is also possible to have no defined role). A role lasts only for the duration of an occupant's visit to a room.</dd></di>
      <di><dt><strong>Room</strong></dt><dd>A virtual space that users figuratively enter in order to participate in real-time, text-based conferencing with other users.</dd></di>
      <di><dt><strong>Room Administrator</strong></dt><dd>A user empowered by the room owner to perform administrative functions such as banning users; however, a room administrator is not allowed to change the room configuration or to destroy the room. An admin has an affiliation of "admin".</dd></di>
      <di><dt><strong>Room ID</strong></dt><dd>The localpart of a Room JID, which might be opaque and thus lack meaning for human users (see under <a href="#bizrules">Business Rules</a> for syntax); contrast with Room Name.</dd></di>
      <di><dt><strong>Room JID</strong></dt><dd>The &lt;room@service&gt; address of a room.</dd></di>
      <di><dt><strong>Room Name</strong></dt><dd>A user-friendly, natural-language name for a room, configured by the room owner and presented in Service Discovery queries; contrast with Room ID.</dd></di>
      <di><dt><strong>Room Nickname</strong></dt><dd>The resourcepart of an Occupant JID (see <a href="#bizrules">Business Rules</a> for syntax); this is the "friendly name" by which an occupant is known in the room.</dd></di>
      <di><dt><strong>Room Owner</strong></dt><dd>The user who created the room or a user who has been designated by the room creator or owner as someone with owner status (if allowed); an owner is allowed to change the room configuration and destroy the room, in addition to all admin status. An owner has an affiliation of "owner".</dd></di>
      <di><dt><strong>Room Roster</strong></dt><dd>A client's representation of the occupants in a room.</dd></di>
      <di><dt><strong>Server</strong></dt><dd>An XMPP server that may or may not have associated with it a text-based conferencing service.</dd></di>
      <di><dt><strong>Service</strong></dt><dd>A host that offers text-based conferencing capabilities; often but not necessarily a sub-domain of an XMPP server (e.g., conference.jabber.org).</dd></di>
      <di><dt><strong>Subject</strong></dt><dd>A temporary discussion topic within a room.</dd></di>
      <di><dt><strong>Visit</strong></dt><dd>A user's "session" in a room, beginning when the user enters the room (i.e., becomes an occupant) and ending when the user exits the room.</dd></di>
      <di><dt><strong>Visitor</strong></dt><dd>In a moderated room, an occupant who does not have voice (in contrast to a participant). A visitor has a role of "visitor".</dd></di>
      <di><dt><strong>Voice</strong></dt><dd>In a moderated room, the privilege to send messages to all occupants.</dd></di>
    </dl></div>
  </div>

  <div class="indent"><h3>4.2 <a name="terms-rooms" id="terms-rooms">Room Types</a></h3>
    <div class="indent"><dl>
      <di><dt><strong>Hidden Room</strong></dt><dd>A room that cannot be found by any user through normal means such as searching and service discovery; antonym: Public Room.</dd></di>
      <di><dt><strong>Members-Only Room</strong></dt><dd>A room that a user cannot enter without being on the member list; antonym: Open Room.</dd></di>
      <di><dt><strong>Moderated Room</strong></dt><dd>A room in which only those with "voice" are allowed to send messages to all occupants; antonym: Unmoderated Room.</dd></di>
      <di><dt><strong>Non-Anonymous Room</strong></dt><dd>A room in which an occupant's full JID is exposed to all other occupants, although the occupant can request any desired room nickname; contrast with Semi-Anonymous Room.</dd></di>
      <di><dt><strong>Open Room</strong></dt><dd>A room that non-banned entities are allowed to enter without being on the member list; antonym: Members-Only Room.</dd></di>
      <di><dt><strong>Password-Protected Room</strong></dt><dd>A room that a user cannot enter without first providing the correct password; antonym: Unsecured Room.</dd></di>
      <di><dt><strong>Persistent Room</strong></dt><dd>A room that is not destroyed if the last occupant exits; antonym: Temporary Room.</dd></di>
      <di><dt><strong>Public Room</strong></dt><dd>A room that can be found by any user through normal means such as searching and service discovery; antonym: Hidden Room.</dd></di>
      <di><dt><strong>Semi-Anonymous Room</strong></dt><dd>A room in which an occupant's full JID can be discovered by room admins only; contrast with Non-Anonymous Room.</dd></di>
      <di><dt><strong>Temporary Room</strong></dt><dd>A room that is destroyed if the last occupant exits; antonym: Persistent Room.</dd></di>
      <di><dt><strong>Unmoderated Room</strong></dt><dd>A room in which any occupant is allowed to send messages to all occupants; antonym: Moderated Room.</dd></di>
      <di><dt><strong>Unsecured Room</strong></dt><dd>A room that anyone is allowed to enter without first providing the correct password; antonym: Password-Protected Room.</dd></di>
    </dl></div>
  </div>

  <div class="indent"><h3>4.3 <a name="terms-personae" id="terms-personae">Dramatis Personae</a></h3>
    <p>Most of the examples in this document use the scenario of the witches' meeting held in a dark cave at the beginning of Act IV, Scene I of Shakespeare's <span class="ref">Macbeth</span>, represented here as the "coven@chat.shakespeare.lit" chatroom. The characters are as follows:</p>
    <div class="indent"><p class="caption"><a name="table-1" id="table-1"></a>Table 1: Dramatis Personae</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th>Room Nickname</th>
        <th>Full JID</th>
        <th>Affiliation</th>
      </tr>
      <tr class="body">
        <td>firstwitch</td>
        <td>crone1@shakespeare.lit/desktop</td>
        <td>Owner</td>
      </tr>
      <tr class="body">
        <td>secondwitch</td>
        <td>wiccarocks@shakespeare.lit/laptop</td>
        <td>Admin</td>
      </tr>
      <tr class="body">
        <td>thirdwitch</td>
        <td>hag66@shakespeare.lit/pda</td>
        <td>None</td>
      </tr>
    </table></div>
  </div>

<h2>5.
       <a name="associations" id="associations">Roles, Affiliations, and Privileges</a></h2>
  <p>A user might be allowed to perform any number of actions in a room, from joining or sending a message to changing configuration options or destroying the room altogether. We call each permitted action a "privilege". There are two ways we might structure privileges:</p>
  <ol>
    <li><p>Define each privilege atomically and explicitly define each user's particular privileges; this is flexible but can be confusing to manage.</p></li>
    <li><p>Define bundles of privileges that are generally applicable and assign a user-friendly "shortcut" to each bundle (e.g., "moderator" or "admin").</p></li>
  </ol>
  <p>MUC takes the second approach.</p>
  <p>MUC also defines two different associations: long-lived affiliations and session-specific roles. These two association types are distinct from each other in MUC, since an affiliation lasts across visits, while a role lasts only for the duration of a visit. In addition, there is no one-to-one correspondence between roles and affiliations; for example, someone who is not affiliated with a room may be a (temporary) moderator, and a member may be a participant or a visitor in a moderated room. These concepts are explained more fully below.</p>
  <div class="indent"><h3>5.1 <a name="roles" id="roles">Roles</a></h3>
    <p>The following roles are defined:</p>
    <div class="indent"><p class="caption"><a name="table-2" id="table-2"></a>Table 2: Roles</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th>Name</th>
        <th>Support</th>
      </tr>
      <tr class="body">
        <td>Moderator</td>
        <td>REQUIRED</td>
      </tr>
      <tr class="body">
        <td>None</td>
        <td>N/A (the absence of a role)</td>
      </tr>
      <tr class="body">
        <td>Participant</td>
        <td>REQUIRED</td>
      </tr>
      <tr class="body">
        <td>Visitor</td>
        <td>RECOMMENDED</td>
      </tr>
    </table></div>
    <p>Roles are temporary in that they do not necessarily persist across a user's visits to the room and MAY change during the course of an occupant's visit to the room. An implementation MAY persist roles across visits and SHOULD do so for moderated rooms (since the distinction between visitor and participant is critical to the functioning of a moderated room).</p>
    <p>There is no one-to-one mapping between roles and affiliations (e.g., a member could be a participant or a visitor).</p>
    <p>A moderator is the most powerful role within the context of the room, and can to some extent manage other occupants' roles in the room. A participant has fewer privileges than a moderator, although he or she always has the right to speak. A visitor is a more restricted role within the context of a moderated room, since visitors are not allowed to send messages to all occupants (depending on room configuration, it is even possible that visitors' presence will not be broadcasted to the room).</p>
    <p>Roles are granted, revoked, and maintained based on the occupant's room nickname or full JID rather than bare JID. The privileges associated with these roles, as well as the actions that trigger changes in roles, are defined below.</p>
    <p>Information about roles MUST be sent in all presence stanzas generated or reflected by the room and thus sent to occupants (if the room is configured to broadcast presence for a given role).</p>
    <div class="indent"><h3>5.1.1 <a name="roles-priv" id="roles-priv">Privileges</a></h3>
      <p>For the most part, roles exist in a hierarchy. For instance, a participant can do anything a visitor can do, and a moderator can do anything a participant can do. Each role has all the privileges possessed by the next-lowest role, plus additional privileges; these privileges are specified in the following table as defaults (an implementation MAY provide configuration options that override these defaults).</p>
      <div class="indent"><p class="caption"><a name="table-3" id="table-3"></a>Table 3: Privileges Associated With Roles</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th>Privilege</th>
          <th>None</th>
          <th>Visitor</th>
          <th>Participant</th>
          <th>Moderator</th>
        </tr>
        <tr class="body">
          <td>Present in Room</td>
          <td>No</td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Receive Messages</td>
          <td>No</td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Receive Occupant Presence</td>
          <td>No</td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Broadcast Presence to All Occupants</td>
          <td>No</td>
          <td>Yes*</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Change Availability Status</td>
          <td>No</td>
          <td>Yes*</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Change Room Nickname</td>
          <td>No</td>
          <td>Yes*</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Send Private Messages</td>
          <td>No</td>
          <td>Yes*</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Invite Other Users</td>
          <td>No</td>
          <td>Yes*</td>
          <td>Yes*</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Send Messages to All</td>
          <td>No</td>
          <td>No**</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Modify Subject</td>
          <td>No</td>
          <td>No*</td>
          <td>Yes*</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Kick Participants and Visitors</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Grant Voice</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Revoke Voice</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>Yes***</td>
        </tr>
      </table></div>
      <p>* Default; configuration settings MAY modify this privilege.</p>
      <p>** An implementation MAY grant voice by default to visitors in unmoderated rooms.</p>
      <p>*** A moderator MUST NOT be able to revoke voice privileges from an admin or owner.</p>
    </div>

    <div class="indent"><h3>5.1.2 <a name="roles-default" id="roles-default">Default Roles</a></h3>
      <p>The following table summarizes the initial default roles that a service SHOULD set based on the user's affiliation (there is no role associated with the "outcast" affiliation, since such users are not allowed to enter the room).</p>
      <div class="indent"><p class="caption"><a name="table-4" id="table-4"></a>Table 4: Initial Role Based on Affiliation</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th>Room Type</th>
          <th>None</th>
          <th>Member</th>
          <th>Admin</th>
          <th>Owner</th>
        </tr>
        <tr class="body">
          <td>Moderated</td>
          <td>Visitor</td>
          <td>Participant</td>
          <td>Moderator</td>
          <td>Moderator</td>
        </tr>
        <tr class="body">
          <td>Unmoderated</td>
          <td>Participant</td>
          <td>Participant</td>
          <td>Moderator</td>
          <td>Moderator</td>
        </tr>
        <tr class="body">
          <td>Members-Only</td>
          <td>N/A *</td>
          <td>Participant</td>
          <td>Moderator</td>
          <td>Moderator</td>
        </tr>
        <tr class="body">
          <td>Open</td>
          <td>Participant</td>
          <td>Participant</td>
          <td>Moderator</td>
          <td>Moderator</td>
        </tr>
      </table></div>
      <p>* Entry is not permitted.</p>
    </div>

    <div class="indent"><h3>5.1.3 <a name="roles-change" id="roles-change">Changing Roles</a></h3>
      <p>The ways in which an occupant's role changes are well-defined. Sometimes the change results from the occupant's own action (e.g., entering or exiting the room), whereas sometimes the change results from an action taken by a moderator, admin, or owner. If an occupant's role changes, a MUC service implementation MUST change the occupant's role to reflect the change and communicate the change to all occupants (if the room is configured to broadcast presence from entities with a given role). Role changes and their triggering actions are specified in the following table.</p>
      <div class="indent"><p class="caption"><a name="table-5" id="table-5"></a>Table 5: Role State Chart</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th>&gt;</th>
          <th>None</th>
          <th>Visitor</th>
          <th>Participant</th>
          <th>Moderator</th>
        </tr>
        <tr class="body">
          <td>None</td>
          <td>--</td>
          <td>Enter moderated room</td>
          <td>Enter unmoderated room</td>
          <td>Admin or owner enters room</td>
        </tr>
        <tr class="body">
          <td>Visitor</td>
          <td>Exit room or be kicked by a moderator</td>
          <td>--</td>
          <td>Moderator grants voice</td>
          <td>Admin or owner grants moderator status</td>
        </tr>
        <tr class="body">
          <td>Participant</td>
          <td>Exit room or be kicked by a moderator</td>
          <td>Moderator revokes voice</td>
          <td>--</td>
          <td>Admin or owner grants moderator status</td>
        </tr>
        <tr class="body">
          <td>Moderator</td>
          <td>Exit room or be kicked by an admin or owner *</td>
          <td>Admin or owner changes role to visitor *</td>
          <td>Admin or owner changes role to participant or revokes moderator status *</td>
          <td>--</td>
        </tr>
      </table></div>
      <p>* A moderator SHOULD NOT be allowed to revoke moderation privileges from someone with a higher affiliation than themselves (i.e., an unaffiliated moderator SHOULD NOT be allowed to revoke moderation privileges from an admin or an owner, and an admin SHOULD NOT be allowed to revoke moderation privileges from an owner).</p>
      <p class="box">Note: Certain roles are typically implicit in certain affiliations. For example, an admin or owner is automatically a moderator, so if an occupant is granted an affiliation of admin then the occupant will by that fact be granted a role of moderator; similarly, when an occupant is granted an affiliation of member in a moderated room, the occupant automatically has a role of participant. However, the loss of the admin affiliation does not necessarily mean that the occupant no longer has a role of moderator (since a "mere" occupant can be a moderator). Therefore, the role that is gained when an occupant is granted a certain affiliation is stable, whereas the role that is lost when an occupant loses a certain affilitation is not hardcoded and is left up to the implementation.</p>
    </div>

  </div>

  <div class="indent"><h3>5.2 <a name="affil" id="affil">Affiliations</a></h3>
    <p>The following affiliations are defined:</p>
    <ol start="1">
      <li>Owner</li>
      <li>Admin</li>
      <li>Member</li>
      <li>Outcast</li>
      <li>None (the absence of an affiliation)</li>
    </ol>
    <p>Support for the owner affiliation is REQUIRED. Support for the admin, member, and outcast affiliations is RECOMMENDED. (The "None" affiliation is the absence of an affiliation.)</p>
    <p>These affiliations are long-lived in that they persist across a user's visits to the room and are not affected by happenings in the room. In addition, there is no one-to-one mapping between these affiliations and an occupant's role within the room. Affiliations are granted, revoked, and maintained based on the user's bare JID, not the nick as with roles.</p>
    <p>If a user without a defined affiliation enters a room, the user's affiliation is defined as "none"; however, this affiliation does not persist across visits (i.e., a service does not maintain a "none list" across visits).</p>
    <p>The member affiliation provides a way for a room owner or admin to specify a "whitelist" of users who are allowed to enter a members-only room. When a member enters a members-only room, his or her affiliation does not change, no matter what his or her role is. The member affiliation also provides a way for users to register with an open room and thus be lastingly associated with that room in some way (one result might be that the service could reserve the user's nickname in the room).</p>
    <p>An outcast is a user who has been banned from a room and who is not allowed to enter the room.</p>
    <p>Information about affiliations MUST be sent in all presence stanzas generated or reflected by the room and sent to occupants (if the room is configured to broadcast presence from entities with a given role).</p>
    <div class="indent"><h3>5.2.1 <a name="affil-priv" id="affil-priv">Privileges</a></h3>
      <p>For the most part, affiliations exist in a hierarchy. For instance, an owner can do anything an admin can do, and an admin can do anything a member can do. Each affiliation has all the privileges possessed by the next-lowest affiliation, plus additional privileges; these privileges are specified in the following table.</p>
      <div class="indent"><p class="caption"><a name="table-6" id="table-6"></a>Table 6: Privileges Associated With Affiliations</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th>Privilege</th>
          <th>Outcast</th>
          <th>None</th>
          <th>Member</th>
          <th>Admin</th>
          <th>Owner</th>
        </tr>
        <tr class="body">
          <td>Enter Open Room</td>
          <td>No</td>
          <td>Yes*</td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Register with Open Room</td>
          <td>No</td>
          <td>Yes</td>
          <td>N/A</td>
          <td>N/A</td>
          <td>N/A</td>
        </tr>
        <tr class="body">
          <td>Retrieve Member List</td>
          <td>No</td>
          <td>No</td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Enter Members-Only Room</td>
          <td>No</td>
          <td>No</td>
          <td>Yes*</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Ban Members and Unaffiliated Users</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Edit Member List</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>Yes</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Assign and Remove Moderator Role</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>Yes**</td>
          <td>Yes**</td>
        </tr>
        <tr class="body">
          <td>Edit Admin List</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Edit Owner List</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Change Room Configuration</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>Yes</td>
        </tr>
        <tr class="body">
          <td>Destroy Room</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>No</td>
          <td>Yes</td>
        </tr>
      </table></div>
      <p>* As a default, an unaffiliated user enters a moderated room as a visitor, and enters an open room as a participant. A member enters a room as a participant. An admin or owner enters a room as a moderator.</p>
      <p>** As noted, a moderator SHOULD NOT be allowed to revoke moderation privileges from someone with a higher affiliation than themselves (i.e., an unaffiliated moderator SHOULD NOT be allowed to revoke moderation privileges from an admin or an owner, and an admin SHOULD NOT be allowed to revoke moderation privileges from an owner).</p>
    </div>

    <div class="indent"><h3>5.2.2 <a name="affil-change" id="affil-change">Changing Affiliations</a></h3>
      <p>The ways in which a user's affiliation changes are well-defined. Sometimes the change results from the user's own action (e.g., registering as a member of the room), whereas sometimes the change results from an action taken by an admin or owner. If a user's affiliation changes, a MUC service implementation MUST change the user's affiliation to reflect the change and communicate that to all occupants (if the room is configured to broadcast presence from entities with a given role). Affiliation changes and their triggering actions are specified in the following table.</p>
      <div class="indent"><p class="caption"><a name="table-7" id="table-7"></a>Table 7: Affiliation State Chart</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th>&gt;</th>
          <th>Outcast</th>
          <th>None</th>
          <th>Member</th>
          <th>Admin</th>
          <th>Owner</th>
        </tr>
        <tr class="body">
          <td>Outcast</td>
          <td>--</td>
          <td>Admin or owner removes ban</td>
          <td>Admin or owner adds user to member list</td>
          <td>Owner adds user to admin list</td>
          <td>Owner adds user to owner list</td>
        </tr>
        <tr class="body">
          <td>None</td>
          <td>Admin or owner applies ban</td>
          <td>--</td>
          <td>Admin or owner adds user to member list, or user registers as member (if allowed)</td>
          <td>Owner adds user to admin list</td>
          <td>Owner adds user to owner list</td>
        </tr>
        <tr class="body">
          <td>Member</td>
          <td>Admin or owner applies ban</td>
          <td>Admin or owner changes affiliation to "none"</td>
          <td>--</td>
          <td>Owner adds user to admin list</td>
          <td>Owner adds user to owner list</td>
        </tr>
        <tr class="body">
          <td>Admin</td>
          <td>Owner applies ban</td>
          <td>Owner changes affiliation to "none"</td>
          <td>Owner changes affiliation to "member"</td>
          <td>--</td>
          <td>Owner adds user to owner list</td>
        </tr>
        <tr class="body">
          <td>Owner</td>
          <td>Owner applies ban</td>
          <td>Owner changes affiliation to "none"</td>
          <td>Owner changes affiliation to "member"</td>
          <td>Owner changes affiliation to "admin"</td>
          <td>--</td>
        </tr>
      </table></div>
    </div>

  </div>

<h2>6.
       <a name="entity" id="entity">Entity Use Cases</a></h2>
  <p>A MUC implementation MUST support <span class="ref"><a href="http://xmpp.org/extensions/xep-0030.html">Service Discovery (XEP-0030)</a></span>  [<a href="#nt-idp1996224">9</a>] ("disco"). Any entity can complete the following disco-related use cases.</p>
  <div class="indent"><h3>6.1 <a name="disco-service" id="disco-service">Discovering a MUC Service</a></h3>
    <p>An entity often discovers a MUC service by sending a Service Discovery items ("disco#items") request to its own server.</p>
    <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Entity Queries Server for Associated Services</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/pda'
    id='h7ns81g'
    to='shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The server then returns the services that are associated with it.</p>
    <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Server Returns Disco Items Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='shakespeare.lit'
    id='h7ns81g'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='chat.shakespeare.lit'
          name='Chatroom Service'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>6.2 <a name="disco-service-features" id="disco-service-features">Discovering the Features Supported by a MUC Service</a></h3>
    <p>An entity may wish to discover if a service implements the Multi-User Chat protocol; in order to do so, it sends a service discovery information ("disco#info") query to the MUC service's JID.</p>
    <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Entity Queries Chat Service for MUC Support via Disco</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/pda'
    id='lx09df27'
    to='chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST return its identity and the features it supports.</p>
    <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Service Returns Disco Info Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='chat.shakespeare.lit'
    id='lx09df27'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='Shakespearean Chat Service'
        type='text'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>6.3 <a name="disco-rooms" id="disco-rooms">Discovering Rooms</a></h3>
    <p>The service discovery items ("disco#items") protocol enables an entity to query a service for a list of associated items, which in the case of a chat service would consist of the specific chat rooms hosted by the service.</p>
    <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Entity Queries Chat Service for Rooms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/pda'
    id='zb8q41f4'
    to='chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service SHOULD return a full list of the public rooms it hosts (i.e., not return any rooms that are hidden).</p>
    <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Service Returns Disco Items Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='chat.shakespeare.lit'
    id='zb8q41f4'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='heath@chat.shakespeare.lit'
          name='A Lonely Heath'/&gt;
    &lt;item jid='coven@chat.shakespeare.lit'
          name='A Dark Cave'/&gt;
    &lt;item jid='forres@chat.shakespeare.lit'
          name='The Palace'/&gt;
    &lt;item jid='inverness@chat.shakespeare.lit'
          name='Macbeth&amp;apos;s Castle'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the full list of rooms is large (see <span class="ref">XEP-0030</span> for details), the service MAY return only a partial list of rooms. If it does so, it SHOULD include a &lt;set/&gt; element qualified by the 'http://jabber.org/protocol/rsm' namespace (as defined in <span class="ref"><a href="http://xmpp.org/extensions/xep-0059.html">Result Set Management (XEP-0059)</a></span>  [<a href="#nt-idp2011024">10</a>]) to indicate that the list is not the full result set.</p>
    <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Service Returns Limited List of Disco Items Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='chat.shakespeare.lit'
    id='hx51v49s'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='alls-well-that-ends-well@chat.shakespeare.lit'/&gt;
    &lt;item jid='as-you-like-it@chat.shakespeare.lit'/&gt;
    &lt;item jid='cleopatra@chat.shakespeare.lit'/&gt;
    &lt;item jid='comedy-of-errors@chat.shakespeare.lit'/&gt;
    &lt;item jid='coriolanus@chat.shakespeare.lit'/&gt;
    &lt;item jid='cymbeline@chat.shakespeare.lit'/&gt;
    &lt;item jid='hamlet@chat.shakespeare.lit'/&gt;
    &lt;item jid='henry-the-fourth-one@chat.shakespeare.lit'/&gt;
    &lt;item jid='henry-the-fourth-two@chat.shakespeare.lit'/&gt;
    &lt;item jid='henry-the-fifth@chat.shakespeare.lit'/&gt;
    &lt;set xmlns='http://jabber.org/protocol/rsm'&gt;
      &lt;first index='0'&gt;alls-well-that-ends-well@chat.shakespeare.lit&lt;/first&gt;
      &lt;last&gt;henry-the-fifth@chat.shakespeare.lit&lt;/last&gt;
      &lt;count&gt;37&lt;/count&gt;
    &lt;/set&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>6.4 <a name="disco-roominfo" id="disco-roominfo">Querying for Room Information</a></h3>
    <p>Using the disco#info protocol, an entity may also query a specific chat room for more detailed information about the room. An entity SHOULD do so before entering a room in order to determine the privacy and security profile of the room configuration (see the <a href="#security">Security Considerations</a> for details).</p>
    <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Entity Queries for Information about a Specific Chat Room</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/pda'
    id='ik3vs715'
    to='coven@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The room MUST return its identity and SHOULD return the features it supports:</p>
    <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Room Returns Disco Info Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='ik3vs715'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='A Dark Cave'
        type='text'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    &lt;feature var='muc_passwordprotected'/&gt;
    &lt;feature var='muc_hidden'/&gt;
    &lt;feature var='muc_temporary'/&gt;
    &lt;feature var='muc_open'/&gt;
    &lt;feature var='muc_unmoderated'/&gt;
    &lt;feature var='muc_nonanonymous'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Note: The room SHOULD return the materially-relevant features it supports, such as password protection and room moderation (these are listed fully in the feature registry maintained by the XMPP Registrar; see also the <a href="#registrar">XMPP Registrar</a> section of this document).</p>
    <p>A chatroom MAY return more detailed information in its disco#info response using <span class="ref"><a href="http://xmpp.org/extensions/xep-0128.html">Service Discovery Extensions (XEP-0128)</a></span>  [<a href="#nt-idp2021792">11</a>], identified by inclusion of a hidden FORM_TYPE field whose value is "http://jabber.org/protocol/muc#roominfo". Such information might include a more verbose description of the room, the current room subject, and the current number of occupants in the room:</p>
    <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Room Returns Extended Disco Info Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='ik3vs715'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='A Dark Cave'
        type='text'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    &lt;feature var='muc_passwordprotected'/&gt;
    &lt;feature var='muc_hidden'/&gt;
    &lt;feature var='muc_temporary'/&gt;
    &lt;feature var='muc_open'/&gt;
    &lt;feature var='muc_unmoderated'/&gt;
    &lt;feature var='muc_nonanonymous'/&gt;
    &lt;x xmlns='jabber:x:data' type='result'&gt;
      &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#roominfo&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_description' 
             label='Description'&gt;
        &lt;value&gt;The place for all good witches!&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_changesubject' 
             label='Occupants May Change the Subject'&gt;
        &lt;value&gt;true&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_contactjid' 
             label='Contact Addresses'&gt;
        &lt;value&gt;crone1@shakespeare.lit&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_subject' 
             label='Current Discussion Topic'&gt;
        &lt;value&gt;Spells&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_changesubject' 
             label='Subject can be modified'&gt;
        &lt;value&gt;true&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_occupants' 
             label='Number of occupants'&gt;
        &lt;value&gt;3&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_ldapgroup' 
             label='Associated LDAP Group'&gt;
        &lt;value&gt;cn=witches,dc=shakespeare,dc=lit&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_lang' 
             label='Language of discussion'&gt;
        &lt;value&gt;en&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_logs' 
             label='URL for discussion logs'&gt;
        &lt;value&gt;http://www.shakespeare.lit/chatlogs/coven/&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#maxhistoryfetch'
             label='Maximum Number of History Messages Returned by Room'&gt;
        &lt;value&gt;50&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_pubsub' 
             label='Associated pubsub node'&gt;
        &lt;value&gt;xmpp:pubsub.shakespeare.lit?;node=the-coven-node&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Some extended room information is dynamically generated (e.g., the URL for discussion logs, which may be based on service-wide configuration), whereas other information is based on the more-stable room configuration, which is why any field defined for the <a href="#registrar-formtype-owner">muc#roomconfig FORM_TYPE</a> can be included in the extended service discovery fields (as shown above for the "muc#roomconfig_changesubject" field).</p>
    <p>Note: The foregoing extended service discovery fields for the 'http://jabber.org/protocol/muc#roominfo' FORM_TYPE are examples only and might be supplemented in the future via the mechanisms described in the <a href="#registrar-formtype">Field Standardization</a> section of this document.</p>
  </div>

  <div class="indent"><h3>6.5 <a name="disco-roomitems" id="disco-roomitems">Querying for Room Items</a></h3>
    <p>An entity MAY also query a specific chat room for its associated items:</p>
    <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Entity Queries for Items Associated with a Specific Chat Room</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/pda'
    id='kl2fax27'
    to='coven@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p>An implementation MAY return a list of existing occupants if that information is publicly available, or return no list at all if this information is kept private. Implementations and deployments are advised to turn off such information sharing by default.</p>
    <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Room Returns Disco Items Result (Items are Public)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='kl2fax27'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='coven@chat.shakespeare.lit/firstwitch'/&gt;
    &lt;item jid='coven@chat.shakespeare.lit/secondwitch'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Note: These &lt;item/&gt; elements are qualified by the disco#items namespace, not the muc namespace; this means that they cannot possess 'affiliation' or 'role' attributes, for example.</p>
    <p>If the list of occupants is private, the room MUST return an empty &lt;query/&gt; element, in accordance with <span class="ref">XEP-0030</span>.</p>
    <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Room Returns Empty Disco Items Result (Items are Private)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='kl2fax27'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>6.6 <a name="disco-occupant" id="disco-occupant">Querying a Room Occupant</a></h3>
    <p>If a non-occupant attempts to send a disco request to an address of the form &lt;room@service/nick&gt;, a MUC service MUST return a &lt;bad-request/&gt; error. If an occupant sends such a request, the service MAY pass it through the intended recipient; see the <a href="#impl">Implementation Guidelines</a> section of this document for details.</p>
  </div>

  <div class="indent"><h3>6.7 <a name="disco-client" id="disco-client">Discovering Client Support for MUC</a></h3>
    <p>An entity might want to discover if one of the entity's contacts supports the Multi-User Chat protocol (e.g., before attempting to invite the contact to a room). This can be done using Service Discovery.</p>
    <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Entity Queries Contact Regarding MUC Support</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/pda'
    id='yh2fs843'
    to='wiccarocks@shakespeare.lit/laptop'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The client SHOULD return its identity and the features it supports.</p>
    <p class="caption"><a name="example-15" id="example-15"></a>Example 15. Contact Returns Disco Info Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='wiccarocks@shakespeare.lit/laptop'
    id='yh2fs843'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='client'
        type='pc'/&gt;
    ...
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>An entity may also query a contact regarding which rooms the contact is in. This is done by querying the contact's full JID (&lt;user@host/resource&gt;) while specifying the well-known Service Discovery node 'http://jabber.org/protocol/muc#rooms'.</p>
    <p class="caption"><a name="example-16" id="example-16"></a>Example 16. Entity Queries Contact for Current Rooms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/pda'
    id='gp7w61v3'
    to='wiccarocks@shakespeare.lit/laptop'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='http://jabber.org/protocol/muc#rooms'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-17" id="example-17"></a>Example 17. Contact Returns Room Query Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='wiccarocks@shakespeare.lit/laptop'
    id='gp7w61v3'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='http://jabber.org/protocol/muc#rooms'&gt;
    &lt;item jid='coven@chat.shakespeare.lit'/&gt;
    &lt;item jid='characters@conference.shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Optionally, the contact MAY include its roomnick as the value of the 'name' attribute:</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
    ...
    &lt;item jid='coven@chat.shakespeare.lit'
          name='secondwitch'/&gt;
    ...
    </pre></div>
    <p>If this information is private, the user MUST return an empty &lt;query/&gt; element, in accordance with <span class="ref">XEP-0030</span>.</p>
  </div>

<h2>7.
       <a name="user" id="user">Occupant Use Cases</a></h2>
  <p>The main actor in a multi-user chat environment is the occupant, who can be said to be located "in" a multi-user chat room and to participate in the discussions held in that room (for the purposes of this specification, participants and visitors are considered to be "mere" occupants, since they possess no admin status). As will become clear, the protocol elements proposed in this document to fulfill the occupant use cases fall into three categories:</p>
  <ol start="1">
    <li><p>the basic functionality for joining a room, exchanging messages with all occupants, etc. (supported by the groupchat 1.0 protocol that preceded MUC)</p></li>
    <li><p>straightforward additions to the basic functionality, such as handling of errors related to new room types</p></li>
    <li><p>additional protocol elements to handle functionality not covered by groupchat 1.0 (room invites, room passwords, extended presence related to room roles and affiliations); these are qualified by the 'http://jabber.org/protocol/muc#user' namespace</p></li>
  </ol>
  <p>Note: All client-generated examples herein are presented from the perspective of the service, with the result that all stanzas received by a service contain a 'from' attribute corresponding to the sender's full JID as added by a normal XMPP router or session manager. In addition, normal IQ result stanzas sent upon successful completion of a request (as required by <span class="ref"><a href="http://tools.ietf.org/html/rfc6120">XMPP Core</a></span>  [<a href="#nt-idp2052720">12</a>]) are not shown.</p>
  <div class="indent"><h3>7.1 <a name="order" id="order">Order of Events</a></h3>
    <p>The order of events involved in joining a room needs to be consistent so that clients can know which events to expect when. After a client sends presence to join a room, the MUC service MUST send it events in the following order:</p>
    <ol>
      <li>In-room presence from other occupants</li>
      <li>In-room presence from the joining entity itself (so-called "self-presence")</li>
      <li>Room history (if any)</li>
      <li>The room subject</li>
      <li>Live messages, presence updates, new user joins, etc.</li>
    </ol>
  </div>

  <div class="indent"><h3>7.2 <a name="enter" id="enter">Entering a Room</a></h3>
    <div class="indent"><h3>7.2.1 <a name="enter-gc" id="enter-gc">Groupchat 1.0 Protocol</a></h3>
      <p>In order to participate in the discussions held in a multi-user chat room, a user MUST first become an occupant by entering the room. In the old groupchat 1.0 protocol, this was done by sending presence with no 'type' attribute to &lt;room@service/nick&gt;, where "room" is the room ID, "service" is the hostname of the chat service, and "nick" is the user's desired nickname within the room:</p>
      <p class="caption"><a name="example-18" id="example-18"></a>Example 18. User Seeks to Enter a Room (groupchat 1.0)</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    id='ng91xs69'
    to='coven@chat.shakespeare.lit/thirdwitch'/&gt;
      </pre></div>
      <p>In this example, a user with a full JID of "hag66@shakespeare.lit/pda" has requested to enter the room "coven" on the "chat.shakespeare.lit" chat service with a room nickname of "thirdwitch".</p>
      <p>If the user does not specify a room nickname (note the bare JID on the 'from' address in the following example), the service MUST return a &lt;jid-malformed/&gt; error:</p>
      <p class="caption"><a name="example-19" id="example-19"></a>Example 19. No Nickname Specified</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit'
    id='273hs51g'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='modify'&gt;
    &lt;jid-malformed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
      <p>Note: The presence stanza used to join a room MUST NOT possess a 'type' attribute, i.e., it must be available presence. For further discussion, see the <a href="#bizrules-presence">Presence</a> business rules.</p>
    </div>

    <div class="indent"><h3>7.2.2 <a name="enter-muc" id="enter-muc">Basic MUC Protocol</a></h3>
      <p>Compliant multi-user chat services MUST accept the foregoing as a request to enter a room from any client that knows either the groupchat 1.0 protocol or the multi-user chat (MUC) protocol; however, MUC clients SHOULD signal their ability to speak the MUC protocol by including in the initial presence stanza an empty &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc' namespace (note the absence of the '#user' fragment):</p>
      <p class="caption"><a name="example-20" id="example-20"></a>Example 20. User Seeks to Enter a Room (Multi-User Chat)</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    id='n13mt3l'
    to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p>Before attempting to enter the room, a MUC-compliant client SHOULD first discover its reserved room nickname (if any) by following the protocol defined in the <a href="#reservednick">Discovering Reserved Room Nickname</a> section of this document.</p>
    </div>

    <div class="indent"><h3>7.2.3 <a name="enter-pres" id="enter-pres">Presence Broadcast</a></h3>
      <p>If the service is able to add the user to the room, it MUST send presence from all the existing participants' occupant JIDs to the new occupant's full JID, including extended presence information about roles in a single &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'role' attribute set to a value of "moderator", "participant", or "visitor", and with the 'affiliation' attribute set to a value of "owner", "admin", "member", or "none" as appropriate.  [<a href="#nt-idp2070320">13</a>]</p>
      <p class="caption"><a name="example-21" id="example-21"></a>Example 21. Service Sends Presence from Existing Occupants to New Occupant</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/firstwitch'
    id='3DCB0401-D7CF-4E31-BE05-EDF8D057BFBD'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner' role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='coven@chat.shakespeare.lit/secondwitch'
    id='C2CD9EE3-8421-431E-854A-A2AD0CE2E23D'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin' role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p>In this example, the user from the previous example has entered the room, by which time two other people had already entered the room: a user with a room nickname of "firstwitch" (who is a room owner) and a user with a room nickname of "secondwitch" (who is a room admin).</p>
      <p>Unless the room is configured to not broadcast presence from new occupants below a certain affiliation level (as controlled by the "muc#roomconfig_presencebroadcast" room configuration option), the service MUST also send presence from the new participant's occupant JID to the full JIDs of all the occupants (including the new occupant).</p>
      <p class="caption"><a name="example-22" id="example-22"></a>Example 22. Service Sends New Occupant's Presence to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='27C55F89-1C6A-459A-9EB5-77690145D624'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='9E757BAE-8AC8-4093-AA9C-407F6AEF15D6'
    to='wiccarocks@shakespeare.lit/laptop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='026B3509-2CCE-4D69-96D6-25F41FFDC408'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
    &lt;status code='110'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p>In this example, initial room presence is being sent from the new occupant (thirdwitch) to all occupants, including the new occupant.</p>
      <p>As shown in the last stanza, the "self-presence" sent by the room to the new user MUST include a status code of 110 so that the user knows this presence refers to itself as an occupant. This self-presence MUST NOT be sent to the new occupant until the room has sent the presence of all other occupants to the new occupant; this enables the new occupant to know when it has finished receiving the room roster.</p>
      <p>The service MAY rewrite the new occupant's roomnick (e.g., if roomnicks are locked down or based on some other policy).</p>
      <p>In particular, if roomnicks are locked down then the service MUST do one of the following.</p>
      <p>If the user has connected using a "groupchat 1.0" client (as indicated on joining the room by the lack of the MUC extension), then the service SHOULD deny the nickname change request and return a presence stanza of type "error" with a &lt;not-acceptable/&gt; error condition:</p>
      <p class="caption"><a name="example-23" id="example-23"></a>Example 23. Service Denies Room Join Because Roomnicks Are Locked Down</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='ng91xs69'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='cancel'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
      <p>If the user has connected using a MUC client (as indicated on joining the room by inclusino of the MUC extension), then the service MUST allow the client to enter the room, modify the nick in accordance with the lockdown policy, and include a status code of "210" in the presence broadcast that it sends to the new occupant.</p>
      <p class="caption"><a name="example-24" id="example-24"></a>Example 24. Service Sends New Occupant's Presence to New Occupant</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='n13mt3l'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
    &lt;status code='110'/&gt;
    &lt;status code='210'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p>Note: The order of the presence stanzas sent to the new occupant is important. The service MUST first send the complete list of the existing occupants to the new occupant and only then send the new occupant's own presence to the new occupant. This helps the client know when it has received the complete "room roster". For tracking purposes, the room might also reflect the original 'id' value if provided in the presence stanza sent by the user.</p>
      <p>After sending the presence broadcast (and only after doing so), the service MAY then send discussion history, the room subject, live messages, presence updates, and other in-room traffic.</p>
    </div>

    <div class="indent"><h3>7.2.4 <a name="enter-nonanon" id="enter-nonanon">Non-Anonymous Rooms</a></h3>
      <p>If the room is non-anonymous, the service MUST send the new occupant's full JID to all occupants using extended presence information in an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with a 'jid' attribute specifying the occupant's full JID:</p>
      <p class="caption"><a name="example-25" id="example-25"></a>Example 25. Service Sends Full JID to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='17232D15-134F-43C8-9A29-61C20A64B236'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
      </pre></div>
      <p>If the user is entering a room that is non-anonymous (i.e., which informs all occupants of each occupant's full JID as shown above), the service MUST warn the user by including a status code of "100" in the initial presence that the room sends to the new occupant:</p>
      <p class="caption"><a name="example-26" id="example-26"></a>Example 26. Service Sends New Occupant's Presence to New Occupant</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='n13mt3l'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
    &lt;status code='100'/&gt;
    &lt;status code='110'/&gt;
    &lt;status code='210'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p>The inclusion of the status code assists clients in presenting their own notification messages (e.g., information appropriate to the user's locality).</p>
    </div>

    <div class="indent"><h3>7.2.5 <a name="enter-semianon" id="enter-semianon">Semi-Anonymous Rooms</a></h3>
      <p>If the room is semi-anonymous, the service MUST send presence from the new occupant to all occupants as specified above (i.e., unless the room is configured to not broadcast presence from new occupants below a certain affiliation level as controlled by the "muc#roomconfig_presencebroadcast" room configuration option), but MUST include the new occupant's full JID only in the presence notifications it sends to occupants with a role of "moderator" and not to non-moderator occupants.</p>
      <p>(Note: All subsequent examples include the 'jid' attribute for each &lt;item/&gt; element, even though this information is not sent to non-moderators in semi-anonymous rooms.)</p>
    </div>

    <div class="indent"><h3>7.2.6 <a name="enter-pw" id="enter-pw">Password-Protected Rooms</a></h3>
      <p>If the room requires a password and the user did not supply one (or the password provided is incorrect), the service MUST deny access to the room and inform the user that they are unauthorized; this is done by returning a presence stanza of type "error" specifying a &lt;not-authorized/&gt; error:</p>
      <p class="caption"><a name="example-27" id="example-27"></a>Example 27. Service Denies Access Because No Password Provided</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='n13mt3l'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='auth'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
      <p>Passwords SHOULD be supplied with the presence stanza sent when entering the room, contained within an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc' namespace and containing a &lt;password/&gt; child. Passwords are to be sent as cleartext; no other authentication methods are supported at this time, and any such authentication or authorization methods shall be defined in a separate specification (see the <a href="#security">Security Considerations</a> section of this document).</p>
      <p class="caption"><a name="example-28" id="example-28"></a>Example 28. User Provides Password On Entering a Room</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    id='djn4714'
    to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;password&gt;cauldronburn&lt;/password&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>7.2.7 <a name="enter-members" id="enter-members">Members-Only Rooms</a></h3>
      <p>If the room is members-only but the user is not on the member list, the service MUST deny access to the room and inform the user that they are not allowed to enter the room; this is done by returning a presence stanza of type "error" specifying a &lt;registration-required/&gt; error condition:</p>
      <p class="caption"><a name="example-29" id="example-29"></a>Example 29. Service Denies Access Because User Is Not on Member List</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='n13mt3l'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='auth'&gt;
    &lt;registration-required xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>7.2.8 <a name="enter-banned" id="enter-banned">Banned Users</a></h3>
      <p>If the user has been banned from the room (i.e., has an affiliation of "outcast"), the service MUST deny access to the room and inform the user of the fact that they are banned; this is done by returning a presence stanza of type "error" specifying a &lt;forbidden/&gt; error condition:</p>
      <p class="caption"><a name="example-30" id="example-30"></a>Example 30. Service Denies Access Because User is Banned</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='n13mt3l'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>7.2.9 <a name="enter-conflict" id="enter-conflict">Nickname Conflict</a></h3>
      <p>If the room already contains another user with the nickname desired by the user seeking to enter the room (or if the nickname is reserved by another user on the member list), the service MUST deny access to the room and inform the user of the conflict; this is done by returning a presence stanza of type "error" specifying a &lt;conflict/&gt; error condition:</p>
      <p class="caption"><a name="example-31" id="example-31"></a>Example 31. Service Denies Access Because of Nick Conflict</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='n13mt3l'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
      <p>However, if the bare JID &lt;localpart@domain.tld&gt; of the present occupant matches the bare JID of the user seeking to enter the room, then the service SHOULD allow entry to the user, so that the user has two (or more) in-room "sessions" with the same roomnick, one for each resource. If a service allows more than one occupant with the same bare JID and the same room nickname, it MUST route in-room messages to all of the user's resources and allow all of the user's resources to send messages to the room; it is up to the implementation whether to route private messages to all resources or only one resource (based on presence priority or some other algorithm); however, it is RECOMMENDED to route to all resources.</p>
      <p>How nickname conflicts are determined is up to the implementation (e.g., whether the service applies a case folding routine, a stringprep profile such as Resourceprep or Nodeprep, etc.).</p>
    </div>

    <div class="indent"><h3>7.2.10 <a name="enter-maxusers" id="enter-maxusers">Max Users</a></h3>
      <p>If the room has reached its maximum number of occupants, the service SHOULD deny access to the room and inform the user of the restriction; this is done by returning a presence stanza of type "error" specifying a &lt;service-unavailable/&gt; error condition:</p>
      <p class="caption"><a name="example-32" id="example-32"></a>Example 32. Service Informs User that Room Occupant Limit Has Been Reached</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='n13mt3l'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='wait'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
      <p>Alternatively, the room could kick an "idle user" in order to free up space (where the definition of "idle user" is up to the implementation).</p>
      <p>If the room has reached its maximum number of occupants and a room admin or owner attempts to join, the room MUST allow the admin or owner to join, up to some reasonable number of additional occupants; this helps to prevent denial of service attacks caused by stuffing the room with non-admin users.</p>
    </div>

    <div class="indent"><h3>7.2.11 <a name="enter-locked" id="enter-locked">Locked Room</a></h3>
      <p>If a user attempts to enter a room while it is "locked" (i.e., before the room creator provides an initial configuration and therefore before the room officially exists), the service MUST refuse entry and return an &lt;item-not-found/&gt; error to the user:</p>
      <p class="caption"><a name="example-33" id="example-33"></a>Example 33. Service Denies Access Because Room Does Not (Yet) Exist</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='n13mt3l'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>7.2.12 <a name="enter-nonexistent" id="enter-nonexistent">Nonexistent Room</a></h3>
      <p>If the room does not already exist when the user seeks to enter it, the service SHOULD create it; however, this is not required, since an implementation or deployment MAY choose to restrict the privilege of creating rooms. For details, see the <a href="#createroom">Creating a Room</a> section of this document.</p>
    </div>

    <div class="indent"><h3>7.2.13 <a name="enter-logging" id="enter-logging">Room Logging</a></h3>
      <p>If the user is entering a room in which the discussions are logged to a public archive (often accessible via HTTP), the service SHOULD allow the user to enter the room but MUST also warn the user that the discussions are logged. This is done by including a status code of "170" in the initial presence that the room sends to the new occupant:</p>
      <p class="caption"><a name="example-34" id="example-34"></a>Example 34. Service Sends New Occupant's Presence to New Occupant</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='n13mt3l'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
    &lt;status code='100'/&gt;
    &lt;status code='110'/&gt;
    &lt;status code='170'/&gt;
    &lt;status code='210'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>7.2.14 <a name="enter-history" id="enter-history">Discussion History</a></h3>
      <p>After sending initial presence as shown above, depending on local service policy or room configuration a room MAY send discussion history to the new occupant. (The room MUST NOT send any discussion history before it finishes sending room presence as specified in the <a href="#enter-pres">Presence Broadcast</a> section of this document.) Whether such history is sent, and how many messages comprise the history, shall be determined by the chat service implementation or specific deployment depending on local service policy or room configuration.</p>
      <p class="caption"><a name="example-35" id="example-35"></a>Example 35. Delivery of Discussion History</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit/firstwitch'
    id='162BEBB1-F6DB-4D9A-9BD8-CFDCC801A0B2'
    to='hecate@shakespeare.lit/broom'
    type='groupchat'&gt;
  &lt;body&gt;Thrice the brinded cat hath mew'd.&lt;/body&gt;
  &lt;delay xmlns='urn:xmpp:delay'
     from='coven@chat.shakespeare.lit'
     stamp='2002-10-13T23:58:37Z'/&gt;
&lt;/message&gt;

&lt;message
    from='coven@chat.shakespeare.lit/secondwitch'
    id='90057840-30FD-4141-AA44-103EEDF218FC'
    to='hecate@shakespeare.lit/broom'
    type='groupchat'&gt;
  &lt;body&gt;Thrice and once the hedge-pig whined.&lt;/body&gt;
  &lt;delay xmlns='urn:xmpp:delay'
     from='coven@chat.shakespeare.lit'
     stamp='2002-10-13T23:58:43Z'/&gt;
&lt;/message&gt;

&lt;message
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'
    to='hecate@shakespeare.lit/broom'
    type='groupchat'&gt;
  &lt;body&gt;Harpier cries 'Tis time, 'tis time.&lt;/body&gt;
  &lt;delay xmlns='urn:xmpp:delay'
     from='coven@chat.shakespeare.lit'
     stamp='2002-10-13T23:58:49Z'/&gt;
&lt;/message&gt;
      </pre></div>
      <p>Discussion history messages MUST be stamped with <span class="ref"><a href="http://xmpp.org/extensions/xep-0203.html">Delayed Delivery (XEP-0203)</a></span>  [<a href="#nt-idp2125008">14</a>] information qualified by the 'urn:xmpp:delay' namespace to indicate that they are sent with delayed delivery and to specify the times at which they were originally sent. The 'from' attribute MUST be set to the JID of the room itself.</p>
      <p>(Note: The 'urn:xmpp:delay' namespace defined in <span class="ref">XEP-0203</span> supersedes the older 'jabber:x:delay' namespace defined in <span class="ref"><a href="http://xmpp.org/extensions/xep-0091.html">Legacy Delayed Delivery (XEP-0091)</a></span>  [<a href="#nt-idp2128352">15</a>]; some implementations include both formats for backward compatibility.)</p>
      <p>The service MUST send all discussion history messages before delivering the room subject and any "live" messages sent after the user enters the room. Note well that this means the room subject (and changes to the room subject prior to the current subject) are not part of the discussion history.</p>
      <p>If the room is non-anonymous, the service MAY include an <span class="ref"><a href="http://xmpp.org/extensions/xep-0033.html">Extended Stanza Addressing (XEP-0033)</a></span>  [<a href="#nt-idp2131600">16</a>] element that notes the original full JID of the sender by means of the "ofrom" address type:</p>
      <p class="caption"><a name="example-36" id="example-36"></a>Example 36. Discussion History Message with Original From</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit/firstwitch'
    id='162BEBB1-F6DB-4D9A-9BD8-CFDCC801A0B2'
    to='hecate@shakespeare.lit/broom'
    type='groupchat'&gt;
  &lt;body&gt;Thrice the brinded cat hath mew'd.&lt;/body&gt;
  &lt;delay xmlns='urn:xmpp:delay'
     from='coven@chat.shakespeare.lit'
     stamp='2002-10-13T23:58:37Z'/&gt;
  &lt;addresses xmlns='http://jabber.org/protocol/address'&gt;
    &lt;address type='ofrom' jid='crone1@shakespeare.lit/desktop'/&gt;
  &lt;/addresses&gt;
&lt;/message&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>7.2.15 <a name="enter-managehistory" id="enter-managehistory">Managing Discussion History</a></h3>
      <p>A user might want to manage the amount of discussion history provided on entering a room (perhaps because the user is on a low-bandwidth connection or is using a small-footprint client). This is accomplished by including a &lt;history/&gt; child in the initial presence stanza sent when joining the room. There are four allowable attributes for this element:</p>
      <div class="indent"><p class="caption"><a name="table-8" id="table-8"></a>Table 8: History Management Attributes</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th>Attribute</th>
          <th>Datatype</th>
          <th>Meaning</th>
        </tr>
        <tr class="body">
          <td>maxchars</td>
          <td>int</td>
          <td>Limit the total number of characters in the history to "X" (where the character count is the characters of the complete XML stanzas, not only their XML character data).</td>
        </tr>
        <tr class="body">
          <td>maxstanzas</td>
          <td>int</td>
          <td>Limit the total number of messages in the history to "X".</td>
        </tr>
        <tr class="body">
          <td>seconds</td>
          <td>int</td>
          <td>Send only the messages received in the last "X" seconds.</td>
        </tr>
        <tr class="body">
          <td>since</td>
          <td>dateTime</td>
          <td>Send only the messages received since the UTC datetime specified (which MUST conform to the DateTime profile specified in <span class="ref"><a href="http://xmpp.org/extensions/xep-0082.html">XMPP Date and Time Profiles (XEP-0082)</a></span>  [<a href="#nt-idp2144960">17</a>]).</td>
        </tr>
      </table></div>
      <p>The service MUST send the smallest amount of traffic that meets any combination of the above criteria, taking into account service-level and room-level defaults. The service MUST send complete message stanzas only (i.e., it MUST not literally truncate the history at a certain number of characters, but MUST send the largest number of complete stanzas that results in a number of characters less than or equal to the 'maxchars' value specified). If the client wishes to receive no history, it MUST set the 'maxchars' attribute to a value of "0" (zero).</p>
      <p>Note: It is known that not all service implementations support MUC history management, so in practice a client might not be able to depend on receiving only the history that it has requested.</p>
      <p>The following examples illustrate the use of this feature.</p>
      <p class="caption"><a name="example-37" id="example-37"></a>Example 37. User Requests Limit on Number of Characters in History</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    id='n13mt3l'
    to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;history maxchars='65000'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="caption"><a name="example-38" id="example-38"></a>Example 38. User Requests Limit on Number of Messages in History</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    id='n13mt3l'
    to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;history maxstanzas='20'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="caption"><a name="example-39" id="example-39"></a>Example 39. User Requests History in Last 3 Minutes</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    id='n13mt3l'
    to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;history seconds='180'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="caption"><a name="example-40" id="example-40"></a>Example 40. User Requests All History Since the Beginning of the Unix Era</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    id='n13mt3l'
    to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;history since='1970-01-01T00:00:00Z'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p>Obviously the service SHOULD NOT return all messages sent in the room since the beginning of the Unix era, and SHOULD appropriately limit the amount of history sent to the user based on service or room defaults.</p>
      <p class="caption"><a name="example-41" id="example-41"></a>Example 41. User Requests No History</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    id='n13mt3l'
    to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;history maxchars='0'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>7.2.16 <a name="enter-subject" id="enter-subject">Room Subject</a></h3>
      <p>After the room has optionally sent the discussion history to the new occupant, it SHALL send the current room subject. This is a &lt;message/&gt; stanza from the room JID (or from the occupant JID of the entity that set the subject), with a &lt;subject/&gt; element but no &lt;body/&gt; element, as shown in the following example.</p>
      <p class="caption"><a name="example-42" id="example-42"></a>Example 42. Service Informs New Occupant of Room Subject</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit/secondwitch'
    id='F437C672-D438-4BD3-9BFF-091050D32EE2'
    to='crone1@shakespeare.lit/desktop'
    type='groupchat'&gt;
  &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;
&lt;/message&gt;
      </pre></div>
      <p>If there is no subject set, the room MUST return an empty &lt;subject/&gt; element.</p>
      <p class="caption"><a name="example-43" id="example-43"></a>Example 43. No Subject</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit/secondwitch'
    id='F437C672-D438-4BD3-9BFF-091050D32EE2'
    to='crone1@shakespeare.lit/desktop'
    type='groupchat'&gt;
  &lt;subject&gt;&lt;/subject&gt;
&lt;/message&gt;
      </pre></div>
      <p>Note: In accordance with the core definition of XML stanzas, any message can contain a &lt;subject/&gt; element; only a message that contains a &lt;subject/&gt; but no &lt;body/&gt; element shall be considered a subject change for MUC purposes.</p>
    </div>

    <div class="indent"><h3>7.2.17 <a name="enter-live" id="enter-live">Live Messages</a></h3>
      <p>After the room has sent the room subject, it SHALL begin to send live messages, presence changes, occupant "joins" and "leaves", and other real-time traffic to the new occupant, as described in other sections of this document.</p>
    </div>

    <div class="indent"><h3>7.2.18 <a name="enter-errorcodes" id="enter-errorcodes">Error Conditions</a></h3>
      <p>The following table summarizes the XMPP error conditions that can be returned to an entity that attempts to enter a MUC room.</p>
      <div class="indent"><p class="caption"><a name="table-9" id="table-9"></a>Table 9: Error Conditions for Entering a Room</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th>Condition</th>
          <th>Purpose</th>
        </tr>
        <tr class="body">
          <td>&lt;not-authorized/&gt;</td>
          <td>Inform user that a password is required</td>
        </tr>
        <tr class="body">
          <td>&lt;forbidden/&gt;</td>
          <td>Inform user that he or she is banned from the room</td>
        </tr>
        <tr class="body">
          <td>&lt;item-not-found/&gt;</td>
          <td>Inform user that the room does not exist</td>
        </tr>
        <tr class="body">
          <td>&lt;not-allowed/&gt;</td>
          <td>Inform user that room creation is restricted</td>
        </tr>
        <tr class="body">
          <td>&lt;not-acceptable/&gt;</td>
          <td>Inform user that the reserved roomnick must be used</td>
        </tr>
        <tr class="body">
          <td>&lt;registration-required/&gt;</td>
          <td>Inform user that he or she is not on the member list</td>
        </tr>
        <tr class="body">
          <td>&lt;conflict/&gt;</td>
          <td>Inform user that his or her desired room nickname is in use or registered by another user</td>
        </tr>
        <tr class="body">
          <td>&lt;service-unavailable/&gt;</td>
          <td>Inform user that the maximum number of users has been reached</td>
        </tr>
      </table></div>
    </div>
  
  </div>

  <div class="indent"><h3>7.3 <a name="subject-occupant" id="subject-occupant">Occupant Modification of the Room Subject</a></h3>
    <p>If allowed in accordance with room configuration, a mere occupant MAY be allowed to change the subject in a room. For details, see the <a href="#subject-mod">Modifying the Room Subject</a> section of this document.</p>
  </div>

  <div class="indent"><h3>7.4 <a name="message" id="message">Sending a Message to All Occupants</a></h3>
    <p>An occupant sends a message to all other occupants in the room by sending a message of type "groupchat" to the &lt;room@service&gt; itself (a service MAY ignore or reject messages that do not have a type of "groupchat"). In a moderated room, this privilege is restricted to occupants with a role of participant or higher.</p>
    <p class="caption"><a name="example-44" id="example-44"></a>Example 44. Occupant Sends a Message to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='hag66@shakespeare.lit/pda'
    id='hysf1v37'
    to='coven@chat.shakespeare.lit'
    type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p>If the sender has voice in the room (this is the default except in moderated rooms) and the message does not violate any service-level or room-level policies (e.g., policies regarding message content or size), the service MUST change the 'from' attribute to the sender's occupant JID and reflect the message out to the full JID of each occupant.</p>
    <p class="caption"><a name="example-45" id="example-45"></a>Example 45. Service Reflects Message to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='E36F45B8-DE06-4534-94AD-C5ED29415FCE'
    to='crone1@shakespeare.lit/desktop'
    type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
&lt;/message&gt;
&lt;message
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='AFCA9201-2BA0-4A20-98D4-B9CB85F9B982'
    to='wiccarocks@shakespeare.lit/laptop'
    type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
&lt;/message&gt;
&lt;message
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='FB7092DB-A70B-4ACA-8FAC-5E3F89F03F64'
    to='hag66@shakespeare.lit/pda'
    type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p>Note well that for tracking purposes this service assigns a new 'id' to each message it generates (here using a UUID as defined in <span class="ref"><a href="http://tools.ietf.org/html/rfc4122">RFC 4122</a></span>  [<a href="#nt-idp2181168">18</a>]).</p>
    <p>If the sender is a visitor (i.e., does not have voice in a moderated room), the service MUST return a &lt;forbidden/&gt; error to the sender and MUST NOT reflect the message to all occupants. If the sender is not an occupant of the room, the service SHOULD return a &lt;not-acceptable/&gt; error to the sender and SHOULD NOT reflect the message to all occupants; the only exception to this rule is that an implementation MAY allow users with certain privileges (e.g., a room owner, room admin, or service-level admin) to send messages to the room even if those users are not occupants.</p>
  </div>

  <div class="indent"><h3>7.5 <a name="privatemessage" id="privatemessage">Sending a Private Message</a></h3>
    <p>Since each occupant has its own occupant JID, an occupant can send a "private message" to a selected occupant via the service by sending a message to the intended recipient's occupant JID. The message type SHOULD be "chat" and MUST NOT be "groupchat", but MAY be left unspecified (i.e., a normal message). This privilege is controlled by the "muc#roomconfig_allowpm" room configuration option.</p>
    <p class="caption"><a name="example-46" id="example-46"></a>Example 46. Occupant Sends Private Message</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='wiccarocks@shakespeare.lit/laptop'
    id='hgn27af1'
    to='coven@chat.shakespeare.lit/firstwitch'
    type='chat'&gt;
  &lt;body&gt;I'll give thee a wind.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p>The service is responsible for changing the 'from' address to the sender's occupant JID and delivering the message to the intended recipient's full JID.</p>
    <p class="caption"><a name="example-47" id="example-47"></a>Example 47. Recipient Receives the Private Message</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit/firstwitch'
    id='hgn27af1'
    to='crone1@shakespeare.lit/desktop'
    type='chat'&gt;
  &lt;body&gt;I'll give thee a wind.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p>If the sender attempts to send a private message of type "groupchat" to a particular occupant, the service MUST refuse to deliver the message (since the recipient's client would expect in-room messages to be of type "groupchat") and return a &lt;bad-request/&gt; error to the sender:</p>
    <p class="caption"><a name="example-48" id="example-48"></a>Example 48. Occupant Attempts to Send a Message of Type "Groupchat" to a Particular Occupant</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='wiccarocks@shakespeare.lit/laptop'
    id='bx71f29k'
    to='coven@chat.shakespeare.lit/firstwitch'
    type='groupchat'&gt;
  &lt;body&gt;I'll give thee a wind.&lt;/body&gt;
&lt;/message&gt;

&lt;message
    from='coven@chat.shakespeare.lit/firstwitch'
    id='bx71f29k'
    to='wiccarocks@shakespeare.lit/laptop'
    type='error'&gt;
  &lt;body&gt;I'll give thee a wind.&lt;/body&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/message&gt;
    </pre></div>
    <p>If the sender attempts to send a private message to an occupant JID that does not exist, the service MUST return an &lt;item-not-found/&gt; error to the sender.</p>
    <p>If the sender is not an occupant of the room in which the intended recipient is visiting, the service MUST return a &lt;not-acceptable/&gt; error to the sender.</p>
  </div>

  <div class="indent"><h3>7.6 <a name="changenick" id="changenick">Changing Nickname</a></h3>
    <p>A common feature of chat rooms is the ability for an occupant to change his or her nickname within the room. In MUC this is done by sending updated presence information to the room, specifically by sending presence to a new occupant JID in the same room (changing only the resource identifier in the occupant JID).</p>
    <p class="caption"><a name="example-49" id="example-49"></a>Example 49. Occupant Changes Nickname</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    id='ifd1c35'
    to='coven@chat.shakespeare.lit/oldhag'/&gt;
    </pre></div>
    <p>The service then sends two presence stanzas to the full JID of each occupant (including the occupant who is changing his or her room nickname), one of type "unavailable" for the old nickname and one indicating availability for the new nickname.</p>
   <p>The unavailable presence MUST contain the following as extended presence information in an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace:</p>
    <ul>
      <li>The new nickname (in this case, nick='oldhag')</li>
      <li>A status code of 303</li>
    </ul>
    <p>This enables the recipients to correlate the old roomnick with the new roomnick.</p>
    <p class="caption"><a name="example-50" id="example-50"></a>Example 50. Service Updates Nick</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='5C1B95B3-7CCC-4422-A952-8885A050BDE9'
    to='crone1@shakespeare.lit/desktop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          nick='oldhag'
          role='participant'/&gt;
    &lt;status code='303'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='B0E6ABD5-575D-42F0-8242-569004D88F73'
    to='wiccarocks@shakespeare.lit/laptop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          nick='oldhag'
          role='participant'/&gt;
    &lt;status code='303'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='DC352437-C019-40EC-B590-AF29E879AF98'
    to='hag66@shakespeare.lit/pda'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          nick='oldhag'
          role='participant'/&gt;
    &lt;status code='303'/&gt;
    &lt;status code='110'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='coven@chat.shakespeare.lit/oldhag'
    id='19E41EB3-3F4C-444F-8A1B-713A8860980C'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='coven@chat.shakespeare.lit/oldhag'
    id='79225CEA-F610-49BE-9B97-FEFA8737185B'
    to='wiccarocks@shakespeare.lit/laptop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='coven@chat.shakespeare.lit/oldhag'
    id='5B4F27A4-25ED-43F7-A699-382C6B4AFC67'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
    &lt;status code='110'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p>If the service modifies the user's nickname in accordance with local service policies, it MUST include a MUC status code of 210 in the presence stanza sent to the user. An example follows (here the service changes the nickname to all lowercase).</p>
    <p class="caption"><a name="example-51" id="example-51"></a>Example 51. Occupant Changes Nickname, Modified by Service</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    id='nx6z2v5'
    to='coven@chat.shakespeare.lit/OldHag'/&gt;

&lt;presence
    from='coven@chat.shakespeare.lit/oldhag'
    id='D0E2B666-3373-42C9-B726-D52C40A48383'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
    &lt;status code='110'/&gt;
    &lt;status code='210'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p>If the user attempts to change his or her room nickname to a room nickname that is already in use by another user (or that is reserved by another user affiliated with the room, e.g., a member or owner), the service MUST deny the nickname change request and inform the user of the conflict; this is done by returning a presence stanza of type "error" specifying a &lt;conflict/&gt; error condition:</p>
    <p class="caption"><a name="example-52" id="example-52"></a>Example 52. Service Denies Nickname Change Because of Nick Conflict</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='ifd1c35'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
    </pre></div>
    <p>However, if the bare JID &lt;localpart@domain.tld&gt; of the present occupant matches the bare JID of the user seeking to change his or her nickname, then the service MAY allow the nickname change. See the <a href="#enter-conflict">Nickname Conflict</a> section of this document for details.</p>
    <p>If the user attempts to change their room nickname but nicknames are "locked down", the service MUST either deny the nickname change request and return a presence stanza of type "error" with a &lt;not-acceptable/&gt; error condition:</p>
    <p class="caption"><a name="example-53" id="example-53"></a>Example 53. Service Denies Nickname Change Because Roomnicks Are Locked Down</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='ifd1c35'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='cancel'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
    </pre></div>
    <p>The user SHOULD then discover its reserved nickname as specified in the <a href="#reservednick">Discovering Reserved Room Nickname</a> section of this document.</p>
  </div>

  <div class="indent"><h3>7.7 <a name="changepres" id="changepres">Changing Availability Status</a></h3>
    <p>In text chat systems such as IRC, one common use for changing one's room nickname is to indicate a change in one's availability (e.g., changing one's room nickname to "thirdwitch|away"). In XMPP, availability is of course noted by a change in presence (specifically the &lt;show/&gt; and &lt;status/&gt; elements), which can provide important context within a chatroom. An occupant changes availability status within the room by sending updated presence to its &lt;room@service/nick&gt;.</p>
    <p class="caption"><a name="example-54" id="example-54"></a>Example 54. Occupant Changes Availability Status</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='wiccarocks@shakespeare.lit/laptop'
    id='kr7v143h'
    to='coven@chat.shakespeare.lit/oldhag'&gt;
  &lt;show&gt;xa&lt;/show&gt;
  &lt;status&gt;gone where the goblins go&lt;/status&gt;
&lt;/presence&gt;
    </pre></div>
    <p>If the room is configured to broadcast presence from entities with the occupant's role, the service then sends a presence stanza from the occupant changing his or her presence to the full JID of each occupant, including extended presence information about the occupant's role and full JID to those with privileges to view such information:</p>
    <p class="caption"><a name="example-55" id="example-55"></a>Example 55. Service Passes Along Changed Presence to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/secondwitch'
    id='86E11ABF-26BC-46F1-AD3B-F5E54F3C1EE5'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;show&gt;xa&lt;/show&gt;
  &lt;status&gt;gone where the goblins go&lt;/status&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
  </div>

  <div class="indent"><h3>7.8 <a name="invite" id="invite">Inviting Another User to a Room</a></h3>

    <p>There are two ways of inviting another user to a room: direct invitations and mediated invitations.</p>
    <p>Direct invitations were the original method used in the early Jabber community's "groupchat 1.0" protocol. Mediated invitations were added in Multi-User Chat as a way to handle invitations in the context of members-only rooms (so that the room could exercise control over the issuance of invitations). The existence of two different invitation methods might cause confusion among client developers. Because the room needs to be involved in the invitation process only for members-only rooms, because members-only rooms are relatively rare, and because mediated invitations do not work when <span class="ref"><a href="http://xmpp.org/extensions/xep-0016.html">Privacy Lists (XEP-0016)</a></span>  [<a href="#nt-idp2214256">19</a>] or similar technologies are used to block communication from entities not in a user's roster, client developers are encouraged to use direct invitations for all other room types.</p>

    <div class="indent"><h3>7.8.1 <a name="invite-direct" id="invite-direct">Direct Invitation</a></h3>
      <p>A method for sending a direct invitation (not mediated by the room itself) is defined in <span class="ref"><a href="http://xmpp.org/extensions/xep-0249.html">Direct MUC Invitations (XEP-0249)</a></span>  [<a href="#nt-idp2216464">20</a>]. Sending the invitation directly can help to work around communications blocking on the part of the invitee (which might reject or discard messages from entities not in its roster).</p>
    </div>

    <div class="indent"><h3>7.8.2 <a name="invite-mediated" id="invite-mediated">Mediated Invitation</a></h3>
      <p>It can be useful to invite another user to a room in which one is an occupant. To send a mediated invitation, a MUC client MUST send XML of the following form to the &lt;room@service&gt; itself (the reason is OPTIONAL and the message MUST be explicitly or implicitly of type "normal"):</p>
      <p class="caption"><a name="example-56" id="example-56"></a>Example 56. Occupant Sends a Mediated Invitation</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='crone1@shakespeare.lit/desktop'
    id='nzd143v8'
    to='coven@chat.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='hecate@shakespeare.lit'&gt;
      &lt;reason&gt;
        Hey Hecate, this is the place for all good witches!
      &lt;/reason&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
&lt;/message&gt;
      </pre></div>
      <p>The &lt;room@service&gt; itself MUST then add a 'from' address to the &lt;invite/&gt; element whose value is the bare JID, full JID, or occupant JID of the inviter and send the invitation to the invitee specified in the 'to' address; the room SHOULD add the password if the room is password-protected):</p>
      <p class="caption"><a name="example-57" id="example-57"></a>Example 57. Room Sends Invitation to Invitee on Behalf of Invitor</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit'
    id='nzd143v8'
    to='hecate@shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite from='crone1@shakespeare.lit/desktop'&gt;
      &lt;reason&gt;
        Hey Hecate, this is the place for all good witches!
      &lt;/reason&gt;
    &lt;/invite&gt;
    &lt;password&gt;cauldronburn&lt;/password&gt;
  &lt;/x&gt;
&lt;/message&gt;
      </pre></div>
      <p>If the room is members-only, the service MAY also add the invitee to the member list. (Note: Invitation privileges in members-only rooms SHOULD be restricted to room admins; if a member without privileges to edit the member list attempts to invite another user, the service SHOULD return a &lt;forbidden/&gt; error to the occupant; for details, see the <a href="#modifymember">Modifying the Member List</a> section of this document.)</p>
      <p>If the inviter supplies a non-existent JID, the room SHOULD return an &lt;item-not-found/&gt; error to the inviter.</p>
      <p>The invitee MAY choose to formally decline (as opposed to ignore) the invitation; and this is something that the sender might want to be informed about. In order to decline the invitation, the invitee MUST send a message of the following form to the &lt;room@service&gt; itself:</p>
      <p class="caption"><a name="example-58" id="example-58"></a>Example 58. Invitee Declines Invitation</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='hecate@shakespeare.lit/broom'
    id='jk2vs61v'
    to='coven@chat.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;decline to='crone1@shakespeare.lit'&gt;
      &lt;reason&gt;
        Sorry, I'm too busy right now.
      &lt;/reason&gt;
    &lt;/decline&gt;
  &lt;/x&gt;
&lt;/message&gt;
      </pre></div>
      <p class="caption"><a name="example-59" id="example-59"></a>Example 59. Room Informs Invitor that Invitation Was Declined</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit'
    id='jk2vs61v'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;decline from='hecate@shakespeare.lit'&gt;
      &lt;reason&gt;
        Sorry, I'm too busy right now.
      &lt;/reason&gt;
    &lt;/decline&gt;
  &lt;/x&gt;
&lt;/message&gt;
      </pre></div>
      <p>It may be wondered why the invitee does not send the decline message directly to the inviter. The main reason is that certain implementations might choose to base invitations on occupant JIDs rather than bare JIDs (so that, for example, an occupant could invite someone from one room to another without knowing that person's bare JID). Thus the service needs to handle both the invites and declines.</p>
    </div>

  </div>

  <div class="indent"><h3>7.9 <a name="continue" id="continue">Converting a One-to-One Chat Into a Multi-User Conference</a></h3>
    <p>Sometimes it is desirable to convert a one-to-one chat into a multi-user conference. The process is as follows.</p>
    <p>First, two users begin a one-to-one chat.</p>
    <p class="caption"><a name="example-60" id="example-60"></a>Example 60. A One-to-One Chat</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='crone1@shakespeare.lit/desktop'
    id='mjs51f36'
    to='wiccarocks@shakespeare.lit/laptop'
    type='chat'&gt;
  &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
  &lt;body&gt;Thrice the brinded cat hath mew'd.&lt;/body&gt;
&lt;/message&gt;

&lt;message
    from='wiccarocks@shakespeare.lit/laptop'
    id='l9ij1f3h'
    to='crone1@shakespeare.lit/desktop'
    type='chat'&gt;
  &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
  &lt;body&gt;Thrice and once the hedge-pig whined.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p>Now the first person decides to include a third person in the discussion, so she does the following:</p>
    <ol start="1">
      <li>Creates a new multi-user chatroom</li>
      <li>Sends history of the one-to-one chat to the room (this is purely discretionary; however, because it might cause information leakage, the client ought to warn the user before doing so)</li>
      <li>Sends an invitation to the second person and the third person, including a &lt;continue/&gt; element (optionally including a 'thread' attribute).</li> 
    </ol>
    <p>Note: The new room SHOULD be non-anonymous and MAY be an instant room as specified in the <a href="#createroom-instant">Creating an Instant Room</a> section of this document.</p>
    <p>Note: If the one-to-one chat messages included a &lt;thread/&gt; element, the person who creates the room SHOULD include the ThreadID with the history messages, specify the ThreadID in the invitations as the value of the &lt;continue/&gt; element's 'thread' attribute, and include the ThreadID in any new messages sent to the room. Use of ThreadIDs is RECOMMENDED because it helps to provide continuity between the one-to-one chat and the multi-user chat.</p>
    <p class="caption"><a name="example-61" id="example-61"></a>Example 61. Continuing the Discussion I: User Creates Room</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='crone1@shakespeare.lit/desktop'
    to='coven@chat.shakespeare.lit/firstwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;

&lt;presence
    from='coven@chat.shakespeare.lit/firstwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner' role='moderator'/&gt;
    &lt;status code='110'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p class="caption"><a name="example-62" id="example-62"></a>Example 62. Continuing the Discussion II: Owner Sends History to Room</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='crone1@shakespeare.lit/desktop'
    id='b4va73n0'
    to='coven@chat.shakespeare.lit'
    type='groupchat'&gt;
  &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
  &lt;body&gt;Thrice the brinded cat hath mew'd.&lt;/body&gt;
  &lt;delay xmlns='urn:xmpp:delay'
     from='crone1@shakespeare.lit/desktop'
     stamp='2004-09-29T01:54:37Z'/&gt;
&lt;/message&gt;

&lt;message
    from='crone1@shakespeare.lit/desktop'
    id='i4hs759k'
    to='coven@chat.shakespeare.lit'
    type='groupchat'&gt;
  &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
  &lt;body&gt;Thrice and once the hedge-pig whined.&lt;/body&gt;
  &lt;delay xmlns='urn:xmpp:delay'
     from='crone1@shakespeare.lit/desktop'
     stamp='2004-09-29T01:55:21Z'/&gt;
&lt;/message&gt;
    </pre></div>
    <p>Note: Use of the <span class="ref">Delayed Delivery</span> protocol enables the room creator to specify the datetime of each message from the one-to-one chat history (via the 'stamp' attribute), as well as the JID of the original sender of each message (via the 'from' attribute); note well that the 'from' here is not the room itself, since the originator of the message is the delaying party. The room creator might send the complete one-to-one chat history before inviting additional users to the room, and also send as history any messages appearing in the one-to-one chat interface after joining the room and before the second person joins the room; if the one-to-one history is especially large, the sending client might want to send the history over a few seconds rather than all at once (to avoid triggering rate limits). The service SHOULD NOT add its own delay elements (as described in the <a href="#enter-history">Discussion History</a> section of this document) to prior chat history messages received from the room owner.</p>
    <p class="caption"><a name="example-63" id="example-63"></a>Example 63. Continuing the Discussion III: Owner Sends Invitations, Including Continue Flag</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='crone1@shakespeare.lit/desktop'
    id='gl3s85n7'
    to='coven@chat.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='wiccarocks@shakespeare.lit/laptop'&gt;
      &lt;reason&gt;This coven needs both wiccarocks and hag66.&lt;/reason&gt;
      &lt;continue thread='e0ffe42b28561960c6b12b944a092794b9683a38'/&gt;
    &lt;/invite&gt;
    &lt;invite to='hag66@shakespeare.lit'&gt;
      &lt;reason&gt;This coven needs both wiccarocks and hag66.&lt;/reason&gt;
      &lt;continue thread='e0ffe42b28561960c6b12b944a092794b9683a38'/&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p>Note: Since the inviter's client knows the full JID of the person with whom the inviter was having a one-to-one chat, it SHOULD include the full JID (rather than the bare JID) in its invitation to that user.</p>
    <p>The invitations are delivered to the invitees:</p>
    <p class="caption"><a name="example-64" id="example-64"></a>Example 64. Invitations Delivered</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit/firstwitch'
    id='DB0414CB-AFBA-407E-9DE3-0E014E84860F'
    to='wiccarocks@shakespeare.lit/laptop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite from='crone1@shakespeare.lit'&gt;
      &lt;reason&gt;This coven needs both wiccarocks and hag66.&lt;/reason&gt;
      &lt;continue thread='e0ffe42b28561960c6b12b944a092794b9683a38'/&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
&lt;/message&gt;

&lt;message
    from='coven@chat.shakespeare.lit/firstwitch'
    id='89028D79-AB4C-44C0-BE81-B07607C2F4C2'
    to='hag66@shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite from='crone1@shakespeare.lit'&gt;
      &lt;reason&gt;This coven needs both wiccarocks and hag66.&lt;/reason&gt;
      &lt;continue thread='e0ffe42b28561960c6b12b944a092794b9683a38'/&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p>When the client being used by &lt;wiccarocks@shakespeare.lit/laptop&gt; receives the invitation, it can either auto-join the room or prompt the user whether to join (subject to user preferences) and then seamlessly convert the existing one-to-one chat window into a multi-user conferencing window:</p>
    <p class="caption"><a name="example-65" id="example-65"></a>Example 65. Invitee Accepts Invitation, Joins Room, and Receives Presence and History</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='wiccarocks@shakespeare.lit/laptop'
    to='coven@chat.shakespeare.lit/secondwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;

&lt;presence
    from='coven@chat.shakespeare.lit/firstwitch'
    to='wiccarocks@shakespeare.lit/laptop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner' role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='coven@chat.shakespeare.lit/secondwitch'
    to='wiccarocks@shakespeare.lit/laptop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;message
    from='coven@chat.shakespeare.lit'
    id='67268D36-100C-457D-A769-8A3663BD1949'
    to='wiccarocks@shakespeare.lit/laptop'
    type='groupchat'&gt;
  &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
  &lt;body&gt;Thrice the brinded cat hath mew'd.&lt;/body&gt;
  &lt;delay xmlns='urn:xmpp:delay'
     from='coven@chat.shakespeare.lit'
     stamp='2004-09-29T01:54:37Z'/&gt;
&lt;/message&gt;

&lt;message
    from='coven@chat.shakespeare.lit'
    id='367DCF6B-0CB4-482D-A142-C0B9E08016B5'
    to='wiccarocks@shakespeare.lit/laptop'
    type='groupchat'&gt;
  &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
  &lt;body&gt;Thrice and once the hedge-pig whined.&lt;/body&gt;
  &lt;delay xmlns='urn:xmpp:delay'
     from='coven@chat.shakespeare.lit'
     stamp='2004-09-29T01:55:21Z'/&gt;
&lt;/message&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>7.10 <a name="register" id="register">Registering with a Room</a></h3>
    <p>An implementation MAY allow an unaffiliated user (in a moderated room, normally a participant) to register with a room; as a result, the user will become a member of the room and will have their preferred nickname reserved in the room. (Conversely, an implementation MAY restrict this privilege and allow only room admins to add new members.) In particular, it is not possible to join a members-only room without being on the member list, so an entity might need to request membership in order to join such a room.</p>
    <p>If allowed, this functionality SHOULD be implemented by enabling a user to send a request for registration requirements to the room qualified by the 'jabber:iq:register' namespace as described in <span class="ref"><a href="http://xmpp.org/extensions/xep-0077.html">In-Band Registration (XEP-0077)</a></span>  [<a href="#nt-idp2253824">21</a>]:</p>
    <p class="caption"><a name="example-66" id="example-66"></a>Example 66. User Requests Registration Requirements</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/pda'
    id='jw81b36f'
    to='coven@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='jabber:iq:register'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the room does not exist, the service MUST return an &lt;item-not-found/&gt; error.</p>
    <p class="caption"><a name="example-67" id="example-67"></a>Example 67. Room Does Not Exist</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='jw81b36f'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the user requesting registration requirements is not allowed to register with the room (e.g., because that privilege has been restricted), the room MUST return a &lt;not-allowed/&gt; error to the user.</p>
    <p class="caption"><a name="example-68" id="example-68"></a>Example 68. User Is Not Allowed to Register</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='jw81b36f'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the user is already registered, as described in <span class="ref">XEP-0077</span> the room MUST reply with an IQ stanza of type "result", which MUST contain an empty &lt;registered/&gt; element and SHOULD contain at least a &lt;username/&gt; element that specifies the user's registered nickname in the room.</p>
    <p class="caption"><a name="example-69" id="example-69"></a>Example 69. User Is Already Registered</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='jw81b36f'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;registered/&gt;
    &lt;username&gt;thirdwitch&lt;/username&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Otherwise, the room MUST then return a Data Form to the user (as described in <span class="ref"><a href="http://xmpp.org/extensions/xep-0004.html">Data Forms (XEP-0004)</a></span>  [<a href="#nt-idp2262800">22</a>]). The information required to register might vary by implementation or deployment and is not fully specified in this document (e.g., the fields registered by this document for the 'http://jabber.org/protocol/muc#register' FORM_TYPE might be supplemented in the future via the mechanisms described in the <a href="#registrar-formtype">Field Standardization</a> section of this document). The following can be taken as a fairly typical example:</p>
    <p class="caption"><a name="example-70" id="example-70"></a>Example 70. Service Returns Registration Form</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='jw81b36f'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;instructions&gt;
      To register on the web, visit http://shakespeare.lit/
    &lt;/instructions&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;title&gt;Dark Cave Registration&lt;/title&gt;
      &lt;instructions&gt;
        Please provide the following information
        to register with this room.
      &lt;/instructions&gt;
      &lt;field
          type='hidden'
          var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#register&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Given Name'
          type='text-single'
          var='muc#register_first'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field
          label='Family Name'
          type='text-single'
          var='muc#register_last'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field
          label='Desired Nickname'
          type='text-single'
          var='muc#register_roomnick'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field
          label='Your URL'
          type='text-single'
          var='muc#register_url'/&gt;
      &lt;field
          label='Email Address'
          type='text-single'
          var='muc#register_email'/&gt;
      &lt;field
          label='FAQ Entry'
          type='text-multi'
          var='muc#register_faqentry'/&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The user SHOULD then submit the form:</p>
    <p class="caption"><a name="example-71" id="example-71"></a>Example 71. User Submits Registration Form</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/pda'
    id='nv71va54'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;x xmlns='jabber:x:data' type='submit'&gt;
      &lt;field var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#register&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_first'&gt;
        &lt;value&gt;Brunhilde&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_last'&gt;
        &lt;value&gt;Entwhistle-Throckmorton&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_roomnick'&gt;
        &lt;value&gt;thirdwitch&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_url'&gt;
        &lt;value&gt;http://witchesonline/~hag66/&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_email'&gt;
        &lt;value&gt;hag66@witchesonline&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_faqentry'&gt;
        &lt;value&gt;Just another witch.&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the desired room nickname is already reserved for that room, the room MUST return a &lt;conflict/&gt; error to the user:</p>
    <p class="caption"><a name="example-72" id="example-72"></a>Example 72. Room Returns Conflict Error to User</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='nv71va54'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the room or service does not support registration, it MUST return a &lt;service-unavailable/&gt; error to the user:</p>
    <p class="caption"><a name="example-73" id="example-73"></a>Example 73. Room Returns Service Unavailable Error to User</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='nv71va54'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the user did not include a valid data form, the room MUST return a &lt;bad-request/&gt; error to the user:</p>
    <p class="caption"><a name="example-74" id="example-74"></a>Example 74. Room Returns Service Bad Request Error to User</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='nv71va54'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Otherwise, the room MUST inform the user that the registration request was successfully received:</p>
    <p class="caption"><a name="example-75" id="example-75"></a>Example 75. Room Informs User that Registration Request Has Been Processed</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='nv71va54'
    to='hag66@shakespeare.lit/pda'
    type='result'/&gt;
    </pre></div>
    <p>After the user submits the form, the service MAY request that the submission be approved by a room admin/owner (see the <a href="#regapprove">Approving Registration Requests</a> section of this document), MAY immediately add the user to the member list by changing the user's affiliation from "none" to "member", or MAY perform some service-specific checking (e.g., email verification).</p>
    <p>If the service changes the user's affiliation and the user is in the room, it MUST send updated presence from this individual to all occupants, indicating the change in affiliation by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "member".</p>
    <p class="caption"><a name="example-76" id="example-76"></a>Example 76. Service Sends Notice of Membership to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>If the user's nickname is modified by the service as a result of registration and the user is in the room, the service SHOULD include status code "210" in the updated presence notification that it sends to all users.</p>
    <p>If a user has registered with a room, the room MAY choose to restrict the user to use of the registered nickname only in that room. If it does so, it SHOULD modify the user's nickname to be the registered nickname (instead of returning a &lt;not-acceptable/&gt; error) if the user attempts to join the room with a roomnick other than the user's registered roomnick (this enables a room to "lock down" roomnicks for consistent identification of occupants).</p>
  </div>

  <div class="indent"><h3>7.11 <a name="getmemberlist" id="getmemberlist">Getting the Member List</a></h3>
    <p>If allowed in accordance with room configuration, an occupant MAY be allowed to retrieve the list of room members. For details, see the <a href="#modifymember">Modifying the Member List</a> section of this document.</p>
  </div>

  <div class="indent"><h3>7.12 <a name="reservednick" id="reservednick">Discovering Reserved Room Nickname</a></h3>
    <p>A user MAY have a reserved room nickname, for example through explicit room registration, database integration, or nickname "lockdown". A user SHOULD discover his or her reserved nickname before attempting to enter the room. This is done by sending a Service Discovery information request to the room JID while specifying a well-known Service Discovery node of "x-roomuser-item".</p>
    <p class="caption"><a name="example-77" id="example-77"></a>Example 77. User Requests Reserved Nickname</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/pda'
    id='getnick1'
    to='coven@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='x-roomuser-item'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p>It is OPTIONAL for a multi-user chat service to support the foregoing service discovery node. If the room or service does not support the foregoing service discovery node, it MUST return a &lt;feature-not-implemented/&gt; error to the user. If it does and the user has a registered nickname, it MUST return the nickname to the user as the value of the 'name' attribute of a Service Discovery &lt;identity/&gt; element (for which the category/type SHOULD be "conference/text"):</p>
    <p class="caption"><a name="example-78" id="example-78"></a>Example 78. Room Returns Nickname</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='getnick1'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='x-roomuser-item'&gt;
    &lt;identity
        category='conference'
        name='thirdwitch'
        type='text'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the user does not have a registered nickname, the room MUST return a service discovery &lt;query/&gt; element that is empty (in accordance with <span class="ref">XEP-0030</span>).</p>
    <p>Even if a user has registered one room nickname, the service SHOULD allow the user to specify a different nickname on entering the room (e.g., in order to join from different client resources), although the service MAY choose to "lock down" nicknames and therefore deny entry to the user, including a &lt;not-acceptable/&gt; error. The service MUST NOT return an error to the user if his or her client sends the foregoing request after having already joined the room, but instead SHOULD reply as previously described.</p>
    <p>If another user attempts to join the room with a nickname reserved by the first user, the service MUST deny entry to the second user and return a &lt;conflict/&gt; error as previously described.</p>
  </div>

  <div class="indent"><h3>7.13 <a name="requestvoice" id="requestvoice">Requesting Voice</a></h3>
    <p>It is not possible for a visitor to speak (i.e., send a message to all occupants) in a moderated room. To request voice, a visitor SHOULD send a &lt;message/&gt; stanza containing a data form to the room itself, where the data form contains only a "muc#role" field with a value of "participant".</p>
    <p class="caption"><a name="example-79" id="example-79"></a>Example 79. Occupant Requests Voice</p><div class="indent"><pre class="prettyprint">
&lt;message from='hag66@shakespeare.lit/pda'
         id='yd53c486'
         to='coven@chat.shakespeare.lit'&gt;
  &lt;x xmlns='jabber:x:data' type='submit'&gt;
    &lt;field var='FORM_TYPE'&gt;
      &lt;value&gt;http://jabber.org/protocol/muc#request&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#role'
           type='text-single'
           label='Requested role'&gt;
      &lt;value&gt;participant&lt;/value&gt;
    &lt;/field&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p>The service then proceeds as described in the <a href="#voiceapprove">Approving Voice Requests</a> section of this document.</p>
  </div>

  <div class="indent"><h3>7.14 <a name="exit" id="exit">Exiting a Room</a></h3>
    <p>In order to exit a multi-user chat room, an occupant sends a presence stanza of type "unavailable" to the &lt;room@service/nick&gt; it is currently using in the room.</p>
    <p class="caption"><a name="example-80" id="example-80"></a>Example 80. Occupant Exits a Room</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='hag66@shakespeare.lit/pda'
    to='coven@chat.shakespeare.lit/thirdwitch'
    type='unavailable'/&gt;
    </pre></div>
    <p>The service MUST then send a presence stanzas of type "unavailable" from the departing user's occupant JID to the departing occupant's full JIDs, including a status code of "110" to indicate that this notification is "self-presence":</p>
    <p class="caption"><a name="example-81" id="example-81"></a>Example 81. Service Sends Self-Presence Related to Departure of Occupant</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='hag66@shakespeare.lit/pda'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' 
          jid='hag66@shakespeare.lit/pda'
          role='none'/&gt;
    &lt;status code='110'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p>Note: The presence stanza used to exit a room MUST possess a 'type' attribute whose value is "unavailable". For further discussion, see the <a href="#bizrules-presence">Presence</a> business rules.</p>
    <p>The service MUST then send presence stanzas of type "unavailable" from the departing user's occupant JID to the full JIDs of the remaining occupants:</p>
    <p class="caption"><a name="example-82" id="example-82"></a>Example 82. Service Sends Presence Related to Departure of Occupant</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='hag66@shakespeare.lit/pda'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' 
          jid='hag66@shakespeare.lit/pda'
          role='none'/&gt;
    &lt;status code='110'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' 
          jid='hag66@shakespeare.lit/pda'
          role='none'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='wiccarocks@shakespeare.lit/laptop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' 
          jid='hag66@shakespeare.lit/pda'
          role='none'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p>Presence stanzas of type "unavailable" reflected by the room MUST contain extended presence information about roles and affiliations; in particular, the 'role' attribute MUST be set to a value of "none" to denote that the individual is no longer an occupant.</p>
    <p>The occupant MAY include normal &lt;status/&gt; information in the unavailable presence stanzas; this enables the occupant to provide a custom exit message if desired:</p>
    <p class="caption"><a name="example-83" id="example-83"></a>Example 83. Custom Exit Message</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='wiccarocks@shakespeare.lit/laptop'
    to='coven@chat.shakespeare.lit/oldhag'
    type='unavailable'&gt;
  &lt;status&gt;gone where the goblins go&lt;/status&gt;
&lt;/presence&gt;
    </pre></div>
    <p>Normal presence stanza generation rules apply as defined in <span class="ref"><a href="http://tools.ietf.org/html/rfc6121">XMPP IM</a></span>  [<a href="#nt-idp2303536">23</a>], so that if the user sends a general unavailable presence stanza, the user's server will broadcast that stanza to the client's &lt;room@service/nick&gt;; as a result, there is no need for the leaving client to send directed unavailable presence to its occupant JID. It is possible that a user might not be able to gracefully exit the room by sending unavailable presence. If the user goes offline without sending unavailable presence, the user's server is responsible for sending unavailable presence on behalf of the user (in accordance with <span class="ref">RFC 6121</span>).</p>
    <p>Note: See <a href="#impl-service-ghosts">Ghost Users</a> for suggestions regarding room occupants that appear to be present in the room but that are actually offline.</p>
    <p>Note: If the room is not persistent and this occupant is the last to exit, the service is responsible for destroying the room.</p>
  </div>

<h2>8.
       <a name="moderator" id="moderator">Moderator Use Cases</a></h2>
  <p>A moderator has privileges to perform certain actions within the room (e.g., to change the roles of some occupants) but does not have rights to change persistent information about affiliations (which can be changed only by an admin or owner) or the room configuration. Exactly which actions can be performed by a moderator is subject to configuration. However, for the purposes of the MUC framework, moderators are stipulated to have privileges to perform the following actions:</p>
  <ol start="1">
    <li>discover an occupant's full JID in a semi-anonymous room (occurs automatically through presence)</li>
    <li>modify the subject</li>
    <li>kick a participant or visitor from the room</li>
    <li>grant or revoke voice in a moderated room</li>
    <li>modify the list of occupants who have voice in a moderated room</li>
  </ol>
  <p>These features are implemented with a request/response exchange using &lt;iq/&gt; elements that contain child elements qualified by the 'http://jabber.org/protocol/muc#admin' namespace. The examples below illustrate the protocol interactions to implement the desired functionality. (Except where explicitly noted below, any of the following administrative requests MUST be denied if the &lt;user@host&gt; of the 'from' address of the request does not match the bare JID portion of one of the moderators; in this case, the service MUST return a &lt;forbidden/&gt; error.)</p>

  <div class="indent"><h3>8.1 <a name="subject-mod" id="subject-mod">Modifying the Room Subject</a></h3>
    <p>A common feature of multi-user chat rooms is the ability to change the subject within the room.</p>
    <p>By default, only users with a role of "moderator" SHOULD be allowed to change the subject in a room (although this is configurable, with the result that a mere participant or even visitor might be allowed to change the subject, as controlled by the "muc#roomconfig_changesubject" option).</p>
    <p>The subject is changed by sending a message of type "groupchat" to the &lt;room@service&gt;, where the &lt;message/&gt; MUST contain a &lt;subject/&gt; element that specifies the new subject but MUST NOT contain a &lt;body/&gt; element (or a &lt;thread/&gt; element). In accordance with the core definition of XMPP, other child elements are allowed (although the entity that receives them might ignore them).</p>
    <p>Note: A message with a &lt;subject/&gt; and a &lt;body/&gt; or a &lt;subject/&gt; and a &lt;thread/&gt; is a legitimate message, but it SHALL NOT be interpreted as a subject change.</p>
    <p class="caption"><a name="example-84" id="example-84"></a>Example 84. Moderator Changes Subject</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='wiccarocks@shakespeare.lit/laptop'
    id='lh2bs617'
    to='coven@chat.shakespeare.lit'
    type='groupchat'&gt;
  &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;
&lt;/message&gt;
    </pre></div>
    <p>The MUC service MUST reflect the message to all other occupants with a 'from' address equal to the room JID or to the occupant JID that corresponds to the sender of the subject change:</p>
    <p class="caption"><a name="example-85" id="example-85"></a>Example 85. Service Informs All Occupants of Subject Change</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit/secondwitch'
    id='5BCE07C5-0729-4353-A6A3-ED9818C9B498'
    to='crone1@shakespeare.lit/desktop'
    type='groupchat'&gt;
  &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;
&lt;/message&gt;

[ ... ]
    </pre></div>
    <p>As explained under <a href="#enter-history"></a>, when a new occupant joins the room the room SHOULD include the last subject change after the discussion history.</p>
    <p>A MUC client that receives such a message MAY choose to display an in-room message, such as the following:</p>
    <p class="caption"><a name="example-86" id="example-86"></a>Example 86. Client Displays Room Subject Change Message</p><div class="indent"><pre class="prettyprint">
* secondwitch has changed the subject to: Fire Burn and Cauldron Bubble!
    </pre></div>
    <p>If someone without appropriate privileges attempts to change the room subject, the service MUST return a message of type "error" specifying a &lt;forbidden/&gt; error condition:</p>
    <p class="caption"><a name="example-87" id="example-87"></a>Example 87. Service Returns Error Related to Unauthorized Subject Change</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit/thirdwitch'
    id='lh2bs617'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/message&gt;
    </pre></div>
    <p>In order to remove the existing subject but not provide a new subject (i.e., set the subject to be empty), the client shall send an empty &lt;subject/&gt; element (i.e., either "&lt;subject/&gt;" or "&lt;subject&gt;&lt;/subject&gt;").</p>
    <p class="caption"><a name="example-88" id="example-88"></a>Example 88. Moderator Sets Empty Subject</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='wiccarocks@shakespeare.lit/laptop'
    id='uj3bs61g'
    to='coven@chat.shakespeare.lit'
    type='groupchat'&gt;
  &lt;subject&gt;&lt;/subject&gt;
&lt;/message&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>8.2 <a name="kick" id="kick">Kicking an Occupant</a></h3>
    <p>A moderator has permissions kick certain kinds of occupants from a room (which occupants are "kickable" depends on service provisioning, room configuration, and the moderator's affiliation -- see below). The kick is performed based on the occupant's room nickname and is completed by setting the role of a participant or visitor to a value of "none".</p>
    <p class="caption"><a name="example-89" id="example-89"></a>Example 89. Moderator Kicks Occupant</p><div class="indent"><pre class="prettyprint">
&lt;iq from='fluellen@shakespeare.lit/pda'
    id='kick1'
    to='harfleur@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='pistol' role='none'&gt;
      &lt;reason&gt;Avaunt, you cullion!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST remove the kicked occupant by sending a presence stanza of type "unavailable" to each kicked occupant, including status code 307 in the extended presence information, optionally along with the reason (if provided) and the roomnick or bare JID of the user who initiated the kick.</p>
    <p class="caption"><a name="example-90" id="example-90"></a>Example 90. Service Removes Kicked Occupant</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='harfleur@chat.shakespeare.lit/pistol'
    to='pistol@shakespeare.lit/harfleur'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'&gt;
      &lt;actor nick='Fluellen'/&gt;
      &lt;reason&gt;Avaunt, you cullion!&lt;/reason&gt;
    &lt;/item&gt;
    &lt;status code='307'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p>The inclusion of the status code assists clients in presenting their own notification messages (e.g., information appropriate to the user's locality). The optional inclusion of the reason and actor enable the kicked user to understand why he or she was kicked, and by whom if the kicked occupant would like to discuss the matter.  [<a href="#nt-idp2328432">24</a>]</p>
    <p>After removing the kicked occupant(s), the service MUST then inform the moderator of success:</p>
    <p class="caption"><a name="example-91" id="example-91"></a>Example 91. Service Informs Moderator of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='harfleur@chat.shakespeare.lit'
    id='kick1'
    to='fluellen@shakespeare.lit/pda'
    type='result'/&gt;
    </pre></div>
    <p>After informing the moderator, the service MUST then inform all of the remaining occupants that the kicked occupant is no longer in the room by sending presence stanzas of type "unavailable" from the individual's roomnick (&lt;room@service/nick&gt;) to all the remaining occupants (just as it does when occupants exit the room of their own volition), including the status code and optionally the reason and actor.</p>
    <p class="caption"><a name="example-92" id="example-92"></a>Example 92. Service Informs Remaining Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='harfleur@chat.shakespeare.lit/pistol'
    to='gower@shakespeare.lit/cell'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'/&gt;
    &lt;status code='307'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>A user cannot be kicked by a moderator with a lower affiliation. Therefore, if a moderator who is a participant attempts to kick an admin or a moderator who is a participant or admin attempts to kick an owner, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender:</p>
    <p class="caption"><a name="example-93" id="example-93"></a>Example 93. Service Returns Error on Attempt to Kick User With Higher Affiliation</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='kicktest'
    to='wiccarocks@shakespeare.lit/laptop'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If a moderator attempts to kick himself, the service MAY deny the request and return a &lt;conflict/&gt; error to the sender. (Although the act of kicking oneself may seem odd, it is common in IRC as a way of apologizing for one's actions in the room.)</p>
  </div>

  <div class="indent"><h3>8.3 <a name="grantvoice" id="grantvoice">Granting Voice to a Visitor</a></h3>
    <p>In a moderated room, a moderator might want to manage who does and does not have "voice" in the room (i.e., the ability to send messages to all occupants). Voice is granted based on the visitor's room nickname, which the service will convert into the visitor's full JID internally. The moderator grants voice to a visitor by changing the visitor's role to "participant".</p>
    <p class="caption"><a name="example-94" id="example-94"></a>Example 94. Moderator Grants Voice to a Visitor</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='voice1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='participant'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL:</p>
    <p class="caption"><a name="example-95" id="example-95"></a>Example 95. Moderator Grants Voice to a Visitor (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='voice1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='participant'&gt;
      &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST then inform the moderator of success:</p>
    <p class="caption"><a name="example-96" id="example-96"></a>Example 96. Service Informs Moderator of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='voice1'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST then send updated presence from this individual's &lt;room@service/nick&gt; to all occupants, indicating the addition of voice privileges by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'role' attribute set to a value of "participant".</p>
    <p class="caption"><a name="example-97" id="example-97"></a>Example 97. Service Sends Notice of Voice to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          nick='thirdwitch'
          role='participant'&gt;
      &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
  </div>

  <div class="indent"><h3>8.4 <a name="revokevoice" id="revokevoice">Revoking Voice from a Participant</a></h3>
    <p>In a moderated room, a moderator might want to revoke a participant's privileges to speak. The moderator can revoke voice from a participant by changing the participant's role to "visitor":</p>
    <p class="caption"><a name="example-98" id="example-98"></a>Example 98. Moderator Revokes Voice from a Participant</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='voice2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='visitor'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL:</p>
    <p class="caption"><a name="example-99" id="example-99"></a>Example 99. Moderator Revokes Voice from a Visitor (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='voice2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='visitor'&gt;
      &lt;reason&gt;Not so worthy after all!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST then inform the moderator of success:</p>
    <p class="caption"><a name="example-100" id="example-100"></a>Example 100. Service Informs Moderator of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='voice2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST then send updated presence from this individual to all occupants, indicating the removal of voice privileges by sending a presence element that contains an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'role' attribute set to a value of "visitor".</p>
    <p class="caption"><a name="example-101" id="example-101"></a>Example 101. Service Notes Loss of Voice</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='visitor'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>A moderator MUST NOT be able to revoke voice from a user whose affiliation is at or above the moderator's level. In addition, a service MUST NOT allow the voice privileges of an admin or owner to be removed by anyone. If a moderator attempts to revoke voice privileges from such a user, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender along with the offending item(s):</p>
    <p class="caption"><a name="example-102" id="example-102"></a>Example 102. Service Returns Error on Attempt to Revoke Voice from an Admin, Owner, or User with a Higher Affiliation</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='voicetest'
    to='crone1@shakespeare.lit/desktop'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>8.5 <a name="modifyvoice" id="modifyvoice">Modifying the Voice List</a></h3>
    <p>A moderator in a moderated room might want to modify the voice list. To do so, the moderator first requests the voice list by querying the room for all occupants with a role of 'participant'.</p>
    <p class="caption"><a name="example-103" id="example-103"></a>Example 103. Moderator Requests Voice List</p><div class="indent"><pre class="prettyprint">
&lt;iq from='bard@shakespeare.lit/globe'
    id='voice3'
    to='goodfolk@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item role='participant'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST then return the voice list to the moderator; each item MUST include the 'nick' and 'role' attributes and SHOULD include the 'affiliation' and 'jid' attributes:</p>
    <p class="caption"><a name="example-104" id="example-104"></a>Example 104. Service Sends Voice List to Moderator</p><div class="indent"><pre class="prettyprint">
&lt;iq from='goodfolk@chat.shakespeare.lit'
    id='voice3'
    to='bard@shakespeare.lit/globe'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          jid='polonius@hamlet/castle'
          nick='Polo'
          role='participant'/&gt;
    &lt;item affiliation='none'
          jid='horatio@hamlet/castle'
          nick='horotoro'
          role='participant'/&gt;
    &lt;item affiliation='member'
          jid='hecate@shakespeare.lit/broom'
          nick='Hecate'
          role='participant'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The moderator can then modify the voice list if desired. In order to do so, the moderator MUST send the changed items (i.e., only the "delta") back to the service; each item MUST include the 'nick' attribute and 'role' attribute (normally set to a value of "participant" or "visitor") but SHOULD NOT include the 'jid' attribute and MUST NOT include the 'affiliation' attribute (which is used to manage affiliations such as owner rather than the participant role):</p>
    <p class="caption"><a name="example-105" id="example-105"></a>Example 105. Moderator Sends Modified Voice List to Service</p><div class="indent"><pre class="prettyprint">
&lt;iq from='bard@shakespeare.lit/globe'
    id='voice4'
    to='goodfolk@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='Hecate'
          role='visitor'/&gt;
    &lt;item nick='rosencrantz'
          role='participant'&gt;
      &lt;reason&gt;A worthy fellow.&lt;/reason&gt;
    &lt;/item&gt;
    &lt;item nick='guildenstern'
          role='participant'&gt;
      &lt;reason&gt;A worthy fellow.&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST then inform the moderator of success:</p>
    <p class="caption"><a name="example-106" id="example-106"></a>Example 106. Service Informs Moderator of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='goodfolk@chat.shakespeare.lit'
    id='voice1'
    to='bard@shakespeare.lit/globe'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST then send updated presence for any affected individuals to all occupants, indicating the change in voice privileges by sending the appropriate extended presence stanzas as described in the foregoing use cases.</p>
    <p>As noted, voice privileges cannot be revoked from a room owner or room admin, nor from any user with a higher affiliation than the moderator making the request. If a room admin attempts to revoke voice privileges from such a user by modifying the voice list, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender:</p>
    <p class="caption"><a name="example-107" id="example-107"></a>Example 107. Service Returns Error on Attempt to Revoke Voice from an Admin, Owner, or User with a Higher Affiliation</p><div class="indent"><pre class="prettyprint">
&lt;iq from='goodfolk@chat.shakespeare.lit'
    id='voicetest'
    to='bard@shakespeare.lit/globe'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>8.6 <a name="voiceapprove" id="voiceapprove">Approving Voice Requests</a></h3>
    <p>As noted in the <a href="#requestvoice">Requesting Voice</a> section of this document, an occupant requests voice by sending a voice request data form to the service. The service then SHOULD use that voice request data form as the basis for a voice approval data form that it generates and sends to the room moderator(s). The voice approval data form is contained in a &lt;message/&gt; stanza, as shown below.</p>
    <p class="caption"><a name="example-108" id="example-108"></a>Example 108. Voice Request Approval Form</p><div class="indent"><pre class="prettyprint">
&lt;message from='coven@chat.shakespeare.lit'
         id='approve'
         to='crone1@shakespeare.lit/pda'&gt;
  &lt;x xmlns='jabber:x:data' type='form'&gt;
    &lt;title&gt;Voice request&lt;/title&gt;
    &lt;instructions&gt;
      To approve this request for voice, select 
      the &amp;quot;Grant voice to this person?&amp;quot;
      checkbox and click OK. To skip this request, 
      click the cancel button.
    &lt;/instructions&gt;
    &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#request&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#role'
           type='text-single'
           label='Requested role'&gt;
      &lt;value&gt;participant&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#jid'
           type='jid-single'
           label='User ID'&gt;
      &lt;value&gt;hag66@shakespeare.lit/pda&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#roomnick'
           type='text-single'
           label='Room Nickname'&gt;
      &lt;value&gt;thirdwitch&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#request_allow'
           type='boolean'
           label='Grant voice to this person?'&gt;
      &lt;value&gt;false&lt;/value&gt;
    &lt;/field&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p>In order to approve the request, a moderator shall submit the form:</p>
    <p class="caption"><a name="example-109" id="example-109"></a>Example 109. Voice Request Approval Submission</p><div class="indent"><pre class="prettyprint">
&lt;message from='crone1@shakespeare.lit/pda'
         id='approve'
         to='coven@chat.shakespeare.lit'&gt;
  &lt;x xmlns='jabber:x:data' type='submit'&gt;
    &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#request&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#role'&gt;
      &lt;value&gt;participant&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#jid'&gt;
      &lt;value&gt;hag66@shakespeare.lit/pda&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#roomnick'&gt;
      &lt;value&gt;thirdwitch&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#request_allow'&gt;
      &lt;value&gt;true&lt;/value&gt;
    &lt;/field&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p>If a moderator approves the voice request, the service shall grant voice to the occupant and send a presence update as described in the <a href="#grantvoice">Granting Voice to a Visitor</a> section of this document.</p>
  </div>

<h2>9.
       <a name="admin" id="admin">Admin Use Cases</a></h2>
  <p>A room administrator has privileges to modify persistent information about user affiliations (e.g., by banning users) and to grant and revoke moderator status, but does not have rights to change the room configuration, which is the sole province of the room owner(s). Exactly which actions can be performed by a room admin is subject to configuration. However, for the purposes of the MUC framework, room admins are stipulated to at a minimum have privileges to perform the following actions:</p>
  <ol start="1">
    <li>ban a user from the room</li>
    <li>modify the list of users who are banned from the room</li>
    <li>grant or revoke membership</li>
    <li>modify the member list</li>
    <li>grant or revoke moderator status</li>
    <li>modify the list of moderators</li>
  </ol>
  <p>These features are implemented with a request/response exchange using &lt;iq/&gt; elements that contain child elements qualified by the 'http://jabber.org/protocol/muc#admin' namespace. The examples below illustrate the protocol interactions that implement the desired functionality. (Except where explicitly noted below, any of the following administrative requests MUST be denied if the &lt;user@host&gt; of the 'from' address of the request does not match the bare JID of one of the room admins; in this case, the service MUST return a &lt;forbidden/&gt; error.)</p>
  <div class="indent"><h3>9.1 <a name="ban" id="ban">Banning a User</a></h3>
    <p>An admin or owner can ban one or more users from a room. The ban MUST be performed based on the occupant's bare JID. In order to ban a user, an admin MUST change the user's affiliation to "outcast".</p>
    <p class="caption"><a name="example-110" id="example-110"></a>Example 110. Admin Bans User</p><div class="indent"><pre class="prettyprint">
&lt;iq from='kinghenryv@shakespeare.lit/throne'
    id='ban1'
    to='southampton@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'
          jid='earlofcambridge@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL.</p>
    <p class="caption"><a name="example-111" id="example-111"></a>Example 111. Admin Bans User (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='kinghenryv@shakespeare.lit/throne'
    id='ban1'
    to='southampton@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'
          jid='earlofcambridge@shakespeare.lit'&gt;
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST add that bare JID to the ban list, MUST remove the outcast's nickname from the list of registered nicknames, and MUST inform the admin or owner of success:</p>
    <p class="caption"><a name="example-112" id="example-112"></a>Example 112. Service Informs Admin or Owner of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='southampton@chat.shakespeare.lit'
    id='ban1'
    to='kinghenryv@shakespeare.lit/throne'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST also remove any banned users who are in the room by sending a presence stanza of type "unavailable" to each banned occupant, including status code 301 in the extended presence information, optionally along with the reason (if provided) and the roomnick or bare JID of the user who initiated the ban.</p>
    <p class="caption"><a name="example-113" id="example-113"></a>Example 113. Service Removes Banned User</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='southampton@chat.shakespeare.lit/cambridge'
    to='earlofcambridge@shakespeare.lit/stabber'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='outcast' role='none'&gt;
      &lt;actor nick='The ♚'/&gt;
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
    &lt;status code='301'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p>The inclusion of the status code assists clients in presenting their own notification messages (e.g., information appropriate to the user's locality). The optional inclusion of the reason and actor enable the banned user to understand why he or she was banned, and by whom if the banned user would like to discuss the matter.</p>
    <p>The service MUST then inform all of the remaining occupants that the banned user is no longer in the room by sending presence stanzas of type "unavailable" from the banned user to all remaining occupants (just as it does when occupants exit the room of their own volition), including the status code and optionally the reason and actor:</p>
    <p class="caption"><a name="example-114" id="example-114"></a>Example 114. Service Informs Remaining Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    type='unavailable'
    from='southampton@chat.shakespeare.lit/cambridge'
    to='exeter@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='outcast'
          jid='earlofcambridge@shakespeare.lit/stabber'
          role='none'/&gt;
    &lt;status code='301'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>As with <a href="#kick">Kicking an Occupant</a>, a user cannot be banned by an admin with a lower affiliation. Therefore, if an admin attempts to ban an owner, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender:</p>
    <p class="caption"><a name="example-115" id="example-115"></a>Example 115. Service Returns Error on Attempt to Ban User With Higher Affiliation</p><div class="indent"><pre class="prettyprint">
&lt;iq from='kinghenryv@shakespeare.lit/throne'
    id='ban1'
    to='southampton@chat.shakespeare.lit'
    type='set'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If an admin or owner attempts to ban himself, the service MUST deny the request and return a &lt;conflict/&gt; error to the sender. (Note: This is different from the recommended service behavior on kicking oneself.)</p>
  </div>

  <div class="indent"><h3>9.2 <a name="modifyban" id="modifyban">Modifying the Ban List</a></h3>
    <p>A room admin might want to modify the ban list. (Note: The ban list is always based on a user's bare JID.) To modify the list of banned JIDs, the admin first requests the ban list by querying the room for all users with an affiliation of 'outcast'.</p>
    <p class="caption"><a name="example-116" id="example-116"></a>Example 116. Admin Requests Ban List</p><div class="indent"><pre class="prettyprint">
&lt;iq from='kinghenryv@shakespeare.lit/throne'
    id='ban2'
    to='southampton@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST then return the list of banned users to the admin; each item MUST include the 'affiliation' and 'jid' attributes but SHOULD NOT include the 'nick' and 'role' attributes:</p>
    <p class="caption"><a name="example-117" id="example-117"></a>Example 117. Service Sends Ban List to Admin</p><div class="indent"><pre class="prettyprint">
&lt;iq from='southampton@chat.shakespeare.lit'
    id='ban2'
    to='kinghenryv@shakespeare.lit/throne'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'
          jid='earlofcambridge@shakespeare.lit'&gt;
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The admin can then modify the ban list if desired. In order to do so, the admin MUST send the changed items (i.e., only the "delta") back to the service; each item MUST include the 'affiliation' attribute (normally set to a value of "outcast" to ban or "none" to remove ban) and 'jid' attribute but SHOULD NOT include the 'nick' attribute and MUST NOT include the 'role' attribute (which is used to manage roles such as participant rather than affiliations such as outcast); in addition, the reason and actor elements are OPTIONAL:</p>
    <p class="caption"><a name="example-118" id="example-118"></a>Example 118. Admin Sends Modified Ban List to Service</p><div class="indent"><pre class="prettyprint">
&lt;iq from='kinghenryv@shakespeare.lit/throne'
    id='ban3'
    to='southampton@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'
          jid='lordscroop@shakespeare.lit'&gt;
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
    &lt;item affiliation='outcast'
          jid='sirthomasgrey@shakespeare.lit'&gt;
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>After updating the ban list, the service MUST inform the admin of success:</p>
    <p class="caption"><a name="example-119" id="example-119"></a>Example 119. Service Informs Admin of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='southampton@chat.shakespeare.lit'
    id='ban3'
    to='kinghenryv@shakespeare.lit/throne'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST then remove the affected occupants (if they are in the room) and send updated presence (including the appropriate status code) from them to all the remaining occupants as described in the "Banning a User" use case. (The service MUST also remove each banned user's reserved nickname from the list of reserved roomnicks, if appropriate.)</p>
    <p>When an entity is banned from a room, an implementation SHOULD match JIDs in the following order (these matching rules are the same as those defined for privacy lists in <span class="ref"><a href="http://xmpp.org/extensions/xep-0016.html">Privacy Lists (XEP-0016)</a></span>  [<a href="#nt-idp2395984">25</a>]):</p>
    <ol start="1">
      <li>&lt;user@domain/resource&gt; (only that resource matches)</li>
      <li>&lt;user@domain&gt; (any resource matches)</li>
      <li>&lt;domain/resource&gt; (only that resource matches)</li>
      <li>&lt;domain&gt; (the domain itself matches, as does any user@domain or domain/resource)</li>
    </ol>
    <p>Some administrators might wish to ban all users associated with a specific domain from all rooms hosted by a MUC service. Such functionality is a service-level feature and is therefore out of scope for this document; see <span class="ref">XEP-0133</span>.</p>
  </div>

  <div class="indent"><h3>9.3 <a name="grantmember" id="grantmember">Granting Membership</a></h3>
    <p>An admin can grant membership to a user; this is done by changing the affiliation for the user's bare JID to "member" (if a nick is provided, that nick becomes the user's default nick in the room if that functionality is supported by the implementation):</p>
    <p class="caption"><a name="example-120" id="example-120"></a>Example 120. Admin Grants Membership</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='member1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit'
          nick='thirdwitch'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL.</p>
    <p class="caption"><a name="example-121" id="example-121"></a>Example 121. Admin Grants Membership (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='member1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit'
          nick='thirdwitch'&gt;
      &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST add the user to the member list and then inform the admin of success:</p>
    <p class="caption"><a name="example-122" id="example-122"></a>Example 122. Service Informs Admin of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='member1'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>If the user is in the room, the service MUST then send updated presence from this individual to all occupants, indicating the granting of membership by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "member".</p>
    <p class="caption"><a name="example-123" id="example-123"></a>Example 123. Service Sends Notice of Membership to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'
          nick='thirdwitch'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
  </div>

  <div class="indent"><h3>9.4 <a name="revokemember" id="revokemember">Revoking Membership</a></h3>
    <p>An admin might want to revoke a user's membership; this is done by changing the user's affiliation to "none":</p>
    <p class="caption"><a name="example-124" id="example-124"></a>Example 124. Admin Revokes Membership</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='member2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL.</p>
    <p class="caption"><a name="example-125" id="example-125"></a>Example 125. Admin Revokes Membership (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='member2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit'&gt;
      &lt;reason&gt;Not so worthy after all!&lt;/reason&gt; 
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST remove the user from the member list and then inform the moderator of success:</p>
    <p class="caption"><a name="example-126" id="example-126"></a>Example 126. Service Informs Moderator of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='member2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST then send updated presence from this individual to all occupants, indicating the loss of membership by sending a presence element that contains an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "none".</p>
    <p class="caption"><a name="example-127" id="example-127"></a>Example 127. Service Notes Loss of Membership</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>If the room is members-only, the service MUST remove the user from the room, including a status code of 321 to indicate that the user was removed because of an affiliation change, and inform all remaining occupants:</p>
    <p class="caption"><a name="example-128" id="example-128"></a>Example 128. Service Removes Non-Member</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'&gt;
      &lt;actor nick='TheBard'/&gt;
    &lt;/item&gt;
    &lt;status code='321'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'/&gt;
    &lt;status code='321'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
  </div>

  <div class="indent"><h3>9.5 <a name="modifymember" id="modifymember">Modifying the Member List</a></h3>
    <p>In the context of a members-only room, the member list is essentially a "whitelist" of people who are allowed to enter the room. Anyone who is not a member is effectively banned from entering the room, even if their affiliation is not "outcast".</p>
    <p>In the context of an open room, the member list is simply a list of users (bare JID and reserved nick) who are registered with the room. Such users can appear in a room roster, have their room nickname reserved, be returned in search results or FAQ queries, and the like.</p>
    <p>It is RECOMMENDED that only room admins have the privilege to modify the member list in members-only rooms. To do so, the admin first requests the member list by querying the room for all users with an affiliation of "member":</p>
    <p class="caption"><a name="example-129" id="example-129"></a>Example 129. Admin Requests Member List</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='member3'
    to='coven@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='member'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Note: A service SHOULD also return the member list to any occupant in a members-only room; i.e., it SHOULD NOT generate a &lt;forbidden/&gt; error when a member in the room requests the member list. This functionality can assist clients in showing all the existing members even if some of them are not in the room, e.g. to help a member determine if another user should be invited. A service SHOULD also allow any member to retrieve the member list even if not yet an occupant.</p>
    <p>The service MUST then return the full member list to the admin qualified by the 'http://jabber.org/protocol/muc#admin' namespace; each item MUST include the 'affiliation' and 'jid' attributes and MAY include the 'nick' and 'role' attributes for each member that is currently an occupant.</p>
    <p class="caption"><a name="example-130" id="example-130"></a>Example 130. Service Sends Member List to Admin</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='member3'
    to='crone1@shakespeare.lit/desktop'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit'
          nick='thirdwitch'
          role='participant'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The admin can then modify the member list if desired. In order to do so, the admin MUST send the changed items (i.e., only the "delta") to the service; each item MUST include the 'affiliation' attribute (normally set to a value of "member" or "none") and 'jid' attribute but SHOULD NOT include the 'nick' attribute (unless modifying the user's reserved nickname) and MUST NOT include the 'role' attribute (which is used to manage roles such as participant rather than affiliations such as member):</p>
    <p class="caption"><a name="example-131" id="example-131"></a>Example 131. Admin Sends Modified Member List to Service</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='member4'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit'/&gt;
    &lt;item affiliation='member'
          jid='hecate@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST modify the member list and then inform the moderator of success:</p>
    <p class="caption"><a name="example-132" id="example-132"></a>Example 132. Service Informs Moderator of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='member4'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST change the affiliation of any affected user. If the user has been removed from the member list, the service MUST change the user's affiliation from "member" to "none". If the user has been added to the member list, the service MUST change the user's affiliation to "member".</p>
    <p>If a removed member is currently in a members-only room, the service SHOULD kick the occupant by changing the removed member's role to "none" and send appropriate presence to the removed member as previously described. The service MUST subsequently refuse entry to the user.</p>
    <p>For all room types, the service MUST send updated presence from this individual to all occupants, indicating the change in affiliation by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "none".</p>
    <p class="caption"><a name="example-133" id="example-133"></a>Example 133. Service Sends Notice of Loss of Membership to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>In addition, the service SHOULD send an invitation to any user who has been added to the member list of a members-only room if the user is not currently affiliated with the room (note that the following example includes a password but not a reason -- both child elements are OPTIONAL):</p>
    <p class="caption"><a name="example-134" id="example-134"></a>Example 134. Room Sends Invitation to New Member</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit'
    id='CA409450-5AAE-41C1-AAAD-5375CA738885'
    to='hecate@shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite from='bard@shakespeare.lit'/&gt;
    &lt;password&gt;cauldronburn&lt;/password&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p>Although only admins and owners SHOULD be allowed to modify the member list, an implementation MAY provide a configuration option that opens invitation privileges to any member of a members-only room. In such a situation, any invitation sent SHOULD automatically trigger the addition of the invitee to the member list. However, if invitation privileges are restricted to admins and a mere member attempts to a send an invitation, the service MUST deny the invitation request and return a &lt;forbidden/&gt; error to the sender:</p>
    <p class="caption"><a name="example-135" id="example-135"></a>Example 135. Service Returns Error on Attempt by Mere Member to Invite Others to a Members-Only Room</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='coven@chat.shakespeare.lit'
    id='C6E14DF6-00B7-4729-BC1C-94E59C07548E'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='hecate@shakespeare.lit'&gt;
      &lt;reason&gt;
        Hey Hecate, this is the place for all good witches!
      &lt;/reason&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/message&gt;
    </pre></div>
    <p>Invitations sent through an open room MUST NOT trigger the addition of the invitee to the member list.</p>
    <p>If a user is added to the member list of an open room and the user is in the room, the service MUST send updated presence from this individual to all occupants, indicating the change in affiliation by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "member".</p>
    <p class="caption"><a name="example-136" id="example-136"></a>Example 136. Service Sends Notice of Membership to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/hecate'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hecate@shakespeare.lit/broom'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
  </div>

  <div class="indent"><h3>9.6 <a name="grantmod" id="grantmod">Granting Moderator Status</a></h3>
    <p>An admin might want to grant moderator status to a participant or visitor; this is done by changing the user's role to "moderator":</p>
    <p class="caption"><a name="example-137" id="example-137"></a>Example 137. Admin Grants Moderator Status</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='mod1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='moderator'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL.</p>
    <p class="caption"><a name="example-138" id="example-138"></a>Example 138. Admin Grants Moderator Status (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='mod1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='moderator'&gt;
      &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt; 
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST add the user to the moderator list and then inform the admin of success:</p>
    <p class="caption"><a name="example-139" id="example-139"></a>Example 139. Service Informs Admin of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='mod1'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST then send updated presence from this individual to all occupants, indicating the addition of moderator status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'role' attribute set to a value of "moderator".</p>
    <p class="caption"><a name="example-140" id="example-140"></a>Example 140. Service Sends Notice of Moderator Status to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
  </div>

  <div class="indent"><h3>9.7 <a name="revokemod" id="revokemod">Revoking Moderator Status</a></h3>
    <p>An admin might want to revoke a user's moderator status. An admin MAY revoke moderator status only from a user whose affiliation is "member" or "none" (i.e., not from an owner or admin). The status is revoked by changing the user's role to "participant":</p>
    <p class="caption"><a name="example-141" id="example-141"></a>Example 141. Admin Revokes Moderator Status</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='mod2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='participant'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL.</p>
    <p class="caption"><a name="example-142" id="example-142"></a>Example 142. Admin Revokes Moderator Status (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='mod2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='participant'&gt;
      &lt;reason&gt;Not so worthy after all!&lt;/reason&gt; 
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST remove the user from the moderator list and then inform the admin of success:</p>
    <p class="caption"><a name="example-143" id="example-143"></a>Example 143. Service Informs Admin of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='mod2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST then send updated presence from this individual to all occupants, indicating the removal of moderator status by sending a presence element that contains an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'role' attribute set to a value of "participant".</p>
    <p class="caption"><a name="example-144" id="example-144"></a>Example 144. Service Notes Loss of Moderator Status</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>As noted, an admin MUST NOT be allowed to revoke moderator status from a user whose affiliation is "owner" or "admin". If an admin attempts to revoke moderator status from such a user, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender:</p>
    <p class="caption"><a name="example-145" id="example-145"></a>Example 145. Service Returns Error on Attempt to Revoke Moderator Status from an Admin or Owner</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='modtest'
    to='crone1@shakespeare.lit/desktop'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>9.8 <a name="modifymod" id="modifymod">Modifying the Moderator List</a></h3>
    <p>An admin might want to modify the moderator list. To do so, the admin first requests the moderator list by querying the room for all users with a role of 'moderator'.</p>
    <p class="caption"><a name="example-146" id="example-146"></a>Example 146. Admin Requests Moderator List</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='mod3'
    to='coven@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item role='moderator'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST then return the moderator list to the admin; each item MUST include the 'nick' and 'role' attributes, and MAY include the 'jid' and 'affiliation' attributes:</p>
    <p class="caption"><a name="example-147" id="example-147"></a>Example 147. Service Sends Moderator List to Admin</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='mod3'
    to='crone1@shakespeare.lit/desktop'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          nick='thirdwitch'
          role='moderator'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The admin can then modify the moderator list if desired. In order to do so, the admin MUST send the changed items (i.e., only the "delta") back to the service; each item MUST include the 'nick' attribute and 'role' attribute (set to a value of "moderator" to grant moderator status or "participant" to revoke moderator status), but SHOULD NOT include the 'jid' attribute and MUST NOT include the 'affiliation' attribute (which is used to manage affiliations such as admin rather than the moderator role):</p>
    <p class="caption"><a name="example-148" id="example-148"></a>Example 148. Admin Sends Modified Moderator List to Service</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='mod4'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='participant'/&gt;
    &lt;item nick='Hecate'
          role='moderator'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST modify the moderator list and then inform the admin of success:</p>
    <p class="caption"><a name="example-149" id="example-149"></a>Example 149. Service Informs Admin of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='mod4'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST then send updated presence for any affected individuals to all occupants, indicating the change in moderator status by sending the appropriate extended presence stanzas as described in the foregoing use cases.</p>
    <p>As noted, moderator status cannot be revoked from a room owner or room admin. If a room admin attempts to revoke moderator status from such a user by modifying the moderator list, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender:</p>
    <p class="caption"><a name="example-150" id="example-150"></a>Example 150. Service Returns Error on Attempt to Revoke Moderator Status from an Admin or Owner</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='modtest'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>9.9 <a name="regapprove" id="regapprove">Approving Registration Requests</a></h3>
    <p>If a service does not automatically accept requests to register with a room, it MAY provide a way for room admins to approve or deny registration requests over XMPP (alternatively, it could provide a web interface or some other admin tool). The simplest way to do so is for the service to send a &lt;message/&gt; stanza to the room admin(s) when the registration request is received, where the &lt;message/&gt; stanza contains a Data Form asking for approval or denial of the request. The following Data Form is RECOMMENDED but implementations might use a different form entirely, or supplement the following form with additional fields.</p>
    <p class="caption"><a name="example-151" id="example-151"></a>Example 151. Registration Request Approval Form</p><div class="indent"><pre class="prettyprint">
&lt;message from='coven@chat.shakespeare.lit'
         id='407665A9-E54E-4AD5-905F-9FD8864489B3'
         to='crone1@shakespeare.lit/pda'&gt;
  &lt;x xmlns='jabber:x:data' type='form'&gt;
    &lt;title&gt;Registration request&lt;/title&gt;
    &lt;instructions&gt;
      To approve this registration request, select the
      &amp;quot;Allow this person to register with the room?&amp;quot;
      checkbox and click OK. To skip this request, click the 
      cancel button.
    &lt;/instructions&gt;
    &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#register&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_first'
           type='text-single'
           label='Given Name'&gt;
      &lt;value&gt;Brunhilde&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_last'
           type="text-single"
           label="Family Name"&gt;
      &lt;value&gt;Entwhistle-Throckmorton&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_roomnick'
           type="text-single"
           label="Desired Nickname"&gt;
      &lt;value&gt;thirdwitch&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_url'
           type="text-single"
           label="User URL"&gt;
      &lt;value&gt;http://witchesonline/~hag66/&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_email'
           type="text-single"
           label="Email Address"&gt;
      &lt;value&gt;hag66@witchesonline&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_faqentry'
           type="text-single"
           label="FAQ Entry"&gt;
      &lt;value&gt;Just another witch.&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_allow'
           type='boolean'
           label='Allow this person to register with the room?'&gt;
      &lt;value&gt;0&lt;/value&gt;
    &lt;/field&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p>If the admin approves the registration request, the service shall register the user with the room.</p>
    <p>More advanced registration approval mechanisms (e.g., retrieving a list of registration requests using <span class="ref"><a href="http://xmpp.org/extensions/xep-0050.html">Ad-Hoc Commands (XEP-0050)</a></span>  [<a href="#nt-idp2471424">26</a>] as is done in <span class="ref"><a href="http://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-idp2474048">27</a>]) are out of scope for this document.</p>
  </div>

<h2>10.
       <a name="owner" id="owner">Owner Use Cases</a></h2>
  <p>Every room MUST have at least one owner, and that owner (or a successor) is a long-lived attribute of the room for as long as the room exists (e.g., the owner does not lose ownership on exiting a persistent room). This document assumes that the (initial) room owner is the individual who creates the room and that only a room owner has the right to change defining room configuration settings such as the room type. Room owners can specify not only the room types (password-protected, members-only, etc.) but also certain attributes of the room as listed in the <a href="#reqs">Requirements</a> section of this document. In addition, an owner can also specify the JIDs of other owners, if supported by the implementation.</p>
  <p>In order to provide the necessary flexibility for a wide range of configuration options, Data Forms (<span class="ref">XEP-0004</span>) are used for room configuration, triggered by use of the 'http://jabber.org/protocol/muc' namespace. If an entity does not include the MUC namespace in its room join/create request, then the service shall create the room and not wait for configuration via Data Forms before creating the room (this ensures backwards-compatibility with the old groupchat 1.0 protocol); however, if the room join/create request includes the MUC extension, then the service shall require configuration via Data Forms before creating and unlocking the room.</p>
  <p>Note: The configuration options shown below address all of the features and room types listed in the requirements section of this document; however, the exact configuration options and form layout shall be determined by the implementation or specific deployment. Also, these are examples only and are not intended to define the only allowed or required configuration options for rooms. A given implementation or deployment MAY choose to provide additional configuration options (clearance levels, profanity filters, supported languages, message logging, etc.), which is why the use of the 'jabber:x:data' protocol is valuable here.</p>
  <div class="indent"><h3>10.1 <a name="createroom" id="createroom">Creating a Room</a></h3>
    <div class="indent"><h3>10.1.1 <a name="createroom-general" id="createroom-general">General Considerations</a></h3>
      <p>The privilege to create rooms MAY be restricted to certain users or MAY be reserved to an administrator of the service. If access is restricted and a user attempts to create a room, the service MUST return a &lt;not-allowed/&gt; error:</p>
      <p class="caption"><a name="example-152" id="example-152"></a>Example 152. Service Informs User of Inability to Create a Room</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/thirdwitch'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
  &lt;error by='coven@chat.shakespeare.lit' type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
      <p>If access is not restricted, the service MUST allow the user to create a room as described below.</p>
      <p>From the perspective of room creation, there are in essence two kinds of rooms:</p>
      <ul>
        <li><p>"Instant rooms" -- these are available for immediate access and are automatically created based on some default configuration.</p></li>
        <li><p>"Reserved rooms" -- these are manually configured by the room creator before anyone is allowed to enter.</p></li>
      </ul>
      <p>The workflow for creating and configuring such rooms is as follows:</p>
      <ol start="1">
        <li><p>The user sends presence to &lt;room@service/nick&gt; and signal his or her support for the Multi-User Chat protocol by including extended presence information in an empty &lt;x/&gt; child element qualified by the 'http://jabber.org/protocol/muc' namespace (note the lack of an '#owner' or '#user' fragment).</p></li>
        <li><p>If this user is allowed to create a room and the room does not yet exist, the service MUST create the room according to some default configuration, assign the requesting user as the initial room owner, and add the owner to the room but not allow anyone else to enter the room (effectively "locking" the room). The initial presence stanza received by the owner from the room MUST include extended presence information indicating the user's status as an owner and acknowledging that the room has been created (via status code 201) and is awaiting configuration.</p></li>
        <li><p>If the initial room owner would like to create and configure a reserved room, the room owner MUST then request a configuration form by sending an IQ stanza of type "get" to the room containing an empty &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/muc#owner' namespace, then complete Steps 4 and 5. If the room owner would prefer to create an instant room, the room owner MUST send a query element qualified by the 'http://jabber.org/protocol/muc#owner' namespace and containing an empty &lt;x/&gt; element of type "submit" qualified by the 'jabber:x:data' namespace, then skip to Step 6.</p></li>
        <li><p>If the room owner requested a configuration form, the service MUST send an IQ result to the room owner containing a configuration form qualified by the 'jabber:x:data' namespace. If there are no configuration options available, the room MUST return an empty query element to the room owner.</p></li>
        <li><p>The initial room owner SHOULD provide a starting configuration for the room (or accept the default configuration) by sending an IQ set containing the completed configuration form. Alternatively, the room owner MAY cancel the configuration process. (An implementation MAY set a timeout for initial configuration, such that if the room owner does not configure the room within the timeout period, the room owner is assumed to have accepted the default configuration or to have cancelled the configuration process.)</p></li>
        <li><p>Once the service receives the completed configuration form from the initial room owner (or receives a request for an instant room), the service MUST "unlock" the room (i.e., allow other users to enter the room) and send an IQ of type "result" to the room owner. If the service receives a cancellation, it MUST destroy the room.</p></li>
      </ol>
      <p>The protocol for this workflow is shown in the examples below.</p>
      <p>First, the user MUST send presence to the room, including an empty &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc' namespace (this is the same stanza sent when seeking to enter a room).</p>
      <p class="caption"><a name="example-153" id="example-153"></a>Example 153. User Creates a Room and Signals Support for Multi-User Chat</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='crone1@shakespeare.lit/desktop'
    to='coven@chat.shakespeare.lit/firstwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p>If the room does not yet exist, the service SHOULD create the room (subject to local policies regarding room creation), assign the bare JID of the requesting user as the owner, add the owner to the room, and acknowledge successful creation of the room by sending a presence stanza of the following form:</p>
      <p class="caption"><a name="example-154" id="example-154"></a>Example 154. Service Acknowledges Room Creation</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/firstwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner'
          role='moderator'/&gt;
    &lt;status code='110'/&gt;
    &lt;status code='201'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p>After receiving notification that the room has been created, the room owner needs to decide whether to accept the default room configuration (i.e., create an "instant room") or configure the room to use something other than the default room configuration (i.e., create a "reserved room"). The protocol flows for completing those two use cases are shown in the following sections.</p>
      <p>Note: If the presence stanza sent to a nonexistent room does not include an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc' namespace as shown above, the service SHOULD create a default room without delay (i.e., it MUST assume that the client supports groupchat 1.0 rather than MUC and therefore it MUST NOT lock the room while waiting for the room creator to either accept an instant room or configure a reserved room).</p>
    </div>

    <div class="indent"><h3>10.1.2 <a name="createroom-instant" id="createroom-instant">Creating an Instant Room</a></h3>
      <p>If the initial room owner wants to accept the default room configuration (i.e., create an "instant room"), the room owner MUST decline an initial configuration form by sending an IQ set to the &lt;room@service&gt; itself containing a &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/muc#owner' namespace, where the only child of the &lt;query/&gt; is an empty &lt;x/&gt; element that is qualified by the 'jabber:x:data' namespace and that possesses a 'type' attribute whose value is "submit":</p>
      <p class="caption"><a name="example-155" id="example-155"></a>Example 155. Owner Requests Instant Room</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='create1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='submit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p>The service MUST then unlock the room and allow other entities to join it.</p>
    </div>

    <div class="indent"><h3>10.1.3 <a name="createroom-reserved" id="createroom-reserved">Creating a Reserved Room</a></h3>
      <p>If the initial room owner wants to create and configure a reserved room, the room owner MUST request an initial configuration form by sending an IQ get to the &lt;room@service&gt; itself containing an empty &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/muc#owner' namespace:</p>
      <p class="caption"><a name="example-156" id="example-156"></a>Example 156. Owner Requests Configuration Form</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='create1'
    to='coven@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'/&gt;
&lt;/iq&gt;
      </pre></div>
      <p>If the room does not already exist, the service MUST return an initial room configuration form to the user. (Note: The following example shows a representative sample of configuration options. A full list of x:data fields registered for use in room creation and configuration is maintained by the XMPP Registrar; see the <a href="#registrar">XMPP Registrar Considerations</a> section of this document.)</p>
      <p class="caption"><a name="example-157" id="example-157"></a>Example 157. Service Sends Configuration Form</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='create1'
    to='crone1@shakespeare.lit/desktop'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;title&gt;Configuration for "coven" Room&lt;/title&gt;
      &lt;instructions&gt;
          Your room coven@macbeth has been created!
          The default configuration is as follows:
            - No logging
            - No moderation
            - Up to 20 occupants
            - No password required
            - No invitation required
            - Room is not persistent
            - Only admins may change the subject
            - Presence broadcasted for all users
          To accept the default configuration, click OK. To
          select a different configuration, please complete
          this form.
      &lt;/instructions&gt;
      &lt;field
          type='hidden'
          var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#roomconfig&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Natural-Language Room Name'
          type='text-single'
          var='muc#roomconfig_roomname'/&gt;
      &lt;field
          label='Short Description of Room'
          type='text-single'
          var='muc#roomconfig_roomdesc'/&gt;
      &lt;field
          label='Natural Language for Room Discussions'
          type='text-single'
          var='muc#roomconfig_lang'/&gt;
      &lt;field
          label='Enable Public Logging?'
          type='boolean'
          var='muc#roomconfig_enablelogging'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Allow Occupants to Change Subject?'
          type='boolean'
          var='muc#roomconfig_changesubject'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Allow Occupants to Invite Others?'
          type='boolean'
          var='muc#roomconfig_allowinvites'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Who Can Send Private Messages?'
          type='list-single'
          var='muc#roomconfig_allowpm'&gt;
        &lt;value&gt;anyone&lt;/value&gt;
        &lt;option label='Anyone'&gt;
          &lt;value&gt;anyone&lt;/value&gt;
        &lt;/option&gt;
        &lt;option label='Anyone with Voice'&gt;
          &lt;value&gt;participants&lt;/value&gt;
          &lt;/option&gt;
        &lt;option label='Moderators Only'&gt;
          &lt;value&gt;moderators&lt;/value&gt;
        &lt;/option&gt;
        &lt;option label='Nobody'&gt;
          &lt;value&gt;none&lt;/value&gt;
        &lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Maximum Number of Occupants'
          type='list-single'
          var='muc#roomconfig_maxusers'&gt;
        &lt;value&gt;20&lt;/value&gt;
        &lt;option label='10'&gt;&lt;value&gt;10&lt;/value&gt;&lt;/option&gt;
        &lt;option label='20'&gt;&lt;value&gt;20&lt;/value&gt;&lt;/option&gt;
        &lt;option label='30'&gt;&lt;value&gt;30&lt;/value&gt;&lt;/option&gt;
        &lt;option label='50'&gt;&lt;value&gt;50&lt;/value&gt;&lt;/option&gt;
        &lt;option label='100'&gt;&lt;value&gt;100&lt;/value&gt;&lt;/option&gt;
        &lt;option label='None'&gt;&lt;value&gt;none&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Roles for which Presence is Broadcasted'
          type='list-multi'
          var='muc#roomconfig_presencebroadcast'&gt;
        &lt;value&gt;moderator&lt;/value&gt;
        &lt;value&gt;participant&lt;/value&gt;
        &lt;value&gt;visitor&lt;/value&gt;
        &lt;option label='Moderator'&gt;&lt;value&gt;moderator&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Participant'&gt;&lt;value&gt;participant&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Visitor'&gt;&lt;value&gt;visitor&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Roles and Affiliations that May Retrieve Member List'
          type='list-multi'
          var='muc#roomconfig_getmemberlist'&gt;
        &lt;value&gt;moderator&lt;/value&gt;
        &lt;value&gt;participant&lt;/value&gt;
        &lt;value&gt;visitor&lt;/value&gt;
        &lt;option label='Moderator'&gt;&lt;value&gt;moderator&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Participant'&gt;&lt;value&gt;participant&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Visitor'&gt;&lt;value&gt;visitor&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Publicly Searchable?'
          type='boolean'
          var='muc#roomconfig_publicroom'&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Persistent?'
          type='boolean'
          var='muc#roomconfig_persistentroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Moderated?'
          type='boolean'
          var='muc#roomconfig_moderatedroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Members-Only?'
          type='boolean'
          var='muc#roomconfig_membersonly'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Password Required to Enter?'
          type='boolean'
          var='muc#roomconfig_passwordprotectedroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          If a password is required to enter this room,
          you must specify the password below.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Password'
          type='text-private'
          var='muc#roomconfig_roomsecret'/&gt;
      &lt;field
          label='Who May Discover Real JIDs?'
          type='list-single'
          var='muc#roomconfig_whois'&gt;
        &lt;option label='Moderators Only'&gt;
          &lt;value&gt;moderators&lt;/value&gt;
        &lt;/option&gt;
        &lt;option label='Anyone'&gt;
          &lt;value&gt;anyone&lt;/value&gt;
        &lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Maximum Number of History Messages Returned by Room'
          type='text-single'
          var='muc#maxhistoryfetch'&gt;
        &lt;value&gt;50&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          You may specify additional people who have
          admin status in the room. Please
          provide one Jabber ID per line.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Room Admins'
          type='jid-multi'
          var='muc#roomconfig_roomadmins'/&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          You may specify additional owners for this
          room. Please provide one Jabber ID per line.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Room Owners'
          type='jid-multi'
          var='muc#roomconfig_roomowners'/&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p>Note: The _whois configuration option specifies whether the room is non-anonymous (a value of "anyone"), semi-anonymous (a value of "moderators"), or fully anonmyous (a value of "none", not shown here).</p>
      <p>If there are no configuration options available, the service MUST return an empty query element to the room owner:</p>
      <p class="caption"><a name="example-158" id="example-158"></a>Example 158. Service Informs Owner that No Configuration is Possible</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='create1'
    to='crone1@shakespeare.lit/desktop'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'/&gt;
&lt;/iq&gt;
      </pre></div>
      <p>The room owner SHOULD then fill out the form and submit it to the service.</p>
      <p class="caption"><a name="example-159" id="example-159"></a>Example 159. Owner Submits Configuration Form</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='create2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='submit'&gt;
      &lt;field var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#roomconfig&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_roomname'&gt;
        &lt;value&gt;A Dark Cave&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_roomdesc'&gt;
        &lt;value&gt;The place for all good witches!&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_enablelogging'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_changesubject'&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_allowinvites'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_allowpm'&gt;
        &lt;value&gt;anyone&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_maxusers'&gt;
        &lt;value&gt;10&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_publicroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_persistentroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_moderatedroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_membersonly'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_passwordprotectedroom'&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_roomsecret'&gt;
        &lt;value&gt;cauldronburn&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_whois'&gt;
        &lt;value&gt;moderators&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#maxhistoryfetch'&gt;
        &lt;value&gt;50&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_roomadmins'&gt;
        &lt;value&gt;wiccarocks@shakespeare.lit&lt;/value&gt;
        &lt;value&gt;hecate@shakespeare.lit&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p>If room creation is successful, the service MUST inform the new room owner of success:</p>
      <p class="caption"><a name="example-160" id="example-160"></a>Example 160. Service Informs New Room Owner of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='create2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
      </pre></div>
      <p>If the room creation fails because the specified room configuration options violate one or more service policies (e.g., because the password for a password-protected room is blank), the service MUST return a &lt;not-acceptable/&gt; error.</p>
      <p class="caption"><a name="example-161" id="example-161"></a>Example 161. Service Informs Owner that Requested Configuration Options Are Unacceptable</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='create2'
    to='crone1@shakespeare.lit/desktop'
    type='error'&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
      </pre></div>
      <p>Alternatively, the room owner MAY cancel the configuration process:</p>
      <p class="caption"><a name="example-162" id="example-162"></a>Example 162. Owner Cancels Initial Configuration</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='create2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='cancel'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p>If the room owner cancels the initial configuration, the service MUST destroy the room, making sure to send unavailable presence to the room owner (see the "Destroying a Room" use case for protocol details).</p>
      <p>If the room owner becomes unavailable for any reason before submitting the form (e.g., a lost connection), the service will receive a presence stanza of type "unavailable" from the owner to the owner's &lt;room@service/nick&gt;. The service MUST then destroy the room, sending a presence stanza of type "unavailable" from the room to the owner including a &lt;destroy/&gt; element and reason (if provided) as defined in the <a href="#destroyroom">Destroying a Room</a> section of this document.</p>
    </div>

  </div>

  <div class="indent"><h3>10.2 <a name="roomconfig" id="roomconfig">Subsequent Room Configuration</a></h3>
    <p>At any time after specifying the initial configuration of the room, a room owner might want to change the configuration. In order to initiate this process, a room owner requests a new configuration form from the room by sending an IQ get to &lt;room@service&gt; containing an empty &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/muc#owner' namespace.</p>
    <p class="caption"><a name="example-163" id="example-163"></a>Example 163. Owner Requests Configuration Form</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='config1'
    to='coven@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the &lt;user@host&gt; of the 'from' address does not match the bare JID of a room owner, the service MUST return a &lt;forbidden/&gt; error to the sender:</p>
    <p class="caption"><a name="example-164" id="example-164"></a>Example 164. Service Denies Configuration Access to Non-Owner</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='configures'
    to='wiccarocks@shakespeare.lit/laptop'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'/&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Otherwise, the service MUST send a configuration form to the room owner with the current options set as defaults:</p>
    <p class="caption"><a name="example-165" id="example-165"></a>Example 165. Service Sends Configuration Form to Owner</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='config1'
    to='crone1@shakespeare.lit/desktop'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;title&gt;Configuration for "coven" Room&lt;/title&gt;
      &lt;instructions&gt;
        Complete this form to modify the
        configuration of your room.
      &lt;/instructions&gt;
      &lt;field
          type='hidden'
          var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#roomconfig&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Natural-Language Room Name'
          type='text-single'
          var='muc#roomconfig_roomname'&gt;
        &lt;value&gt;A Dark Cave&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Short Description of Room'
          type='text-single'
          var='muc#roomconfig_roomdesc'&gt;
        &lt;value&gt;The place for all good witches!&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Enable Public Logging?'
          type='boolean'
          var='muc#roomconfig_enablelogging'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Allow Occupants to Change Subject?'
          type='boolean'
          var='muc#roomconfig_changesubject'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Allow Occupants to Invite Others?'
          type='boolean'
          var='muc#roomconfig_allowinvites'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Who Can Send Private Messages?'
          type='list-single'
          var='muc#roomconfig_allowpm'&gt;
        &lt;value&gt;anyone&lt;/value&gt;
        &lt;option label='Anyone'&gt;
          &lt;value&gt;anyone&lt;/value&gt;
        &lt;/option&gt;
        &lt;option label='Anyone with Voice'&gt;
          &lt;value&gt;participants&lt;/value&gt;
          &lt;/option&gt;
        &lt;option label='Moderators Only'&gt;
          &lt;value&gt;moderators&lt;/value&gt;
        &lt;/option&gt;
        &lt;option label='Nobody'&gt;
          &lt;value&gt;none&lt;/value&gt;
        &lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Maximum Number of Occupants'
          type='list-single'
          var='muc#roomconfig_maxusers'&gt;
        &lt;value&gt;10&lt;/value&gt;
        &lt;option label='10'&gt;&lt;value&gt;10&lt;/value&gt;&lt;/option&gt;
        &lt;option label='20'&gt;&lt;value&gt;20&lt;/value&gt;&lt;/option&gt;
        &lt;option label='30'&gt;&lt;value&gt;30&lt;/value&gt;&lt;/option&gt;
        &lt;option label='50'&gt;&lt;value&gt;50&lt;/value&gt;&lt;/option&gt;
        &lt;option label='100'&gt;&lt;value&gt;100&lt;/value&gt;&lt;/option&gt;
        &lt;option label='None'&gt;&lt;value&gt;none&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Roles for which Presence is Broadcasted'
          type='list-multi'
          var='muc#roomconfig_presencebroadcast'&gt;
        &lt;value&gt;moderator&lt;/value&gt;
        &lt;value&gt;participant&lt;/value&gt;
        &lt;value&gt;visitor&lt;/value&gt;
        &lt;option label='Moderator'&gt;&lt;value&gt;moderator&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Participant'&gt;&lt;value&gt;participant&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Visitor'&gt;&lt;value&gt;visitor&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Roles and Affiliations that May Retrieve Member List'
          type='list-multi'
          var='muc#roomconfig_getmemberlist'&gt;
        &lt;value&gt;moderator&lt;/value&gt;
        &lt;value&gt;participant&lt;/value&gt;
        &lt;value&gt;visitor&lt;/value&gt;
        &lt;option label='Moderator'&gt;&lt;value&gt;moderator&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Participant'&gt;&lt;value&gt;participant&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Visitor'&gt;&lt;value&gt;visitor&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Publicly Searchable?'
          type='boolean'
          var='muc#roomconfig_publicroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Persistent?'
          type='boolean'
          var='muc#roomconfig_persistentroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Moderated?'
          type='boolean'
          var='muc#roomconfig_moderatedroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Members Only?'
          type='boolean'
          var='muc#roomconfig_membersonly'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Password Required for Entry?'
          type='boolean'
          var='muc#roomconfig_passwordprotectedroom'&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          If a password is required to enter this room,
          you must specify the password below.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Password'
          type='text-private'
          var='muc#roomconfig_roomsecret'&gt;
        &lt;value&gt;cauldronburn&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Who May Discover Real JIDs?'
          type='list-single'
          var='muc#roomconfig_whois'&gt;
        &lt;value&gt;moderators&lt;/value&gt;
        &lt;option label='Moderators Only'&gt;
          &lt;value&gt;moderators&lt;/value&gt;
        &lt;/option&gt;
        &lt;option label='Anyone'&gt;
          &lt;value&gt;anyone&lt;/value&gt;
        &lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Maximum Number of History Messages Returned by Room'
          type='text-single'
          var='muc#maxhistoryfetch'&gt;
        &lt;value&gt;50&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          You may specify additional people who have
          admin status in the room. Please
          provide one Jabber ID per line.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Room Admins'
          type='jid-multi'
          var='muc#roomconfig_roomadmins'&gt;
        &lt;value&gt;wiccarocks@shakespeare.lit&lt;/value&gt;
        &lt;value&gt;hecate@shakespeare.lit&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          You may specify additional owners for this
          room. Please provide one Jabber ID per line.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Room Owners'
          type='jid-multi'
          var='muc#roomconfig_roomowners'/&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If there are no configuration options available, the service MUST return an empty query element to the room owner as shown in the previous use case.</p>
    <p>The room owner then submits the form with updated configuration information. (Example not shown.)</p>
    <p>Alternatively, the room owner MAY cancel the configuration process:</p>
    <p class="caption"><a name="example-166" id="example-166"></a>Example 166. Owner Cancels Subsequent Configuration</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='config2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='cancel'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the room owner cancels the subsequent configuration, the service MUST leave the configuration of the room as it was before the room owner initiated the subsequent configuration process.</p>
    <p>If as a result of a change in the room configuration a room admin loses admin status while in the room, the room MUST send updated presence for that individual to all occupants, denoting the change in status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "member" or "none" and the 'role' attribute set to a value of "participant" or "visitor" as appropriate for the affiliation level and the room type:</p>
    <p class="caption"><a name="example-167" id="example-167"></a>Example 167. Service Notes Loss of Admin Affiliation</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>If as a result of a change in the room configuration a user gains admin status while in the room, the room MUST send updated presence for that individual to all occupants, denoting the change in status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "admin" and the 'role' attribute set to a value of "moderator":</p>
    <p class="caption"><a name="example-168" id="example-168"></a>Example 168. Service Notes Gain of Admin Affiliation to All Users</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>If as a result of a change in the room configuration a room owner loses owner status while that owner is in the room, the room MUST send updated presence for that individual to all occupants, denoting the change in status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "admin" and the 'role' attribute set to an appropriate value given the affiliation and room type ("moderator" is recommended).</p>
    <p class="caption"><a name="example-169" id="example-169"></a>Example 169. Service Notes Loss of Owner Affiliation</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>A service MUST NOT allow an owner to revoke his or her own owner status if there are no other owners; if an owner attempts to do this, the service MUST return a &lt;conflict/&gt; error to the owner. However, a service SHOULD allow an owner to revoke his or her own owner status if there are other owners.</p>
    <p>If as a result of a change in the room configuration a user gains owner status while in the room, the room MUST send updated presence for that individual to all occupants, denoting the change in status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "owner" and the 'role' attribute set to an appropriate value given the affiliation and room type ("moderator" is recommended).</p>
    <p class="caption"><a name="example-170" id="example-170"></a>Example 170. Service Notes Gain of Owner Affiliation to All Users</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>If as a result of a change in the room configuration the room type is changed to members-only but there are non-members in the room, the service MUST remove any non-members from the room and include a status code of 322 in the presence unavailable stanzas sent to those users as well as any remaining occupants.</p>
    <div class="indent"><h3>10.2.1 <a name="roomconfig-notify" id="roomconfig-notify">Notification of Configuration Changes</a></h3>
      <p>A room MUST send notification to all occupants when the room configuration changes in a way that has an impact on the privacy or security profile of the room. This notification shall consist of a &lt;message/&gt; stanza containing an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace, which shall contain only a &lt;status/&gt; element with an appropriate value for the 'code' attribute. Here is an example:</p>
      <p class="caption"><a name="example-171" id="example-171"></a>Example 171. Configuration Status Code</p><div class="indent"><pre class="prettyprint">
&lt;message from='coven@chat.shakespeare.lit'
         id='80349046-F26A-44F3-A7A6-54825064DD9E'
         to='crone1@shakespeare.lit/desktop'
         type='groupchat'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;status code='170'/&gt;
  &lt;/x&gt;
&lt;/message&gt;
      </pre></div>
      <p>The codes to be generated as a result of a privacy-related change in room configuration are as follows:</p>
      <ul>
        <li>If room logging is now enabled, status code 170.</li>
        <li>If room logging is now disabled, status code 171.</li>
        <li>If the room is now non-anonymous, status code 172.</li>
        <li>If the room is now semi-anonymous, status code 173.</li>
      </ul>
      <p>For any other configuration change, the room SHOULD send status code 104 so that interested occupants can retrieve the updated room configuration if desired.</p>
    </div>

  </div>

  <div class="indent"><h3>10.3 <a name="grantowner" id="grantowner">Granting Owner Status</a></h3>
    <p>If allowed by an implementation, an owner MAY grant owner status to another user; this is done by changing the user's affiliation to "owner":</p>
    <p class="caption"><a name="example-172" id="example-172"></a>Example 172. Owner Grants Owner Status</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='owner1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='owner'
          jid='hecate@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL.</p>
    <p class="caption"><a name="example-173" id="example-173"></a>Example 173. Owner Grants Owner Status (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='owner1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='owner'
          jid='hecate@shakespeare.lit'&gt;
      &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST add the user to the owner list and then inform the owner of success:</p>
    <p class="caption"><a name="example-174" id="example-174"></a>Example 174. Service Informs Owner of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='owner1'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>If the user is in the room, the service MUST then send updated presence from this individual to all occupants, indicating the granting of owner status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "owner" and the 'role' attribute set to an appropriate value given the affiliation and room type ("moderator" is recommended).</p>
    <p class="caption"><a name="example-175" id="example-175"></a>Example 175. Service Sends Notice of Owner Status to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/hecate'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner'
          jid='hecate@shakespeare.lit'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>If the user is not in the room, the service MAY send a message from the room itself to the room occupants, indicating the granting of owner status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "owner".</p>
    <p class="caption"><a name="example-176" id="example-176"></a>Example 176. Service Sends Notice of Owner Status to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='chat.shakespeare.lit'
    id='22B0F570-526A-4F22-BDE3-52EC3BB18371'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hecate@shakespeare.lit'
          role='none'/&gt;
  &lt;/x&gt;
&lt;/message&gt;

[ ... ]
    </pre></div>
  </div>

  <div class="indent"><h3>10.4 <a name="revokeowner" id="revokeowner">Revoking Owner Status</a></h3>
    <p>An implementation MAY allow an owner to revoke another user's owner status; this is done by changing the user's affiliation to something other than "owner":</p>
    <p class="caption"><a name="example-177" id="example-177"></a>Example 177. Owner Revokes Owner Status</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='owner2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin'
          jid='hecate@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL.</p>
    <p class="caption"><a name="example-178" id="example-178"></a>Example 178. Owner Revokes Owner Status (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='owner2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin'
          jid='hecate@shakespeare.lit'&gt;
      &lt;reason&gt;Not so worthy after all!&lt;/reason&gt; 
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>A service MUST NOT allow an owner to revoke his or her own owner status if there are no other owners; if an owner attempts to do this, the service MUST return a &lt;conflict/&gt; error to the owner. However, a service SHOULD allow an owner to revoke his or her own owner status if there are other owners.</p>
    <p>If an implementation does not allow one owner to revoke another user's owner status, the implementation MUST return a &lt;not-authorized/&gt; error to the owner who made the request.</p>
    <p>Note: Allowing an owner to remove another user's owner status can compromise the control model for room management; therefore this feature is OPTIONAL, and implementations are encouraged to support owner removal through an interface that is open only to individuals with service-wide admin status.</p>
    <p>In all other cases, the service MUST remove the user from the owner list and then inform the owner of success:</p>
    <p class="caption"><a name="example-179" id="example-179"></a>Example 179. Service Informs Owner of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='owner2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>If the user is in the room, the service MUST then send updated presence from this individual to all occupants, indicating the loss of owner status by sending a presence element that contains an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value other than "owner" and the 'role' attribute set to an appropriate value:</p>
    <p class="caption"><a name="example-180" id="example-180"></a>Example 180. Service Notes Loss of Owner Affiliation</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='hecate@shakespeare.lit'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
  </div>

  <div class="indent"><h3>10.5 <a name="modifyowner" id="modifyowner">Modifying the Owner List</a></h3>
    <p>If allowed by an implementation, a room owner might want to modify the owner list. To do so, the owner first requests the owner list by querying the room for all users with an affiliation of 'owner'.</p>
    <p class="caption"><a name="example-181" id="example-181"></a>Example 181. Owner Requests Owner List</p><div class="indent"><pre class="prettyprint">
&lt;iq from='bard@shakespeare.lit/globe'
    id='owner3'
    to='coven@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='owner'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the &lt;user@host&gt; of the 'from' address does not match the bare JID of a room owner, the service MUST return a &lt;forbidden/&gt; error to the sender.</p>
    <p>Otherwise, the service MUST then return the owner list to the owner; each item MUST include the 'affiliation' and 'jid' attributes and MAY include the 'nick' and 'role' attributes for any owner that is currently an occupant:</p>
    <p class="caption"><a name="example-182" id="example-182"></a>Example 182. Service Sends Owner List to Owner</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='owner3'
    to='bard@shakespeare.lit/globe'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='owner'
          jid='crone1@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The owner can then modify the owner list if desired. In order to do so, the owner MUST send the changed items (i.e., only the "delta") back to the service;  [<a href="#nt-idp2580624">28</a>] each item MUST include the 'affiliation' and 'jid' attributes but SHOULD NOT include the 'nick' attribute and MUST NOT include the 'role' attribute (which is used to manage roles such as participant rather than affiliations such as owner):</p>
    <p class="caption"><a name="example-183" id="example-183"></a>Example 183. Owner Sends Modified Owner List to Service</p><div class="indent"><pre class="prettyprint">
&lt;iq from='bard@shakespeare.lit/globe'
    id='owner4'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='owner'
          jid='hecate@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Only owners shall be allowed to modify the owner list. If a non-owner attempts to view or modify the owner list, the service MUST deny the request and return a &lt;forbidden/&gt; error to the sender:</p>
    <p class="caption"><a name="example-184" id="example-184"></a>Example 184. Service Returns Error on Attempt by Non-Owner to Modify Owner List</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='ownertest'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p>A service MUST NOT allow an owner to revoke his or her own owner status if there are no other owners; if an owner attempts to do this, the service MUST return a &lt;conflict/&gt; error to the owner. However, a service SHOULD allow an owner to revoke his or her own owner status if there are other owners.</p>
    <p>In all other cases, the service MUST modify owner list and then inform the owner of success:</p>
    <p class="caption"><a name="example-185" id="example-185"></a>Example 185. Service Informs Owner of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='owner4'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST also send presence notifications related to any affiliation changes that result from modifying the owner list as previously described.</p>
  </div>

  <div class="indent"><h3>10.6 <a name="grantadmin" id="grantadmin">Granting Admin Status</a></h3>
    <p>An owner can grant admin status to a member or an unaffiliated user; this is done by changing the user's affiliation to "admin":</p>
    <p class="caption"><a name="example-186" id="example-186"></a>Example 186. Owner Grants Admin Privileges</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='admin1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL.</p>
    <p class="caption"><a name="example-187" id="example-187"></a>Example 187. Owner Grants Admin Privileges (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='admin1'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit'&gt;
      &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST add the user to the admin list and then inform the owner of success:</p>
    <p class="caption"><a name="example-188" id="example-188"></a>Example 188. Service Informs Owner of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='admin1'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>If the user is in the room, the service MUST then send updated presence from this individual to all occupants, indicating the granting of admin status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "admin" and the 'role' attribute set to an appropriate value given the affiliation and room type (typically "moderator").</p>
    <p class="caption"><a name="example-189" id="example-189"></a>Example 189. Service Sends Notice of Admin Status to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>If the user is not in the room, the service MAY send a message from the room itself to the room occupants, indicating the granting of admin status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "admin".</p>
    <p class="caption"><a name="example-190" id="example-190"></a>Example 190. Service Sends Notice of Admin Status to All Occupants</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='chat.shakespeare.lit'
    id='C75B919A-30B3-4233-AE89-6E9834E26929'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit'
          role='none'/&gt;
  &lt;/x&gt;
&lt;/message&gt;

[ ... ]
    </pre></div>
  </div>

  <div class="indent"><h3>10.7 <a name="revokeadmin" id="revokeadmin">Revoking Admin Status</a></h3>
    <p>An owner might want to revoke a user's admin status; this is done by changing the user's affiliation to something other than "admin" or "owner" (typically to "member" in a members-only room or to "none" in other types of room).</p>
    <p class="caption"><a name="example-191" id="example-191"></a>Example 191. Owner Revokes Admin Status</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='admin2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          jid='wiccarocks@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The &lt;reason/&gt; element is OPTIONAL.</p>
    <p class="caption"><a name="example-192" id="example-192"></a>Example 192. Owner Revokes Admin Status (With a Reason)</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='admin2'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          jid='wiccarocks@shakespeare.lit'&gt;
      &lt;reason&gt;Not so worthy after all!&lt;/reason&gt; 
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service MUST remove the user from the admin list and then inform the owner of success:</p>
    <p class="caption"><a name="example-193" id="example-193"></a>Example 193. Service Informs Owner of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='admin2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>If the user is in the room, the service MUST then send updated presence from this individual to all occupants, indicating the loss of admin status by sending a presence element that contains an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value other than "admin" or "owner" and the 'role' attribute set to an appropriate value given the affiliation level and the room type (typically "participant").</p>
    <p class="caption"><a name="example-194" id="example-194"></a>Example 194. Service Notes Loss of Admin Affiliation</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='coven@chat.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none'
          jid='wiccarocks@shakespeare.lit'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

[ ... ]
    </pre></div>
    <p>If the user is not in the room, the service MAY send a message from the room itself to the room occupants, indicating the loss of admin status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value other than "admin".</p>
    <p class="caption"><a name="example-195" id="example-195"></a>Example 195. Service Notes Loss of Admin Affiliation</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='chat.shakespeare.lit'
    id='2CF9013B-E8A8-42A1-9633-85AD7CA12F40'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none'
          jid='wiccarocks@shakespeare.lit'
          role='none'/&gt;
  &lt;/x&gt;
&lt;/message&gt;

[ ... ]
    </pre></div>
  </div>

  <div class="indent"><h3>10.8 <a name="modifyadmin" id="modifyadmin">Modifying the Admin List</a></h3>
    <p>A room owner might want to modify the admin list. To do so, the owner first requests the admin list by querying the room for all users with an affiliation of 'admin'.</p>
    <p class="caption"><a name="example-196" id="example-196"></a>Example 196. Owner Requests Admin List</p><div class="indent"><pre class="prettyprint">
&lt;iq from='bard@shakespeare.lit/desktop'
    id='admin3'
    to='coven@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>If the &lt;user@host&gt; of the 'from' address does not match the bare JID of a room owner, the service MUST return a &lt;forbidden/&gt; error to the sender.</p>
    <p>Otherwise, the service MUST then return the admin list to the owner; each item MUST include the 'affiliation' and 'jid' attributes and MAY include the 'nick' and 'role' attributes for any admin that is currently an occupant:</p>
    <p class="caption"><a name="example-197" id="example-197"></a>Example 197. Service Sends Admin List to Owner</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='admin3'
    to='bard@shakespeare.lit/globe'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit'
          nick='secondwitch'/&gt;
    &lt;item affiliation='admin'
          jid='hag66@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The owner can then modify the admin list if desired. In order to do so, the owner MUST send the changed items (i.e., only the "delta") back to the service;  [<a href="#nt-idp2611744">29</a>] each item MUST include the 'affiliation' attribute (normally set to a value of "admin" or "none") and 'jid' attribute but SHOULD NOT include the 'nick' attribute and MUST NOT include the 'role' attribute (which is used to manage roles such as participant rather than affiliations such as owner).</p>
    <p class="caption"><a name="example-198" id="example-198"></a>Example 198. Owner Sends Modified Admin List to Service</p><div class="indent"><pre class="prettyprint">
&lt;iq from='bard@shakespeare.lit/globe'
    id='admin4'
    to='coven@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit'&gt;
    &lt;/item&gt;
    &lt;item affiliation='admin'
          jid='hecate@shakespeare.lit'&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Only owners shall be allowed to modify the admin list. If a non-owner attempts to view or modify the admin list, the service MUST deny the request and return a &lt;forbidden/&gt; error to the sender.</p>
    <p class="caption"><a name="example-199" id="example-199"></a>Example 199. Service Returns Error on Attempt by Non-Owner to Modify Admin List</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='admintest'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p>Otherwise, the service MUST modify the admin list and then inform the owner of success:</p>
    <p class="caption"><a name="example-200" id="example-200"></a>Example 200. Service Informs Owner of Success</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@chat.shakespeare.lit'
    id='admin4'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>The service MUST also send presence notifications related to any affiliation changes that result from modifying the admin list as previously described.</p>
  </div>

  <div class="indent"><h3>10.9 <a name="destroyroom" id="destroyroom">Destroying a Room</a></h3>
    <p>A room owner MUST be able to destroy a room, especially if the room is persistent. The workflow is as follows:</p>
    <ol start="1">
      <li><p>The room owner requests that the room be destroyed, optionally specifying a reason and an alternate venue.</p></li>
      <li><p>The room removes all users from the room (including appropriate information about the alternate location and the reason for being removed) and destroys the room, even if it was defined as persistent.</p></li>
    </ol>
    <p>Other than the foregoing, this document does not specify what (if anything) a MUC service implementation shall do as a result of a room destruction request. For example, if the room was defined as persistent, an implementation MAY choose to lock the room ID so that it cannot be re-used, redirect enter requests to the alternate venue, or invite the current participants to the new room; however, such behavior is OPTIONAL.</p>
    <p>In order to destroy a room, the room owner MUST send an IQ set to the address of the room to be destroyed. The &lt;iq/&gt; stanza shall contain a &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/muc#owner' namespace, which in turn shall contain a &lt;destroy/&gt; element. The address of the alternate venue MAY be provided as the value of the &lt;destroy/&gt; element's 'jid' attribute. A password for the alternate venue MAY be provided as the XML character data of a &lt;password/&gt; child element of the &lt;destroy/&gt; element. The reason for the room destruction MAY be provided as the XML character data of a &lt;reason/&gt; child element of the &lt;destroy/&gt; element.</p>
    <p>The following examples illustrate the protocol elements to be sent and received:</p>
    <p class="caption"><a name="example-201" id="example-201"></a>Example 201. Owner Submits Room Destruction Request</p><div class="indent"><pre class="prettyprint">
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='begone'
    to='heath@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;destroy jid='coven@chat.shakespeare.lit'&gt;
      &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;
    &lt;/destroy&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p>The service is responsible for removing all the occupants. It SHOULD NOT broadcast presence stanzas of type "unavailable" from all occupants, instead sending only one presence stanza of type "unavailable" to each occupant so that the user knows he or she has been removed from the room. If extended presence information specifying the JID of an alternate location and the reason for the room destruction was provided by the room owner, the presence stanza MUST include that information.</p>
    <p class="caption"><a name="example-202" id="example-202"></a>Example 202. Service Removes Each Occupant</p><div class="indent"><pre class="prettyprint">
&lt;presence
    from='heath@chat.shakespeare.lit/firstwitch'
    to='crone1@shakespeare.lit/desktop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'/&gt;
    &lt;destroy jid='coven@chat.shakespeare.lit'&gt;
      &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;
    &lt;/destroy&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='heath@chat.shakespeare.lit/secondwitch'
    to='wiccarocks@shakespeare.lit/laptop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'/&gt;
    &lt;destroy jid='coven@chat.shakespeare.lit'&gt;
      &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;
    &lt;/destroy&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='heath@chat.shakespeare.lit/thirdwitch'
    to='hag66@shakespeare.lit/pda'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'/&gt;
    &lt;destroy jid='coven@chat.shakespeare.lit'&gt;
      &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;
    &lt;/destroy&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p class="caption"><a name="example-203" id="example-203"></a>Example 203. Service Informs Owner of Successful Destruction</p><div class="indent"><pre class="prettyprint">
&lt;iq from='heath@chat.shakespeare.lit'
    id='begone'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p>If the &lt;user@host&gt; of the 'from' address received on a destroy request does not match the bare JID of a room owner, the service MUST return a &lt;forbidden/&gt; error to the sender:</p>
    <p class="caption"><a name="example-204" id="example-204"></a>Example 204. Service Denies Destroy Request Submitted by Non-Owner</p><div class="indent"><pre class="prettyprint">
&lt;iq from='heath@chat.shakespeare.lit'
    id='destroytest'
    to='wiccarocks@shakespeare.lit/laptop'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;destroy jid='coven@chat.shakespeare.lit'&gt;
      &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;
    &lt;/destroy&gt;
  &lt;/query&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>

<h2>11.
       <a name="statuscodes" id="statuscodes">Status Codes</a></h2>
  <p>Multi-User Chat uses a &lt;status/&gt; element (specifically, the 'code' attribute of the &lt;status/&gt; element) to communicate information about a user's status in a room. Over time, the number of status codes has grown quite large, and new status codes continue to be requested of the author. Therefore, these codes are now documented in a registry maintained by the XMPP Registrar. For details, refer to the <a href="#registrar-statuscodes">Status Codes Registry</a> section of this document.</p>
  <p>Note: In general, MUC status codes tend to follow the "philosophy" of status codes that is implicit in <span class="ref"><a href="http://tools.ietf.org/html/rfc2616">RFC 2616</a></span>  [<a href="#nt-idp2635712">30</a>] and <span class="ref"><a href="http://tools.ietf.org/html/rfc1893">RFC 1893</a></span>  [<a href="#nt-idp2638432">31</a>] (1xx codes are informational, 2xx codes specify that it is fine to continue, 3xx codes specify redirects such as being kicked or banned, x3x codes refer to system status, x7x codes refer to security or policy matters, etc.).</p>
  <p>Note: If the MUC protocol were being designed today, it would specify a more flexible, XML-friendly approach rather than hardcoded status numbers; however, at this point the pain of changing the status reporting system would be greater than the benefit of doing so, which is why the status code numbers remain in use. A future version of this document may define a more XMPP-like approach to status conditions, retaining the code numbers but supplementing them with more descriptive child elements as is done in <span class="ref">RFC 6120</span>.</p>
<h2>12.
       <a name="i18n" id="i18n">Internationalization Considerations</a></h2>
  <p>As specified in <span class="ref">RFC 6120</span>, XMPP entities (including MUC rooms and MUC services) SHOULD respect the value of the 'xml:lang' attribute provided with any given stanza. However, simultaneous translation of groupchat messages is out of scope for this document (see <span class="ref"><a href="http://xmpp.org/extensions/xep-0171.html">Language Translation (XEP-0171)</a></span>  [<a href="#nt-idp2648656">32</a>]).</p>
  <p>The status and error codes defined herein enable a client implementation to present a localized interface; however, definition of the localized text strings for any given language community is out of scope for this document.</p>
  <p>Although the labels for various data form fields are shown here in English, MUC clients SHOULD present localized text for these fields rather than the English text.</p>
  <p>Nicknames can contain virtually any Unicode character. This introduces the possibility of nick spoofing; see <span class="ref"><a href="http://tools.ietf.org/html/rfc6122">RFC 6122</a></span>  [<a href="#nt-idp2646192">33</a>] for a description of related security considerations.</p>
<h2>13.
       <a name="security" id="security">Security Considerations</a></h2>
  <div class="indent"><h3>13.1 <a name="security-auth" id="security-auth">User Authentication and Authorization</a></h3>
    <p>No room entrance authentication or authorization method more secure than cleartext passwords is defined or required by this document. Although the risks involved can mitigated somewhat by the use of channel encryption and strong authentication via TLS and SASL as described in <span class="ref">RFC 6120</span>, an entity that joins a room has no way of knowing if its complete communication channel to the room is encrypted (thereby protecting the plaintext password). A future specification might define an XMPP profile of SASL for use with MUC, but currently there is no such specification.</p>
  </div>

  <div class="indent"><h3>13.2 <a name="security-e2e" id="security-e2e">End-to-End Encryption</a></h3>
    <p>No end-to-end message or session encryption method is specified herein. Users SHOULD NOT trust a service to keep secret any text sent through a room. A future specification might define a method for end-to-end encryption of MUC traffic, but currently there is no such specification.</p>
  </div>

  <div class="indent"><h3>13.3 <a name="security-privacy" id="security-privacy">Privacy</a></h3>
    <p>Depending on room configuration, a room might publicly log all discussions held in the room. A service MUST warn the user that the room is publicly logged by returning a status code of "170" with the user's initial presence, and the user's client MUST warn the user if the room discussion is logged (a user's client SHOULD also query the room for its configuration prior to allowing the user to enter in order to "pre-discover" whether the room is logged). A client MUST also warn the user if the room's configuration is subsequently modified to allow room logging (which the client will discover when the room sends status code 170).</p>
    <p>Note: In-room history is different from public room logging, and naturally a room cannot effectively prevent occupants from separately maintaining their own room logs, which may become public; users SHOULD exercise due caution and consider any room discussions to be effectively public.</p>
  </div>

  <div class="indent"><h3>13.4 <a name="security-leaks" id="security-leaks">Information Leaks</a></h3>
    <p>The "roominfo" data form used in extended service discovery can result in information leaks, e.g., the current discussion topic (via the "roominfo_subject" field). The same is true of service discovery items (disco#items) requests from outside the room (which could be used to discover the list of room occupants).</p>
    <p>Implementations and deployments are advised to carefully consider the possibility that this information might be leaked, and to turn off information sharing by default for sensitive data.</p> 
  </div>

  <div class="indent"><h3>13.5 <a name="security-anon" id="security-anon">Anonymity</a></h3>
    <p>Depending on room configuration, a room might expose each occupant's real JID to other occupants (if the room is non-anonymous). If real JIDs are exposed to all occupants in the room, the service MUST warn the user by returning a status code of "100" with the user's initial presence, and the user's client MUST warn the user (a user's client SHOULD also query the room for its configuration prior to allowing the user to enter in order to "pre-discover" whether real JIDs are exposed in the room). A client MUST also warn the user if the room's configuration is modified from semi-anonymous to non-anonymous (which the client will discover when the room sends status code 172).</p>
  </div>

  <div class="indent"><h3>13.6 <a name="security-dos" id="security-dos">Denial of Service</a></h3>
    <p>Public MUC rooms can be subject to a number of attacks, most of which reduce to denial of service attacks. Such attacks include but are not limited to:</p>
    <ol>
      <li>Stuffing the room with a large number of illegitimate occupants and therefore preventing legitimate users from joining the room.</li>
      <li>Sending abusive messages and then leaving the room before a kick or ban can be applied; such abusive messages include but are not limited to large messages that prevent participants from following the conversation thread or room history, personal attacks on participants (especially room administrators and moderators), offensive text, and links to spam sites.</li>
      <li>Making rapid and repeated presence changes.</li>
      <li>Using long nicknames to route around lack of voice.</li>
      <li>Abusing the room administrators or other room occupants.</li>
      <li>Registering multiple nicknames across a service and therefore denying the use of those nicknames.</li>
      <li>Mimicking another occupant's roomnick (e.g., by adding a space at the end or substituting visually similar characters), then sending messages from that roomnick in an effort to confuse the occupants.</li>
    </ol>
    <p>These attacks can be mitigated but not completely prevented through the liberal use of administrative actions such as banning, the presence of automated room bots with admin status, implementation of intelligent content filtering, checking the IP addresses of connected users (not always possible in a distributed system), applying voice rules to presence as well as messaging, matching room nicks using more stringent rules than the Resourceprep profile of stringprep, etc. However, experience has shown that it is impossible to fully prevent attacks of this kind.</p>
    <p>Public MUC services also can be subject to attacks, such as creating a large number of rooms on a service, leaving rooms in an unconfigured state, etc. Such service-level attacks can be mitigated by limiting the number of rooms that any given non-adminstrative user can own, deleting rooms if they remain in the unconfigured state for too long, etc.</p>
  </div>

  <div class="indent"><h3>13.7 <a name="security-other" id="security-other">Other Considerations</a></h3>
    <p>See <span class="ref">XEP-0203</span> for security considerations regarding the inclusion and processing of delayed delivery notations.</p>
  </div>

<h2>14.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p>This document requires no interaction with the <span class="ref"><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-idp2672944">34</a>].</p>
<h2>15.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
  <p>The <span class="ref"><a href="http://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-idp2681360">35</a>] includes the following information in its registries.</p>
  <div class="indent"><h3>15.1 <a name="registrar-protocol" id="registrar-protocol">Protocol Namespaces</a></h3>
    <p>The XMPP Registrar includes the following MUC-related namespaces in its registry of protocol namespaces at &lt;<a href="http://xmpp.org/registrar/namespaces.html">http://xmpp.org/registrar/namespaces.html</a>&gt;:</p>
    <ul>
      <li>http://jabber.org/protocol/muc</li>
      <li>http://jabber.org/protocol/muc#admin</li>
      <li>http://jabber.org/protocol/muc#owner</li>
      <li>http://jabber.org/protocol/muc#user</li>
    </ul>
  </div>

  <div class="indent"><h3>15.2 <a name="registrar-discocat" id="registrar-discocat">Service Discovery Category/Type</a></h3>
    <p>A Multi-User Chat service or room is identified by the "conference" category and the "text" type within Service Discovery.</p>
  </div>

  <div class="indent"><h3>15.3 <a name="registrar-features" id="registrar-features">Service Discovery Features</a></h3>
    <p>There are many features related to a MUC service or room that can be discovered by means of Service Discovery. The most fundamental of these is the 'http://jabber.org/protocol/muc' namespace. In addition, a MUC room SHOULD provide information about the specific room features it implements, such as password protection and room moderation.</p>
    <p class="caption">Registry Submission</p><div class="indent"><pre class="prettyprint">
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#register&lt;/name&gt;
  &lt;desc&gt;Support for the muc#register FORM_TYPE&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#roomconfig&lt;/name&gt;
  &lt;desc&gt;Support for the muc#roomconfig FORM_TYPE&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#roominfo&lt;/name&gt;
  &lt;desc&gt;Support for the muc#roominfo FORM_TYPE&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_hidden&lt;/name&gt;
  &lt;desc&gt;Hidden room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_membersonly&lt;/name&gt;
  &lt;desc&gt;Members-only room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_moderated&lt;/name&gt;
  &lt;desc&gt;Moderated room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_nonanonymous&lt;/name&gt;
  &lt;desc&gt;Non-anonymous room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_open&lt;/name&gt;
  &lt;desc&gt;Open room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_passwordprotected&lt;/name&gt;
  &lt;desc&gt;Password-protected room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_persistent&lt;/name&gt;
  &lt;desc&gt;Persistent room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_public&lt;/name&gt;
  &lt;desc&gt;Public room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_rooms&lt;/name&gt;
  &lt;desc&gt;List of MUC rooms (each as a separate item)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_semianonymous&lt;/name&gt;
  &lt;desc&gt;Semi-anonymous room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_temporary&lt;/name&gt;
  &lt;desc&gt;Temporary room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_unmoderated&lt;/name&gt;
  &lt;desc&gt;Unmoderated room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_unsecured&lt;/name&gt;
  &lt;desc&gt;Unsecured room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
&lt;/var&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>15.4 <a name="registrar-nodes" id="registrar-nodes">Well-Known Service Discovery Nodes</a></h3>
    <p>The well-known Service Discovery node 'http://jabber.org/protocol/muc#rooms' enables discovery of the rooms in which a user is an occupant.</p>
    <p>The well-known Service Discovery node 'x-roomuser-item' enables a user to discover his or her registered roomnick from outside the room.</p>
    <p>The well-known Service Discovery node 'http://jabber.org/protocol/muc#traffic' enables discovery of the namespaces that are allowed in traffic sent through a room (see the <a href="#impl-service-traffic">Allowable Traffic</a> section of this document).</p>
  </div>

  <div class="indent"><h3>15.5 <a name="registrar-formtype" id="registrar-formtype">Field Standardization</a></h3>
    <p><span class="ref"><a href="http://xmpp.org/extensions/xep-0068.html">Field Standardization for Data Forms (XEP-0068)</a></span>  [<a href="#nt-idp2694288">36</a>] defines a process for standardizing the fields used within Data Forms qualified by a particular FORM_TYPE. Within MUC, there are four uses of such forms: room registration (the "muc#register" FORM_TYPE), requesting voice and approving voice requests ("muc#request"), room configuration ("muc#roomconfig"), and service discovery extensions for room information ("muc#roominfo"). The reserved fields are defined below.</p>
    <div class="indent"><h3>15.5.1 <a name="registrar-formtype-register" id="registrar-formtype-register">muc#register FORM_TYPE</a></h3>
      <p class="caption">Registry Submission</p><div class="indent"><pre class="prettyprint">
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#register&lt;/name&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
  &lt;desc&gt;
    Forms enabling user registration with a
    Multi-User Chat (MUC) room or admin approval
    of user registration requests.
  &lt;/desc&gt;
  &lt;field 
     var='muc#register_allow'
     type='boolean'
     label='Allow this person to register with the room?'/&gt;
  &lt;field
      var='muc#register_email'
      type='text-single'
      label='Email Address'/&gt;
  &lt;field
      var='muc#register_faqentry'
      type='text-multi'
      label='FAQ Entry'/&gt;
  &lt;field
      var='muc#register_first'
      type='text-single'
      label='Given Name'/&gt;
  &lt;field
      var='muc#register_last'
      type='text-single'
      label='Family Name'/&gt;
  &lt;field
      var='muc#register_roomnick'
      type='text-single'
      label='Desired Nickname'/&gt;
  &lt;field
      var='muc#register_url'
      type='text-single'
      label='A Web Page'/&gt;
&lt;/form_type&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>15.5.2 <a name="registrar-formtype-request" id="registrar-formtype-request">muc#request FORM_TYPE</a></h3>
      <p class="caption">Registry Submission</p><div class="indent"><pre class="prettyprint">
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#request&lt;/name&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
  &lt;desc&gt;
    Forms enabling voice requests in a 
    Multi-User Chat (MUC) room or admin
    approval of such requests.
  &lt;/desc&gt;
  &lt;field var='muc#role'
         type='text-single'
         label='Requested role'/&gt;
  &lt;field var='muc#jid'
         type='jid-single'
         label='User ID'/&gt;
  &lt;field var='muc#roomnick'
         type='text-single'
         label='Room Nickname'/&gt;
  &lt;field var='muc#request_allow'
         type='boolean'
         label='Whether to grant voice'/&gt;
&lt;/form_type&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>15.5.3 <a name="registrar-formtype-owner" id="registrar-formtype-owner">muc#roomconfig FORM_TYPE</a></h3>
      <p class="caption">Registry Submission</p><div class="indent"><pre class="prettyprint">
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#roomconfig&lt;/name&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
  &lt;desc&gt;
    Forms enabling creation and configuration of
    a Multi-User Chat (MUC) room.
  &lt;/desc&gt;
  &lt;field
      var='muc#maxhistoryfetch'
      type='text-single'
      label='Maximum Number of History Messages Returned by Room'/&gt;
  &lt;field
      var='muc#roomconfig_allowpm'
      type='boolean'
      label='Roles that May Send Private Messages'/&gt;
  &lt;field
      var='muc#roomconfig_allowinvites'
      type='list-single'
      label='Whether to Allow Occupants to Invite Others'/&gt;
  &lt;field
      var='muc#roomconfig_changesubject'
      type='boolean'
      label='Whether to Allow Occupants to Change Subject'/&gt;
  &lt;field
      var='muc#roomconfig_enablelogging'
      type='boolean'
      label='Whether to Enable Public Logging of Room Conversations'/&gt;
  &lt;field
      var='muc#roomconfig_getmemberlist'
      type='list-multi'
      label='Roles and Affiliations that May Retrieve Member List'/&gt;
  &lt;field
      var='muc#roomconfig_lang'
      type='text-single'
      label='Natural Language for Room Discussions'/&gt;
  &lt;field
      var='muc#roomconfig_pubsub'
      type='text-single'
      label='XMPP URI of Associated Publish-Subcribe Node'/&gt;
  &lt;field
      var='muc#roomconfig_maxusers'
      type='list-single'
      label='Maximum Number of Room Occupants'/&gt;
  &lt;field
      var='muc#roomconfig_membersonly'
      type='boolean'
      label='Whether to Make Room Members-Only'/&gt;
  &lt;field
      var='muc#roomconfig_moderatedroom'
      type='boolean'
      label='Whether to Make Room Moderated'/&gt;
  &lt;field
      var='muc#roomconfig_passwordprotectedroom'
      type='boolean'
      label='Whether a Password is Required to Enter'/&gt;
  &lt;field
      var='muc#roomconfig_persistentroom'
      type='boolean'
      label='Whether to Make Room Persistent'/&gt;
  &lt;field
      var='muc#roomconfig_presencebroadcast'
      type='list-multi'
      label='Roles for which Presence is Broadcasted'/&gt;
  &lt;field
      var='muc#roomconfig_publicroom'
      type='boolean'
      label='Whether to Allow Public Searching for Room'/&gt;
  &lt;field
      var='muc#roomconfig_roomadmins'
      type='jid-multi'
      label='Full List of Room Admins'/&gt;
  &lt;field
      var='muc#roomconfig_roomdesc'
      type='text-single'
      label='Short Description of Room'/&gt;
  &lt;field
      var='muc#roomconfig_roomname'
      type='text-single'
      label='Natural-Language Room Name'/&gt;
  &lt;field
      var='muc#roomconfig_roomowners'
      type='jid-multi'
      label='Full List of Room Owners'/&gt;
  &lt;field
      var='muc#roomconfig_roomsecret'
      type='text-single'
      label='The Room Password'/&gt;
  &lt;field
      var='muc#roomconfig_whois'
      type='list-single'
      label='Affiliations that May Discover Real JIDs of Occupants'/&gt;
&lt;/form_type&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>15.5.4 <a name="registrar-formtype-roominfo" id="registrar-formtype-roominfo">muc#roominfo FORM_TYPE</a></h3>
      <p class="caption">Registry Submission</p><div class="indent"><pre class="prettyprint">
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#roominfo&lt;/name&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
  &lt;desc&gt;
    Forms enabling the communication of extended service discovery
    information about a Multi-User Chat (MUC) room.
  &lt;/desc&gt;
  &lt;field
      var='muc#maxhistoryfetch'
      type='text-single'
      label='Maximum Number of History Messages Returned by Room'/&gt;
  &lt;field
      var='muc#roominfo_contactjid'
      type='jid-multi'
      label='Contact Addresses (normally, room owner or owners)'/&gt;
  &lt;field
      var='muc#roominfo_description'
      type='text-single'
      label='Short Description of Room'/&gt;
  &lt;field
      var='muc#roominfo_lang'
      type='text-single'
      label='Natural Language for Room Discussions'/&gt;
  &lt;field
      var='muc#roominfo_ldapgroup'
      type='text-single'
      label='An associated LDAP group that defines 
             room membership; this should be an LDAP 
             Distinguished Name according to an 
             implementation-specific or 
             deployment-specific definition of a 
             group.'/&gt;
  &lt;field
      var='muc#roominfo_logs'
      type='text-single'
      label='URL for Archived Discussion Logs'/&gt;
  &lt;field
      var='muc#roominfo_occupants'
      type='text-single'
      label='Current Number of Occupants in Room'/&gt;
  &lt;field
      var='muc#roominfo_subject'
      type='text-single'
      label='Current Discussion Topic'/&gt;
  &lt;field
      var='muc#roominfo_subjectmod'
      type='boolean'
      label='The room subject can be modified by participants'/&gt;
&lt;/form_type&gt;
      </pre></div>
    </div>

  </div>

  <div class="indent"><h3>15.6 <a name="registrar-statuscodes" id="registrar-statuscodes">Status Codes Registry</a></h3>
    <div class="indent"><h3>15.6.1 <a name="registrar-statuscodes-process" id="registrar-statuscodes-process">Process</a></h3>
      <p>The XMPP Registrar maintains a registry at &lt;<a href="http://xmpp.org/registrar/mucstatus.html">http://xmpp.org/registrar/mucstatus.html</a>&gt; that defines values for the 'code' attribute of the &lt;status/&gt; element when qualified by the 'http://jabber.org/protocol/muc#user' namespace.</p>
      <p>In order to submit new values to this registry, the registrant shall define an XML fragment of the following form and either include it in the relevant XMPP Extension Protocol or send it to the email address &lt;registrar@xmpp.org&gt;:</p>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;statuscode&gt;
  &lt;number&gt;
    the three-digit code number
  &lt;/number&gt;
  &lt;stanza&gt;
    the stanza type of which it is a child (message or presence)
  &lt;/stanza&gt;
  &lt;context&gt;
    the use case or situation in which the status is used
  &lt;/context&gt;
  &lt;purpose&gt;
    a natural-language description of the meaning
  &lt;/purpose&gt;
  &lt;child&gt;
    the descriptive child element (reserved for future use)
  &lt;/child&gt;
&lt;/statuscode&gt;
      </pre></div>
      <p>The registrant may register more than one status code at a time, each contained in a separate &lt;statuscode/&gt; element.</p>
    </div>

    <div class="indent"><h3>15.6.2 <a name="registrar-statuscodes-init" id="registrar-statuscodes-init">Initial Submission</a></h3>
      <p>As part of this document, the following status codes are registered:</p>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;statuscode&gt;
  &lt;number&gt;100&lt;/number&gt;
  &lt;stanza&gt;message or presence&lt;/stanza&gt;
  &lt;context&gt;Entering a room&lt;/context&gt;
  &lt;purpose&gt;
    Inform user that any occupant is allowed to see the user's full JID
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;101&lt;/number&gt;
  &lt;stanza&gt;message (out of band)&lt;/stanza&gt;
  &lt;context&gt;Affiliation change&lt;/context&gt;
  &lt;purpose&gt;
    Inform user that his or her affiliation changed while not in the room
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;102&lt;/number&gt;
  &lt;stanza&gt;message&lt;/stanza&gt;
  &lt;context&gt;Configuration change&lt;/context&gt;
  &lt;purpose&gt;
    Inform occupants that room now shows unavailable members
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;103&lt;/number&gt;
  &lt;stanza&gt;message&lt;/stanza&gt;
  &lt;context&gt;Configuration change&lt;/context&gt;
  &lt;purpose&gt;
    Inform occupants that room now does not show unavailable members
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;104&lt;/number&gt;
  &lt;stanza&gt;message&lt;/stanza&gt;
  &lt;context&gt;Configuration change&lt;/context&gt;
  &lt;purpose&gt;
    Inform occupants that a non-privacy-related room configuration change has occurred
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;110&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Any room presence&lt;/context&gt;
  &lt;purpose&gt;
    Inform user that presence refers to itself
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;170&lt;/number&gt;
  &lt;stanza&gt;message or initial presence&lt;/stanza&gt;
  &lt;context&gt;Configuration change&lt;/context&gt;
  &lt;purpose&gt;
    Inform occupants that room logging is now enabled
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;171&lt;/number&gt;
  &lt;stanza&gt;message&lt;/stanza&gt;
  &lt;context&gt;Configuration change&lt;/context&gt;
  &lt;purpose&gt;
    Inform occupants that room logging is now disabled
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;172&lt;/number&gt;
  &lt;stanza&gt;message&lt;/stanza&gt;
  &lt;context&gt;Configuration change&lt;/context&gt;
  &lt;purpose&gt;
    Inform occupants that the room is now non-anonymous
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;173&lt;/number&gt;
  &lt;stanza&gt;message&lt;/stanza&gt;
  &lt;context&gt;Configuration change&lt;/context&gt;
  &lt;purpose&gt;
    Inform occupants that the room is now semi-anonymous
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;201&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Entering a room&lt;/context&gt;
  &lt;purpose&gt;
    Inform user that a new room has been created
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;210&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Entering a room, changing nickname, etc.&lt;/context&gt;
  &lt;purpose&gt;
    Inform user that service has assigned or modified occupant's roomnick
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;301&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Removal from room&lt;/context&gt;
  &lt;purpose&gt;
    Inform user that he or she has been banned from the room
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;303&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Exiting a room&lt;/context&gt;
  &lt;purpose&gt;
    Inform all occupants of new room nickname
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;307&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Removal from room&lt;/context&gt;
  &lt;purpose&gt;
    Inform user that he or she has been kicked from the room
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;321&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Removal from room&lt;/context&gt;
  &lt;purpose&gt;
    Inform user that he or she is being removed from the room 
    because of an affiliation change
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;322&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Removal from room&lt;/context&gt;
  &lt;purpose&gt;
    Inform user that he or she is being removed from the room 
    because the room has been changed to members-only and the
    user is not a member
  &lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;332&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Removal from room&lt;/context&gt;
  &lt;purpose&gt;
    Inform user that he or she is being removed from the room 
    because the MUC service is being shut down
  &lt;/purpose&gt;
&lt;/statuscode&gt;
      </pre></div>
    </div>

  </div>

  <div class="indent"><h3>15.7 <a name="registrar-querytypes" id="registrar-querytypes">URI Query Types</a></h3>
    <p>As authorized by <span class="ref"><a href="http://xmpp.org/extensions/xep-0147.html">XMPP URI Query Components (XEP-0147)</a></span>  [<a href="#nt-idp1870864">37</a>], the XMPP Registrar maintains a registry of queries and key-value pairs for use in XMPP URIs (see &lt;<a href="http://xmpp.org/registrar/querytypes.html">http://xmpp.org/registrar/querytypes.html</a>&gt;).</p>
    <div class="indent"><h3>15.7.1 <a name="registrar-querytypes-join" id="registrar-querytypes-join">join</a></h3>
      <p>The "join" querytype is registered as a MUC-related action, with an optional key of "password".</p>
      <p class="caption"><a name="example-205" id="example-205"></a>Example 205. Join Action: IRI/URI</p><div class="indent"><pre class="prettyprint">
xmpp:coven@chat.shakespeare.lit?join
      </pre></div>
      <p>The application MUST either present an interface enabling the user to provide a room nickname or populate the room nickname based on configured preferences or nickname discovery.</p> 
      <p class="caption"><a name="example-206" id="example-206"></a>Example 206. Join Action: Resulting Stanza</p><div class="indent"><pre class="prettyprint">
&lt;presence to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p>The join action MAY include a password for the room. Naturally, access to a URI that includes a room password MUST be appropriately controlled.</p>
      <p class="caption"><a name="example-207" id="example-207"></a>Example 207. Join Action with Password: IRI/URI</p><div class="indent"><pre class="prettyprint">
xmpp:coven@chat.shakespeare.lit?join;password=cauldronburn
      </pre></div>
      <p class="caption"><a name="example-208" id="example-208"></a>Example 208. Join Action with Password: Resulting Stanza</p><div class="indent"><pre class="prettyprint">
&lt;presence to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;password&gt;cauldronburn&lt;/password&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p>The following submission registers the "join" querytype.</p>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;querytype&gt;
  &lt;name&gt;join&lt;/name&gt;
  &lt;proto&gt;http://jabber.org/protocol/muc&lt;/proto&gt;
  &lt;desc&gt;enables joining a multi-user chat room&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
  &lt;keys&gt;
    &lt;key&gt;
      &lt;name&gt;password&lt;/name&gt;
      &lt;desc&gt;the password required to enter the room&lt;/desc&gt;
    &lt;/key&gt;
  &lt;/keys&gt;
&lt;/querytype&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>15.7.2 <a name="registrar-querytypes-invite" id="registrar-querytypes-invite">invite</a></h3>
      <p>The "invite" querytype is registered as a MUC-related action, with an optional key of "jid".</p>
      <p class="caption"><a name="example-209" id="example-209"></a>Example 209. Invite Action: IRI/URI</p><div class="indent"><pre class="prettyprint">
xmpp:coven@chat.shakespeare.lit?invite;jid=hecate@shakespeare.lit
      </pre></div>
      <p>If the joining user is not yet in the room, the application MUST send two stanzas: the first to join the room and the second to invite the other individual. If the joining user is in the room already, the application shall send only the invitation stanza.</p>
      <p class="caption"><a name="example-210" id="example-210"></a>Example 210. Invite Action: Resulting Stanza(s)</p><div class="indent"><pre class="prettyprint">
&lt;presence to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;

&lt;message to='coven@chat.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='hecate@shakespeare.lit'/&gt;
  &lt;/x&gt;
&lt;/message&gt;
      </pre></div>
      <p>The URI can include multiple invitees:</p>
      <p class="caption"><a name="example-211" id="example-211"></a>Example 211. Invite Action With Multiple Invitees: IRI/URI</p><div class="indent"><pre class="prettyprint">
xmpp:coven@chat.shakespeare.lit?invite;jid=hecate@shakespeare.lit;jid=bard@shakespeare.lit
      </pre></div>
      <p class="caption"><a name="example-212" id="example-212"></a>Example 212. Invite Action With Multiple Invitees: Resulting Stanza</p><div class="indent"><pre class="prettyprint">
&lt;message to='coven@chat.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='hecate@shakespeare.lit'/&gt;
    &lt;invite to='bard@shakespeare.lit'/&gt;
  &lt;/x&gt;
&lt;/message&gt;
      </pre></div>
      <p>The URI can also include a password:</p>
      <p class="caption"><a name="example-213" id="example-213"></a>Example 213. Invite Action With Password: IRI/URI</p><div class="indent"><pre class="prettyprint">
xmpp:coven@chat.shakespeare.lit?invite;jid=hecate@shakespeare.lit;password=cauldronburn
      </pre></div>
      <p class="caption"><a name="example-214" id="example-214"></a>Example 214. Invite Action With Password: Resulting Stanza(s)</p><div class="indent"><pre class="prettyprint">
&lt;presence to='coven@chat.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;

&lt;message to='coven@chat.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='hecate@shakespeare.lit'/&gt;
    &lt;password&gt;cauldronburn&lt;/password&gt;
  &lt;/x&gt;
&lt;/message&gt;
      </pre></div>
      <p>The following submission registers the "invite" querytype.</p>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;querytype&gt;
  &lt;name&gt;invite&lt;/name&gt;
  &lt;proto&gt;http://jabber.org/protocol/muc&lt;/proto&gt;
  &lt;desc&gt;enables simultaneously joining a groupchat room and inviting others&lt;/desc&gt;
  &lt;doc&gt;XEP-0045&lt;/doc&gt;
  &lt;keys&gt;
    &lt;key&gt;
      &lt;name&gt;jid&lt;/name&gt;
      &lt;desc&gt;the Jabber ID of the invitee&lt;/desc&gt;
    &lt;/key&gt;
    &lt;key&gt;
      &lt;name&gt;password&lt;/name&gt;
      &lt;desc&gt;the password required to enter a multi-user chat room&lt;/desc&gt;
    &lt;/key&gt;
  &lt;/keys&gt;
&lt;/querytype&gt;
      </pre></div>
    </div>

  </div>

<h2>16.
       <a name="bizrules" id="bizrules">Business Rules</a></h2>
  <div class="indent"><h3>16.1 <a name="bizrules-jids" id="bizrules-jids">Addresses</a></h3>
    <p>In order to provide consistency regarding the addresses captured in room JIDs and occupant JIDs, Room IDs MUST match the Nodeprep profile of Stringprep and Room Nicknames MUST match the Resourceprep profile of Stringprep (both of these are defined in <span class="ref">RFC 6122</span>). As explicitly stated in <span class="ref">RFC 6122</span>, both the Room ID (node) and Room Nickname (resource) portions of an Occupant JID MUST be of non-zero length. In addition, a MUC service MUST NOT allow empty or invisible Room Nicknames (i.e., Room Nicknames that consist only of one or more space characters).</p>
    <p>It is up to the service implementation whether it will further restrict roomnicks (e.g., by applying case folding routines, the Nodeprep profile of stringprep, or other restrictions).</p>
  </div>

  <div class="indent"><h3>16.2 <a name="bizrules-message" id="bizrules-message">Message</a></h3>
    <ol start="1">
      <li><p>If an occupant wants to send a message to all other occupants, a MUC client MUST set the 'type' attribute to a value of "groupchat". A service MAY ignore messages that are improperly typed, or reject them with a &lt;bad-request/&gt; error.</p></li>
      <li><p>If a MUC service receives a message directed to the room or to a single occupant from a user who has a role of "none", the service MUST NOT deliver the message and SHOULD return the message to the sender with a &lt;forbidden/&gt; error.</p></li>
      <li><p>If a MUC service receives a message directed to a room that does not exist or is not yet unlocked, the service SHOULD return the message to the sender with an &lt;item-not-found/&gt; error.</p></li>
      <li><p>A MUC service SHOULD pass extended information (e.g., an XHTML version of the message body) through to occupants unchanged; however, a MUC service MAY disallow message specific extensions (see the <a href="#impl-service-traffic">Allowable Traffic</a> section of this document).</p></li>
      <li><p>A MUC client MAY generate extensions that conform to <span class="ref"><a href="http://xmpp.org/extensions/xep-0085.html">Chat State Notifications (XEP-0085)</a></span>  [<a href="#nt-idp2768976">38</a>] specification; however, a MUC service MAY disallow these extensions (see the <a href="#impl-service-traffic">Allowable Traffic</a> section of this document).</p></li>
    </ol>
  </div>

  <div class="indent"><h3>16.3 <a name="bizrules-presence" id="bizrules-presence">Presence</a></h3>
    <ol start="1">
      <li><p>The presence stanza used to join a room MUST NOT possess a 'type' attribute, i.e., it must be available presence. A MUC service MUST NOT treat a presence stanza with a 'type' attribute (e.g., a presence probe) as a request to join the room.</p></li>
      <li><p>The presence stanza used to exit a room MUST possess a 'type' attribute whose value is "unavailable". A MUC service MUST NOT treat a presence stanza with a 'type' attribute whose value is other than "unavailable" (e.g., a presence probe) as a request to exit the room.</p></li>
      <li><p>A MUC service MAY handle presence probes sent to the room JID &lt;room@service&gt; or an occupant JID &lt;room@service/nick&gt; (e.g, these might be sent by an occupant's home server to determine if the room is still online or to synchronize presence information if the user or the user's server has gone offline temporarily or has started sharing presence again, as for instance when <span class="ref"><a href="http://xmpp.org/extensions/xep-0273.html">Stanza Interception and Filtering Technology (XEP-0273)</a></span>  [<a href="#nt-idp2775600">39</a>] is used).</p></li>
      <li><p>A room MUST silently ignore unavailable presence received from a user who has a role of "none".</p></li>
      <li><p>Only the MUC service itself SHOULD generate data about roles, affiliations, full JIDs, or status codes qualified by the 'http://jabber.org/protocol/muc#user' namespace (based on information the service knows about occupants, e.g., roles, or as a result of actions taken by a moderator or room administrator). A client SHOULD NOT presume to generate such information. If a MUC service receives such extended presence information from an occupant, it MUST NOT reflect it to other occupants. (A client MAY generate extended presence information qualified by the 'http://jabber.org/protocol/muc#user' namespace in order to supply a password, but naturally this is not reflected to other occupants.)</p></li>
      <li><p>A MUC service SHOULD allow all other presence information to pass through, although it MAY choose to block extended presence information; see the <a href="#impl-service-traffic">Allowable Traffic</a> section of this document.</p></li>
      <li><p>In order to inform occupants of room roles and affiliations, and to make it easier for clients to track the current state of all users in the room, MUC service implementations MUST provide role and affiliation data (and, if allowed by the room configuration, full JID) in all presence stanzas, including presence stanzas of type "unavailable" sent when a user exits the room for any reason.</p></li>
      <li><p>If a role or affiliation is revoked, the service MUST note that fact by sending an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child element with the 'role' and/or 'affiliation' attributes set to a value that indicates the loss of the relevant status. All future presence stanzas for the occupant MUST include the updated role and affiliation, until and unless they change again.</p></li>
      <li><p>A MUC service MUST include the MUC extensions even if the client did not send an empty &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc' namespace on entering the room; naturally, a client MUST ignore such information if it does not understand it (in accordance with <span class="ref">RFC 6120</span>).</p></li>
      <li><p>If the service includes an occupant's JabberID in the MUC presence extension, the value of the 'jid' attribute MUST be the full JID (not the bare JID).</p></li>
      <li><p>A client MAY send a custom exit message if desired (as is often done in IRC channels) by including a &lt;status/&gt; element in the presence stanza of type "unavailable" sent when <a href="#exit">exiting a room</a>.</p></li>
    </ol>
  </div>

  <div class="indent"><h3>16.4 <a name="bizrules-iq" id="bizrules-iq">IQ</a></h3>
    <ol start="1">
      <li><p>MUC is designed for sharing of messages and presence, not IQs. An IQ sent to the JID of the room itself is handled by the room and is not reflected to all of the room occupants.</p></li>
      <li><p>If an occupant wants to send an IQ stanza to another user in a non-anonymous room, the sender SHOULD send the request directly to the recipient's bare JID or full JID, rather than attempting to send the request through the room (i.e., via the recipient's occupant JID).</p></li>
      <li><p>If an occupant wants to send an IQ stanza to another user in a semi-anonymous room, the sender can direct the stanza to the recipient's occupant JID and the service SHOULD forward the stanza to the recipient's real JID. However, the MUC service MUST NOT reveal the sender's real JID to the recipient at any time, nor reveal the recipient's real JID to the sender.</p></li>
      <li><p>A MUC client MUST send only the 'affiliation' attribute or the 'role' attribute in the &lt;item/&gt; element contained within an IQ set qualified by the 'http://jabber.org/protocol/muc#admin' namespace; if a moderator, admin, or owner attempts to modify both the affiliation and role of the same item in the same IQ set, the service MUST return a &lt;bad-request/&gt; error to the sender. However, the MUC service MAY modify a role based on a change to an affiliation and thus MAY send presence updates that include both a modified role and a modified affiliation.</p></li>
      <li><p>In IQ sets regarding roles, a MUC client MUST include the 'nick' attribute only; in IQ results regarding roles, a MUC service MUST include the 'nick', 'role', 'affiliation', and 'jid' attributes (with the value of the latter set to the user's full JID).</p></li>
      <li><p>In IQ sets regarding affiliations, a MUC client MUST include the 'jid' attribute only (with the value set to the bare JID); in IQ results regarding affiliations, a MUC service MUST NOT include the 'role' attribute, MUST include the 'affiliation' attribute and the 'jid' attribute (with the value set to the bare JID), and SHOULD include the 'nick' attribute (except if the affiliation is "outcast", since outcasts SHOULD NOT have reserved nicknames).</p></li>
    </ol>
  </div>

<h2>17.
       <a name="impl" id="impl">Implementation Notes</a></h2>
  <p>The following guidelines are intended to assist client and service developers in creating MUC implementations.</p>
  <div class="indent"><h3>17.1 <a name="impl-service" id="impl-service">Services</a></h3>
    <ol start="1">
      <li><p>In handling messages sent by visitors in a moderated room, a MUC service MAY queue each message for approval by a moderator and MAY inform the sender that the message is being held for approval; however, such behavior is OPTIONAL, and definition of a message approval protocol (e.g., using Data Forms as defined in <span class="ref">XEP-0004</span>) is out of scope for this document.</p></li>
      <li><p>Out of courtesy, a MUC service MAY send an out-of-room &lt;message/&gt; if a user's affiliation changes while the user is not in the room; the message SHOULD be sent from the room to the user's bare JID, MAY contain a &lt;body/&gt; element describing the affiliation change, and MUST contain a status code of 101.</p></li>
      <li><p>There is no requirement that a MUC service shall provide special treatment for users of the older groupchat 1.0 protocol, such as messages that contain equivalents to the extended presence information that is qualified by the 'http://jabber.org/protocol/muc#user' namespace.</p></li>
      <li><p>Room types MAY be configured in any combination. A MUC service MAY support or allow any desired room types or combinations thereof. There is no guarantee that any such combination is sensible.</p></li>
      <li><p>A MUC service MAY limit the number of configuration options presented to an owner after initial configuration has been completed, e.g. because certain options cannot take effect without restarting the service.</p></li>
      <li><p>A MUC service MAY provide an interface to room creation and configuration (e.g., in the form of a special XMPP entity or a Web page), so that the ostensible room owner is actually the application instead of a human user.</p></li>
      <li><p>A MUC service MAY choose to make available a special in-room resource that provides an interface to administrative functionality (e.g., a "user" named "ChatBot"), which occupants could interact with directly, thus enabling admins to type <tt>'/command parameter'</tt> in a private message to that "user". Obviously this kind of implementation would require the service to add a 'ChatBot' user to the room when it is created, and to prevent any occupant from having the nickname 'ChatBot' in the room. This might be difficult to ensure in some implementations or deployments. In any case, any such interface is OPTIONAL.</p></li>
      <li><p>A MUC service MAY choose to discard extended presence information that is attached to a &lt;presence/&gt; stanza before reflecting the presence change to the occupants of a room. That is, an implementation MAY choose to reflect only the &lt;show/&gt;, &lt;status/&gt;, and &lt;priority/&gt; child elements of the presence element as specified in the XML schema for the 'jabber:client' namespace, with the result that presence "changes" in extended namespaces (e.g., gabber:x:music:info) are not passed through to occupants. If a service prohibits certain extended namespaces, it SHOULD provide a description of allowable traffic at the well-known Service Discovery node 'http://jabber.org/protocol/muc#traffic' as described in the <a href="#impl-service-traffic">Allowable Traffic</a> section of this document.</p></li>
      <li><p>A MUC service MAY choose to discard extended information attached to a &lt;message/&gt; stanza before reflecting the message to the occupants of a room. An example of such extended information is the lightweight text markup specified by <span class="ref"><a href="http://xmpp.org/extensions/xep-0071.html">XHTML-IM (XEP-0071)</a></span>  [<a href="#nt-idp2808288">40</a>]. If a service prohibits certain extended namespaces, it SHOULD provide a description of allowable traffic at the well-known Service Discovery node 'http://jabber.org/protocol/muc#traffic' as described in the <a href="#impl-service-traffic">Allowable Traffic</a> section of this document.</p></li>
      <li><p>A MUC service MAY choose to "lock down" room nicknames (e.g., hardcoding the room nickname to the bare JID of the occupant). If so, the service MUST treat the locked nickname as a reserved room nickname and MUST support the protocol specified in the <a href="#reservednick">Discovering Reserved Room Nickname</a> section of this document.</p></li> 
    </ol>

    <div class="indent"><h3>17.1.1 <a name="impl-service-traffic" id="impl-service-traffic">Allowable Traffic</a></h3>
      <p>As noted, a service (more precisely, a properly-configured room) MAY discard some or all extended namespaces attached to &lt;message/&gt; and &lt;presence/&gt; stanzas that are intended for reflection from the sender through the room to all of the room occupants. If the room does so, it SHOULD enable senders to discover the list of allowable extensions by sending a disco#info query to the well-known Service Discovery node 'http://jabber.org/protocol/muc#traffic', returning one &lt;feature/&gt; element for each namespace supported in the result. If the room does not allow any extended namespaces, it MUST return an empty query as specified in <span class="ref">XEP-0030</span>. If the room does not support the "#traffic" node, it MUST return a &lt;feature-not-implemented/&gt; error in response to queries sent to the 'http://jabber.org/protocol/muc#traffic' node.</p>
      <p>The following example shows a room that allows the 'http://jabber.org/protocol/xhtml-im' and 'http://jabber.org/protocol/rosterx' namespaces only, but no other extended namespaces.</p>
      <p class="caption"><a name="example-215" id="example-215"></a>Example 215. User Queries Service Regarding Allowable Namespaces</p><div class="indent"><pre class="prettyprint">
&lt;iq from='wiccarocks@shakespeare.lit/laptop'
    to='heath@chat.shakespeare.lit'
    id='allow1'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://jabber.org/protocol/muc#traffic'/&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="caption"><a name="example-216" id="example-216"></a>Example 216. Service Returns Allowable Namespaces</p><div class="indent"><pre class="prettyprint">
&lt;iq from='heath@chat.shakespeare.lit'
    to='wiccarocks@shakespeare.lit/laptop'
    id='allow1'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://jabber.org/protocol/muc#traffic'&gt;
    &lt;feature var='http://jabber.org/protocol/xhtml-im'/&gt;
    &lt;feature var='http://jabber.org/protocol/rosterx'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p>If a service does not discard any namespaces, it MUST return a &lt;service-unavailable/&gt; error:</p>
      <p class="caption"><a name="example-217" id="example-217"></a>Example 217. Service Returns Service Unavailable</p><div class="indent"><pre class="prettyprint">
&lt;iq from='heath@chat.shakespeare.lit'
    to='wiccarocks@shakespeare.lit/laptop'
    id='allow1'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>17.1.2 <a name="impl-service-ghosts" id="impl-service-ghosts">Ghost Users</a></h3>
      <p>Deployment experience has shown that sometimes a user can appear to be an occupant in a room even though the user's real JID has gone offline since joining. Such users are called "ghosts". To help prevent ghost users, a MUC service SHOULD remove a user if the service receives a delivery-related error in relation to a stanza it has previously sent to the user (in this context, the delivery-related errors are &lt;gone/&gt;, &lt;item-not-found/&gt;, &lt;recipient-unavailable/&gt;, &lt;redirect/&gt;, &lt;remote-server-not-found/&gt;, and &lt;remote-server-timeout/&gt;). A MUC service MAY also use <span class="ref"><a href="http://xmpp.org/extensions/xep-0199.html">XMPP Ping (XEP-0199)</a></span>  [<a href="#nt-idp2823408">41</a>] or similar methods to periodically check the availability of room occupants. If the MUC service determines that the user has gone offline, it must treat the user as if the user had itself sent unavailable presence.</p>
    </div>

  </div>

  <div class="indent"><h3>17.2 <a name="impl-client" id="impl-client">Clients</a></h3>
    <ol start="1">
      <li><p>Clients MAY present room roles by showing ad-hoc groups for each role within a room roster. This will enable occupants to clearly visualize which occupants are moderators, participants, and visitors. However, such a representation is OPTIONAL.</p></li>
      <li><p>Clients MAY implement a variety of interface styles that provide "shortcuts" to functionality such as changing one's nickname, kicking or banning users, discovering an occupant's full JID, or changing the subject. One option consists of IRC-style commands such as '/nick', '/kick', '/ban', and '/whois'; another is to enable a user to right-click items in a room roster. All such interface styles are OPTIONAL. However, for convenience, a mapping of IRC commands to MUC protocols is provided below.</p></li>
    </ol>
    <div class="indent"><h3>17.2.1 <a name="impl-client-irc" id="impl-client-irc">IRC Command Mapping</a></h3>
      <p>Internet Relay Chat clients use a number of common "shortcut" commands that begin with a forward slash, such as '/nick' and '/ban'. The following table provides a mapping of IRC-style commands to MUC protocols, for use by clients that wish to support such functionality.</p>
      <div class="indent"><p class="caption"><a name="table-10" id="table-10"></a>Table 10: IRC Command Mapping</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th>Command</th>
          <th>Function</th>
          <th>MUC protocol</th>
        </tr>
        <tr class="body">
          <td>/ban &lt;roomnick&gt; [comment]</td>
          <td>bans user with that roomnick from this room (client translates roomnick to bare JID)</td>
          <td><p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;iq id='someid'
    to='room@service'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'
          jid='bare-jid-of-user'&gt;
      &lt;reason&gt;comment&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
          </pre></div></td>
        </tr>
        <tr class="body">
          <td>/invite &lt;jid&gt; [comment]</td>
          <td>invites user with that JID to this room</td>
          <td><p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;message to='room@service'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='jid'&gt;
      &lt;reason&gt;comment&lt;/reason&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
&lt;/message&gt;
          </pre></div></td>
        </tr>
        <tr class="body">
          <td>/join &lt;roomname&gt; [pass]</td>
          <td>joins room on this service (roomnick is same as nick in this room)</td>
          <td><p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;presence to='room@service/nick'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;password&gt;pass&lt;/password&gt;
  &lt;/x&gt;
&lt;/presence&gt;
          </pre></div></td>
        </tr>
        <tr class="body">
          <td>/kick &lt;roomnick&gt; [comment]</td>
          <td>kicks user with that roomnick from this room</td>
          <td><p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;iq id='someid'
    to='room@service'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='roomnick' role='none'&gt;
      &lt;reason&gt;comment&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
          </pre></div></td>
        </tr>
        <tr class="body">
          <td>/msg &lt;roomnick&gt; &lt;foo&gt;</td>
          <td>sends private message "foo" to roomnick</td>
          <td><p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;message to='room@service/nick' type='chat'&gt;
  &lt;body&gt;foo&lt;/body&gt;
&lt;/message&gt;
          </pre></div></td>
        </tr>
        <tr class="body">
          <td>/nick &lt;newnick&gt;</td>
          <td>changes nick in this room to "newnick"</td>
          <td><p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;presence to='room@service/newnick'/&gt;
          </pre></div></td>
        </tr>
        <tr class="body">
          <td>/part [comment]</td>
          <td>exits this room (some IRC clients also support /leave)</td>
          <td><p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;presence to='room@service/nick'
          type='unavailable'&gt;
  &lt;status&gt;comment&lt;/status&gt;
&lt;/presence&gt;
          </pre></div></td>
        </tr>
        <tr class="body">
          <td>/topic &lt;foo&gt;</td>
          <td>changes subject of this room to "foo"</td>
          <td><p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;message to='room@service' type='groupchat'&gt;
  &lt;subject&gt;foo&lt;/subject&gt;
&lt;/message&gt;
          </pre></div></td>
        </tr>
      </table></div>
      <p>Note: Because MUC roomnicks follow the Resourceprep profile of stringprep, they are allowed to contain a space character, whereas IRC nicknames do not. Although a given client MAY support quotation characters for this purpose (resulting in commands such as '/ban "king lear" insanity is no defense'), most common quotation characters (such as " and ') are also allowed by Resourceprep, thus leading to added complexity and potential problems with quotation of roomnicks that contain both spaces and quotation characters. Therefore it is NOT RECOMMENDED for XMPP clients to support IRC-style shortcut commands with roomnicks that contain space characters.</p>
      <p>Note: Many XMPP clients also implement a '/me ' command as described in <span class="ref"><a href="http://xmpp.org/extensions/xep-0245.html">The /me Command (XEP-0245)</a></span>  [<a href="#nt-idp2849392">42</a>]. This command does not result in any MUC or IRC protocol action and is therefore not shown in the foregoing table.</p>
    </div>

    <div class="indent"><h3>17.2.2 <a name="impl-client-presence" id="impl-client-presence">Presence Subscriptions</a></h3>
      <p>In XMPP, presence subscriptions are used to share network availability information between end users (see <span class="ref"><a href="http://tools.ietf.org/html/rfc6121">RFC 6121</a></span>  [<a href="#nt-idp2853296">43</a>]). In XMPP groupchat, the presence employed is of a special type: directed presence rather than presence subscriptions. However, an IM user can also subscribe to the presence of a chatroom, which introduces the useful property that the user will be notified when a room comes back online after a crash or other outage, thus facilitating the feature of automatically re-joining the room. Although MUC clients and servers have not traditionally implemented presence subscriptions, developers are encouraged to consider adding such support.</p>
    </div>

  </div>

<h2>18.
       <a name="schemas" id="schemas">XML Schemas</a></h2>
  <div class="indent"><h3>18.1 <a name="schemas-muc" id="schemas-muc">http://jabber.org/protocol/muc</a></h3>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/muc'
    xmlns='http://jabber.org/protocol/muc'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0045: http://www.xmpp.org/extensions/xep-0045.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='x'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='history' minOccurs='0'/&gt;
        &lt;xs:element name='password' type='xs:string' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='history'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='maxchars' type='xs:int' use='optional'/&gt;
          &lt;xs:attribute name='maxstanzas' type='xs:int' use='optional'/&gt;
          &lt;xs:attribute name='seconds' type='xs:int' use='optional'/&gt;
          &lt;xs:attribute name='since' type='xs:dateTime' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>18.2 <a name="schemas-user" id="schemas-user">http://jabber.org/protocol/muc#user</a></h3>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/muc#user'
    xmlns='http://jabber.org/protocol/muc#user'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0045: http://www.xmpp.org/extensions/xep-0045.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='x'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element ref='decline' minOccurs='0'/&gt;
        &lt;xs:element ref='destroy' minOccurs='0'/&gt;
        &lt;xs:element ref='invite' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='item' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;xs:element name='password' type='xs:string' minOccurs='0'/&gt;
        &lt;xs:element ref='status' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='decline'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='reason' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='from' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='to' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='destroy'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='reason' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='invite'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='reason' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='from' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='to' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='item'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='actor' minOccurs='0'/&gt;
        &lt;xs:element ref='continue' minOccurs='0'/&gt;
        &lt;xs:element ref='reason' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='affiliation' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='admin'/&gt;
            &lt;xs:enumeration value='member'/&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='outcast'/&gt;
            &lt;xs:enumeration value='owner'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='nick' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='role' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='moderator'/&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='participant'/&gt;
            &lt;xs:enumeration value='visitor'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='actor'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='nick' type='xs:string' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='continue'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='thread' type='xs:string' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='status'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:attribute name='code' use='required'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:int'&gt;
            &lt;xs:minInclusive value='100'/&gt;
            &lt;xs:maxInclusive value='999'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='reason' type='xs:string'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>18.3 <a name="schemas-admin" id="schemas-admin">http://jabber.org/protocol/muc#admin</a></h3>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/muc#admin'
    xmlns='http://jabber.org/protocol/muc#admin'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0045: http://www.xmpp.org/extensions/xep-0045.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='query'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='item'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='actor' minOccurs='0'/&gt;
        &lt;xs:element ref='reason' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='affiliation' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='admin'/&gt;
            &lt;xs:enumeration value='member'/&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='outcast'/&gt;
            &lt;xs:enumeration value='owner'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='nick' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='role' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='moderator'/&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='participant'/&gt;
            &lt;xs:enumeration value='visitor'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='actor'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='nick' type='xs:string' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='reason' type='xs:string'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>18.4 <a name="schemas-owner" id="schemas-owner">http://jabber.org/protocol/muc#owner</a></h3>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/muc#owner'
    xmlns='http://jabber.org/protocol/muc#owner'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0045: http://www.xmpp.org/extensions/xep-0045.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:import 
      namespace='jabber:x:data'
      schemaLocation='http://www.xmpp.org/schemas/x-data.xsd'/&gt;

  &lt;xs:element name='query'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice xmlns:xdata='jabber:x:data' minOccurs='0'&gt;
        &lt;xs:element ref='xdata:x'/&gt;
        &lt;xs:element ref='destroy'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='destroy'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name='password' type='xs:string' minOccurs='0'/&gt;
        &lt;xs:element name='reason' type='xs:string' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>

<h2>19.
       <a name="ack" id="ack">Acknowledgements</a></h2>
  <p>The author would like to especially recognize the following individuals for their many helpful comments on various drafts of this proposal: Gaston Dombiak, Joe Hildebrand, Craig Kaes, Jacek Konieczny, Peter Millard, Jean-Louis Seguineau, Alexey Shchepin, David Sutton, and David Waite. Thanks also to members of the XSF Technical Review Team for their edits and suggestions, in particular Peter Mount and Luca Tagliaferri. In addition, more people than the author can count have have provided feedback in the jdev@conference.jabber.org chat room and on the standards@xmpp.org and muc@xmpp.org mailing lists.</p>
<hr /><a name="appendices" id="appendices"></a><h2>Appendices</h2><hr /><a name="appendix-docinfo" id="appendix-docinfo"></a><h3>Appendix A: Document Information</h3><p class="indent">
            Series: <a href="http://xmpp.org/extensions/">XEP</a><br />
            Number: 0045<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://xmpp.org/extensions/xep-0001.html#states-Draft">Draft</a><br />
            Type:
            <a href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 1.25<br />
            Last Updated: 2012-02-08<br />
                Approving Body: <a href="http://xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XMPP IM, XEP-0004, XEP-0030, XEP-0068, XEP-0082, XEP-0128<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: muc<br />
        XML Schema for muc namespace: &lt;<a href="http://www.xmpp.org/schemas/muc.xsd">http://www.xmpp.org/schemas/muc.xsd</a>&gt;<br />
        XML Schema for muc#admin namespace: &lt;<a href="http://www.xmpp.org/schemas/muc-admin.xsd">http://www.xmpp.org/schemas/muc-admin.xsd</a>&gt;<br />
        XML Schema for muc#owner namespace: &lt;<a href="http://www.xmpp.org/schemas/muc-owner.xsd">http://www.xmpp.org/schemas/muc-owner.xsd</a>&gt;<br />
        XML Schema for muc#user namespace: &lt;<a href="http://www.xmpp.org/schemas/muc-user.xsd">http://www.xmpp.org/schemas/muc-user.xsd</a>&gt;<br />
              Registry: 
              
              &lt;<a href="http://xmpp.org/registrar/muc.html">http://xmpp.org/registrar/muc.html</a>&gt;
              <br />
              Source Control: 
                <a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0045.xml">HTML</a><br />
            This document in other formats: 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0045.xml">XML</a> 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0045.pdf">PDF</a></p><hr /><a name="appendix-authorinfo" id="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3><div class="indent"><h3>Peter Saint-Andre</h3><p class="indent">
        Email:
        <a href="mailto:peter@andyet.net">peter@andyet.net</a><br />
        JabberID: 
        <a href="xmpp:stpeter@stpeter.im">stpeter@stpeter.im</a><br />
        URI: 
        <a href="https://stpeter.im/">https://stpeter.im/</a><br /></p></div><hr /><a name="appendix-legal" id="appendix-legal"></a><h3>Appendix C: Legal Notices</h3><div class="indent"><h4>Copyright</h4>This XMPP Extension Protocol is copyright © 1999 - 2014 by the <a href="http://xmpp.org/">XMPP Standards Foundation</a> (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="http://xmpp.org/about-xmpp/xsf/xsf-ipr-policy/">http://xmpp.org/about-xmpp/xsf/xsf-ipr-policy/</a>&gt; or obtained by writing to XMPP Standards Foundation, 1899 Wynkoop Street, Suite 600, Denver, CO 80202 USA).</div><hr /><a name="appendix-xmpp" id="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><hr /><a name="appendix-discuss" id="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><hr /><a name="appendix-conformance" id="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><a name="appendix-notes" id="appendix-notes"></a><h3>Appendix G: Notes</h3><div class="indent"><p><a name="nt-idp1749456" id="nt-idp1749456">1</a>. RFC 1459: Internet Relay Chat &lt;<a href="http://tools.ietf.org/html/rfc1459">http://tools.ietf.org/html/rfc1459</a>&gt;.</p><p><a name="nt-idp1751648" id="nt-idp1751648">2</a>. RFC 2810: Internet Relay Chat: Architecture &lt;<a href="http://tools.ietf.org/html/rfc2810">http://tools.ietf.org/html/rfc2810</a>&gt;.</p><p><a name="nt-idp1753632" id="nt-idp1753632">3</a>. RFC 2811: Internet Relay Chat: Channel Management &lt;<a href="http://tools.ietf.org/html/rfc2811">http://tools.ietf.org/html/rfc2811</a>&gt;.</p><p><a name="nt-idp1754912" id="nt-idp1754912">4</a>. RFC 2812: Internet Relay Chat: Client Protocol &lt;<a href="http://tools.ietf.org/html/rfc2812">http://tools.ietf.org/html/rfc2812</a>&gt;.</p><p><a name="nt-idp1757232" id="nt-idp1757232">5</a>. RFC 2813: Internet Relay Chat: Server Protocol &lt;<a href="http://tools.ietf.org/html/rfc2813">http://tools.ietf.org/html/rfc2813</a>&gt;.</p><p><a name="nt-idp1760880" id="nt-idp1760880">6</a>. XEP-0133: Service Administration &lt;<a href="http://xmpp.org/extensions/xep-0133.html">http://xmpp.org/extensions/xep-0133.html</a>&gt;.</p><p><a name="nt-idp1764176" id="nt-idp1764176">7</a>. XEP-0272: Multiparty Jingle &lt;<a href="http://xmpp.org/extensions/xep-0272.html">http://xmpp.org/extensions/xep-0272.html</a>&gt;.</p><p><a name="nt-idp1793712" id="nt-idp1793712">8</a>. XEP-0249: Direct MUC Invitations &lt;<a href="http://xmpp.org/extensions/xep-0249.html">http://xmpp.org/extensions/xep-0249.html</a>&gt;.</p><p><a name="nt-idp1996224" id="nt-idp1996224">9</a>. XEP-0030: Service Discovery &lt;<a href="http://xmpp.org/extensions/xep-0030.html">http://xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-idp2011024" id="nt-idp2011024">10</a>. XEP-0059: Result Set Management &lt;<a href="http://xmpp.org/extensions/xep-0059.html">http://xmpp.org/extensions/xep-0059.html</a>&gt;.</p><p><a name="nt-idp2021792" id="nt-idp2021792">11</a>. XEP-0128: Service Discovery Extensions &lt;<a href="http://xmpp.org/extensions/xep-0128.html">http://xmpp.org/extensions/xep-0128.html</a>&gt;.</p><p><a name="nt-idp2052720" id="nt-idp2052720">12</a>. RFC 6120: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc6120">http://tools.ietf.org/html/rfc6120</a>&gt;.</p><p><a name="nt-idp2070320" id="nt-idp2070320">13</a>. The &lt;presence/&gt; element MUST NOT include more than once instance of the &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace.</p><p><a name="nt-idp2125008" id="nt-idp2125008">14</a>. XEP-0203: Delayed Delivery &lt;<a href="http://xmpp.org/extensions/xep-0203.html">http://xmpp.org/extensions/xep-0203.html</a>&gt;.</p><p><a name="nt-idp2128352" id="nt-idp2128352">15</a>. XEP-0091: Legacy Delayed Delivery &lt;<a href="http://xmpp.org/extensions/xep-0091.html">http://xmpp.org/extensions/xep-0091.html</a>&gt;.</p><p><a name="nt-idp2131600" id="nt-idp2131600">16</a>. XEP-0033: Extended Stanza Addressing &lt;<a href="http://xmpp.org/extensions/xep-0033.html">http://xmpp.org/extensions/xep-0033.html</a>&gt;.</p><p><a name="nt-idp2144960" id="nt-idp2144960">17</a>. XEP-0082: XMPP Date and Time Profiles &lt;<a href="http://xmpp.org/extensions/xep-0082.html">http://xmpp.org/extensions/xep-0082.html</a>&gt;.</p><p><a name="nt-idp2181168" id="nt-idp2181168">18</a>. RFC 4122: A Universally Unique IDentifier (UUID) URN Namespace &lt;<a href="http://tools.ietf.org/html/rfc4122">http://tools.ietf.org/html/rfc4122</a>&gt;.</p><p><a name="nt-idp2214256" id="nt-idp2214256">19</a>. XEP-0016: Privacy Lists &lt;<a href="http://xmpp.org/extensions/xep-0016.html">http://xmpp.org/extensions/xep-0016.html</a>&gt;.</p><p><a name="nt-idp2216464" id="nt-idp2216464">20</a>. XEP-0249: Direct MUC Invitations &lt;<a href="http://xmpp.org/extensions/xep-0249.html">http://xmpp.org/extensions/xep-0249.html</a>&gt;.</p><p><a name="nt-idp2253824" id="nt-idp2253824">21</a>. XEP-0077: In-Band Registration &lt;<a href="http://xmpp.org/extensions/xep-0077.html">http://xmpp.org/extensions/xep-0077.html</a>&gt;.</p><p><a name="nt-idp2262800" id="nt-idp2262800">22</a>. XEP-0004: Data Forms &lt;<a href="http://xmpp.org/extensions/xep-0004.html">http://xmpp.org/extensions/xep-0004.html</a>&gt;.</p><p><a name="nt-idp2303536" id="nt-idp2303536">23</a>. RFC 6121: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc6121">http://tools.ietf.org/html/rfc6121</a>&gt;.</p><p><a name="nt-idp2328432" id="nt-idp2328432">24</a>. Some commentors have complained that this opens room owners and administrators up to potential abuse; unfortunately, with great power comes great responsibility.</p><p><a name="nt-idp2395984" id="nt-idp2395984">25</a>. XEP-0016: Privacy Lists &lt;<a href="http://xmpp.org/extensions/xep-0016.html">http://xmpp.org/extensions/xep-0016.html</a>&gt;.</p><p><a name="nt-idp2471424" id="nt-idp2471424">26</a>. XEP-0050: Ad-Hoc Commands &lt;<a href="http://xmpp.org/extensions/xep-0050.html">http://xmpp.org/extensions/xep-0050.html</a>&gt;.</p><p><a name="nt-idp2474048" id="nt-idp2474048">27</a>. XEP-0060: Publish-Subscribe &lt;<a href="http://xmpp.org/extensions/xep-0060.html">http://xmpp.org/extensions/xep-0060.html</a>&gt;.</p><p><a name="nt-idp2580624" id="nt-idp2580624">28</a>. This is different from the behavior of room configuration, wherein the "muc#roomconfig_roomowners" field specifies the full list of room owners, not the delta.</p><p><a name="nt-idp2611744" id="nt-idp2611744">29</a>. This is different from the behavior of room configuration, wherein the "muc#roomconfig_roomadmins" field specifies the full list of room admins, not the delta.</p><p><a name="nt-idp2635712" id="nt-idp2635712">30</a>. RFC 2616: Hypertext Transport Protocol -- HTTP/1.1 &lt;<a href="http://tools.ietf.org/html/rfc2616">http://tools.ietf.org/html/rfc2616</a>&gt;.</p><p><a name="nt-idp2638432" id="nt-idp2638432">31</a>. RFC 1893: Enhanced Mail System Status Codes &lt;<a href="http://tools.ietf.org/html/rfc1893">http://tools.ietf.org/html/rfc1893</a>&gt;.</p><p><a name="nt-idp2648656" id="nt-idp2648656">32</a>. XEP-0171: Language Translation &lt;<a href="http://xmpp.org/extensions/xep-0171.html">http://xmpp.org/extensions/xep-0171.html</a>&gt;.</p><p><a name="nt-idp2646192" id="nt-idp2646192">33</a>. RFC 6122: Extensible Messaging and Presence Protocol (XMPP): Address Format &lt;<a href="http://tools.ietf.org/html/rfc6122">http://tools.ietf.org/html/rfc6122</a>&gt;.</p><p><a name="nt-idp2672944" id="nt-idp2672944">34</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-idp2681360" id="nt-idp2681360">35</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://xmpp.org/registrar/">http://xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-idp2694288" id="nt-idp2694288">36</a>. XEP-0068: Field Data Standardization for Data Forms &lt;<a href="http://xmpp.org/extensions/xep-0068.html">http://xmpp.org/extensions/xep-0068.html</a>&gt;.</p><p><a name="nt-idp1870864" id="nt-idp1870864">37</a>. XEP-0147: XMPP URI Query Components &lt;<a href="http://xmpp.org/extensions/xep-0147.html">http://xmpp.org/extensions/xep-0147.html</a>&gt;.</p><p><a name="nt-idp2768976" id="nt-idp2768976">38</a>. XEP-0085: Chat State Notifications &lt;<a href="http://xmpp.org/extensions/xep-0085.html">http://xmpp.org/extensions/xep-0085.html</a>&gt;.</p><p><a name="nt-idp2775600" id="nt-idp2775600">39</a>. XEP-0273: Stanza Interception and Filtering Technology &lt;<a href="http://xmpp.org/extensions/xep-0273.html">http://xmpp.org/extensions/xep-0273.html</a>&gt;.</p><p><a name="nt-idp2808288" id="nt-idp2808288">40</a>. XEP-0071: XHTML-IM &lt;<a href="http://xmpp.org/extensions/xep-0071.html">http://xmpp.org/extensions/xep-0071.html</a>&gt;.</p><p><a name="nt-idp2823408" id="nt-idp2823408">41</a>. XEP-0199: XMPP Ping &lt;<a href="http://xmpp.org/extensions/xep-0199.html">http://xmpp.org/extensions/xep-0199.html</a>&gt;.</p><p><a name="nt-idp2849392" id="nt-idp2849392">42</a>. XEP-0245: The /me Command &lt;<a href="http://xmpp.org/extensions/xep-0245.html">http://xmpp.org/extensions/xep-0245.html</a>&gt;.</p><p><a name="nt-idp2853296" id="nt-idp2853296">43</a>. RFC 6121: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc6121">http://tools.ietf.org/html/rfc6121</a>&gt;.</p></div><hr /><a name="appendix-revs" id="appendix-revs"></a><h3>Appendix H: Revision History</h3><p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p><div class="indent"><h4>Version 1.25 (2012-02-08)</h4><div class="indent">
      <ul>
        <li>Clarified the fact that room roles and affiliations are shortcuts to bundles of privileges.</li>
        <li>Removed references to service discovery feature for "gc-1.0" since it is now obsolete.</li>
        <li>Added security consideration about information leaks related to service discovery.</li>
        <li>Corrected some examples of presence and message errors so that the 'from' and 'to' addresses are merely swapped, in accordance with RFC 6120; also added 'by' attribute to show that the room itself generated the error.</li>
        <li>Added 'nick' attribute to &lt;actor/&gt; element so that an action can be attributed either to a real JID or to a roomnick.</li>
        <li>Clarified the meaning of status code 100.</li>
        <li>Corrected delayed delivery text and examples so that the 'from' address is that of the room, and specified optional inclusion of the XEP-0033 'ofrom' address to note original sender.</li>
        <li>Added 'id' attributes to most examples, especially message and presence stanzas generated by the room since IDs can be used for tracking purposes and ghost detection.</li>
        <li>Added term "Occupant JID" to differentiate between the JID of a &lt;room@service&gt; and the JID of a &lt;room@service/nick&gt;.</li>
        <li>Added "muc#maxhistoryfetch" form field.</li>
        <li>Loosened handling of room joins when nicks are locked down, so that the service should modify the roomnick instead of returning an error.</li>
        <li>Specified that the room must return a room subject, even if the subject is empty.</li>
        <li>Removed feature for requesting a unique room name (the client can simply use a UUID).</li>
        <li>Removed any mention of fully-anonymous rooms, which are not supported by this specification.</li>
        <li>Clarified many small points in the text and examples.</li>
      </ul>
     (psa)
    </div><h4>Version 1.24 (2008-07-16)</h4><div class="indent"><p>Added more examples of the reason element; removed mention of nick inclusion with regard to ban lists; added denial of service considerations.</p> (psa)
    </div><h4>Version 1.23 (2008-01-14)</h4><div class="indent">
      <ul>
        <li>Defined getmemberlist room configuration option</li>
        <li>Added direct invitation protocol</li>
        <li>Corrected logic regarding admission of room owner/admin when room is full</li>
        <li>Defined service discovery extension field for associated LDAP group</li>
        <li>Specified that room config fields can be listed in extended room information</li>
        <li>Specified message format for affiliation change notifications if user is not in the room</li>
        <li>Added example showing use of Result Set Management</li>
        <li>Recommended inclusion of MUC child element in presence errors</li>
        <li>Described use of ThreadID for continuity between one-to-one chat and multi-user chat, including definition of thread attribute for continue element in invitations.</li>
      </ul>
     (psa)
    </div><h4>Version 1.22 (2007-04-10)</h4><div class="indent"><p>Updated delayed delivery reference to reflect advancement of XEP-0203 to Draft and deprecation of XEP-0091.</p> (psa)
    </div><h4>Version 1.21 (2006-09-13)</h4><div class="indent">
      <ul>
        <li>Clarified that inclusion of MUC extension in room join/create request triggers Data Forms flow but that absence of MUC extension leads to automatic room creation for backwards compatibility with older groupchat 1.0 protocol.</li>
        <li>Specified use of &lt;not-acceptable/&gt; error on nickname change if nicks are locked down.</li>
        <li>Required clients to discover room configuration prior to entering room and specified related security considerations, including use of privacy-related status codes 170, 171, 172, 173, and 174.</li>
        <li>Specified use of &lt;not-acceptable/&gt; error if room configuration options cannot be processed or violate service policies.</li>
        <li>Made explicit that roomnicks must not consist only of spaces.</li>
        <li>Moved all service discovery use cases into dedicated section.</li>
        <li>Changed urn:xmpp:delay support from SHOULD to MUST.</li>
        <li>Clarified that _whois room configuration option specifies room type.</li>
        <li>Defined XEP-0128 room information fields for discussion logs, associated pubsub node, and contact JID.</li>
        <li>Specified that changing role to moderator upon affiliation change to admin or owner is recommended, not required.</li>
        <li>Added internationalization consideration about localization of field labels for various data forms.</li>
        <li>Specified that implementations may persist roles across visits and should do so for moderated rooms.</li>
        <li>Added protocol and service discovery feature for requesting a unique room name prior to room creation.</li>
        <li>Further clarified nature of reserved room nicknames and nickname lockdown.</li>
        <li>Defined data forms for requesting voice and approving voice requests.</li>
        <li>Added multiple invitee example for XMPP URI.</li>
        <li>Clarified order of presence, discussion history, etc.</li>
        <li>Added status codes for occupant's own roomnick, service-modified roomnick, and warning that room discussion is publicly logged.</li>
        <li>Clarified privacy and anonymity considerations regarding room logging and non-anonymous rooms.</li>
      </ul>
     (psa)
    </div><h4>Version 1.20 (2005-09-08)</h4><div class="indent"><p>Harmonized ability to kick and ban users, and clarified that a user cannot be kicked or banned by a moderator or admin with a lower affiliation.</p> (psa)
    </div><h4>Version 1.19 (2005-04-21)</h4><div class="indent"><p>Specified how to send multiple invitations simultaneously; corrected some errors regarding consistency of affiliation state changes; changed message events prohibition from MUST NOT to SHOULD NOT; corrected error handling related to the #traffic disco node; allowed &lt;password/&gt; as a child of &lt;destroy/&gt;; changed max users error from &lt;not-allowed/&gt; to &lt;service-unavailable/&gt;; specified that the maxchars attribute counts characters in complete XML stanzas; added disco features for FORM_TYPEs; defined registry for status codes; split Create Instant Room into separate use case for protocol compliance purposes; adjusted XML schemas to reflect the foregoing changes; re-wrote the introduction; clarified small textual matters throughout.</p> (psa)
    </div><h4>Version 1.18 (2004-11-02)</h4><div class="indent"><p>Corrected several errors in the affiliation state chart and in the examples (wrong FORM_TYPE values); mentioned /me command.</p> (psa)
    </div><h4>Version 1.17 (2004-10-04)</h4><div class="indent"><p>Added text about allowable extension namespaces and related service discovery mechanisms; specified well-known service discovery nodes; added conformance terms to clarify some descriptions; modified affiliation state chart to allow more flexible state changes; per list dicussion, added ability to convert a one-to-one chat into a conference, including sending of history; specified error to use when max users limit is reached; specified form for admin approval of user registration requests and modified FORM_TYPE from http://jabber.org/protocol/muc#user to http://jabber.org/protocol/muc#register; modified FORM_TYPE for room configuration from http://jabber.org/protocol/muc#owner to http://jabber.org/protocol/muc#roomconfig.</p> (psa)
    </div><h4>Version 1.16 (2004-06-30)</h4><div class="indent"><p>Added example and registry submission for service discovery extension.</p> (psa)
    </div><h4>Version 1.15 (2004-06-24)</h4><div class="indent"><p>Removed jabber:iq:browse references; clarified order of presence stanzas sent to new occupant on entering room; specified format of in-room messages (type='groupchat', from='room@service'); clarified allowable attributes in various list-related operations; made admin/owner revocation text and examples consistent with state chart; clarified ownership revocation conflict scenarios; changed the 'muc#roomconfig_inviteonly' field to 'muc#roomconfig_membersonly'; changed attribute order in examples to match XML canonicalization rules; corrected several errors in the schemas.</p> (psa)
    </div><h4>Version 1.14 (2004-05-03)</h4><div class="indent"><p>Corrected discovery of registered roomnicks; added note about error to return if nicks are locked down.</p> (psa)
    </div><h4>Version 1.13 (2004-03-31)</h4><div class="indent"><p>Fixed an error in the muc#user schema.</p> (psa)
    </div><h4>Version 1.12 (2004-03-01)</h4><div class="indent"><p>Corrected a few errors in the examples; added IQ results in order to clarify workflows.</p> (psa)
    </div><h4>Version 1.11 (2004-02-05)</h4><div class="indent"><p>Clarified JID matching rules (same as for privacy lists in XMPP IM).</p> (psa)
    </div><h4>Version 1.10 (2004-01-07)</h4><div class="indent"><p>Added XMPP error handling; fully specified all conformance terms.</p> (psa)
    </div><h4>Version 1.9 (2003-12-14)</h4><div class="indent"><p>Removed protocol for requesting voice in a moderated room (should be performed using Ad-Hoc Commands).</p> (psa)
    </div><h4>Version 1.8 (2003-12-04)</h4><div class="indent"><p>Added protocol for requesting voice in a moderated room; added (informational) mapping of IRC commands to MUC protocols.</p> (psa)
    </div><h4>Version 1.7 (2003-10-21)</h4><div class="indent"><p>Added room configuration option for restricting presence broadcast to certain roles.</p> (psa)
    </div><h4>Version 1.6 (2003-10-03)</h4><div class="indent"><p>Added history management protocol on entering a room.</p> (psa)
    </div><h4>Version 1.5 (2003-09-11)</h4><div class="indent"><p>Specified that ban occurs by JID, not roomnick; allowed privileged users to send messages to the room even if not present in the room; added note that service should remove occupant if a delivery-related stanza error occurs; enabled user to disco the room in order to discover registered roomnick; specified that "banning" by domain or regex is a service-level configuration matter and therefore out of scope for MUC; specified that role should be decremented as appropriate if affiliation is lowered; added some clarifying text to room creation workflow; added implementation note about sending an out-of-band message if a user's affiliation changes while the user is not in the room; fixed stringprep references (room nicks use Resourceprep); clarified relationship between Room ID (i.e., node identifier of Room JID or Occupant JID, which may be opaque) and natural-language Room Name; specified Field Standardization profile per XEP-0068; defined XMPP Registrar submissions; added schema locations.</p> (psa)
    </div><h4>Version 1.4 (2003-02-16)</h4><div class="indent"><p>Added XML schemas.</p> (psa)
    </div><h4>Version 1.3 (2003-02-11)</h4><div class="indent"><p>Added reference to nodeprep Internet-Draft.</p> (psa)
    </div><h4>Version 1.2 (2003-01-30)</h4><div class="indent"><p>Commented out revision history prior to version 1.0 (too long); clarified business rules regarding when nicks, full JIDs, and bare JIDs are used in reference to roles and affiliations; consistently specified that extended presence information in the muc#user namespace must include the full JID as the value of the 'jid' attribute in all cases; cleaned up text and examples throughout; added open issue regarding syntax of room nicknames.</p> (psa)
    </div><h4>Version 1.1 (2002-12-16)</h4><div class="indent"><p>Added protocol for declining an invitation; replaced &lt;created/&gt; element with status code 201; modified the destroy room protocol so that &lt;destroy/&gt; is a child of &lt;query/&gt;; clarified usage of 'nick' attribute when adding members; prohibited use of message events.</p> (psa)
    </div><h4>Version 1.0 (2002-11-21)</h4><div class="indent"><p>Per a vote of the Jabber Council, revision 0.23 was advanced to Draft on 2002-11-21. (For earlier revision history, refer to XML source.)</p> (psa)
    </div><h4>Version 0.23 (2002-11-06)</h4><div class="indent"><p>Added examples for disco#items queries sent to a room; prohibited 'type' attribute on invite messages sent from client to room; added dependencies on browse and disco; changed 'room user' to 'occupant'; fixed many small errors throughout.</p> (psa)
    </div><h4>Version 0.22 (2002-11-04)</h4><div class="indent"><p>Added example for disco#items; added support for cancellation of room configuration using type='cancel' from XEP-0004; noted 403 error for invites sent by non-admins in members-only room.</p> (psa)
    </div><h4>Version 0.21 (2002-11-01)</h4><div class="indent"><p>Clarified several small ambiguities; made &lt;body/&gt; optional on invites sent from the service to the invitee; added error scenarios for changing nickname and for destroying the room; specified that the service must return the full member list for a members-only room (not only the members in the room); updated the disco examples to track protocol changes.</p> (psa)
    </div><h4>Version 0.20 (2002-10-29)</h4><div class="indent"><p>Specified that messages sent to change the room subject must be of type "groupchat"; updated the legal notice to conform to the XSF IPR policy.</p> (psa)
    </div><h4>Version 0.19 (2002-10-28)</h4><div class="indent"><p>Added ability to create an instant room within MUC (not by using gc-1.0 protocol); cleaned up disco examples.</p> (psa)
    </div><h4>Version 0.18 (2002-10-27)</h4><div class="indent"><p>Added experimental support for disco; added sections for security, IANA, and JANA considerations; corrected typographical errors; cleaned up some DocBook formatting.</p> (psa)
    </div><h4>Version 0.17 (2002-10-23)</h4><div class="indent"><p>Added the optional &lt;actor/&gt; element (with 'jid' attribute) to &lt;item/&gt; elements inside presence stanzas of type "unavailable" that are sent to users who are kicked or banned, as well as within IQs for tracking purposes; reverted all list editing use cases (ban, voice, member, moderator, admin, owner) to use of MUC format rather than 'jabber:x:data' namespace; added several guidelines regarding generation and handling of XML stanzas; cleaned up the change room subject use case; changed several ambiguous uses of 'would', 'can', and 'will' to 'should', 'may', or 'must'; fixed several small errors in the text, examples, and DTDs.</p> (psa)
    </div><h4>Version 0.16 (2002-10-20)</h4><div class="indent"><p>Added the &lt;item/&gt; element to presence stanzas of type "unavailable" in order to improve the tracking of user states in the room; consolidated &lt;invitee/&gt; and &lt;inviter/&gt; elements into an &lt;invite/&gt; element with 'from' and 'to' attributes; made &lt;reason/&gt; element always a child of &lt;item/&gt; or &lt;invite/&gt; in the muc#user namespace; moved the alternate room location in room destruction to a 'jid' attribute of the &lt;alt/&gt; element; further specified several error messages; disallowed simultaneous modifications of both affiliations and roles by a moderator or admin; added several more rules regarding handling of XML stanzas; added use cases for granting and revoking admin status; adjusted DTD to track all changes.</p> (psa)
    </div><h4>Version 0.15 (2002-10-18)</h4><div class="indent"><p>Fully incorporated the change to affiliations + roles; moved a number of admin use cases to a new section for moderator use cases; added participant use case for requesting membership; added admin use cases for adding members, removing members, granting and revoking moderator status, and modifying the moderator list; organized the sections in a more logical manner.</p> (psa)
    </div><h4>Version 0.14 (2002-10-17)</h4><div class="indent"><p>Significantly modified the privileges model by distinguishing between in-room "roles" and long-lived "affiliations"; specified the privileges of the various roles and affiliations; included state transition charts for both roles and affiliations; removed use of MUC protocol for editing ban, voice, and admin lists (but not for the actions of banning users and granting/revoking voice); added delivery rule regarding IQ stanzas; changed kick so that the action is based on changing the role to "none".</p> (psa)
    </div><h4>Version 0.13 (2002-10-16)</h4><div class="indent"><p>Corrected the change nickname examples (newnick sent on unavailable, no nick sent on available).</p> (psa)
    </div><h4>Version 0.12 (2002-10-16)</h4><div class="indent"><p>Removed SHA1 passwords; specified that room shall add passwords on invitations to password-protected rooms (not supplied by inviter).</p> (psa)
    </div><h4>Version 0.11 (2002-10-16)</h4><div class="indent"><p>Changed 'participant' to 'room user' and 'discussant' to 'participant'; clarified presence rule about client generation of extended presence information; added role of 'none'.</p> (psa)
    </div><h4>Version 0.10 (2002-10-15)</h4><div class="indent"><p>Fixed extended presence on entering or creating a room (plain '...muc' with no fragment); harmonized #user with #admin regarding the use of the &lt;item/&gt; element and associated attributes (jid, nick, etc.), and added 'role' attribute; modified management of voice, ban, admin, and member lists to use &lt;query/&gt; wrapper and new &lt;item/&gt; structure; changed the 'member' role to 'discussant', added 'outcast' role for banned users, and added new 'member' role to enable management of member lists; changed invitation-only rooms to members-only rooms and made appropriate adjustments to apply member lists to both members-only rooms and open rooms; modified nickname change protocol slightly to send the old nickname in the unavailable presence and the new nickname in the available presence; removed prohibition on members-only rooms that are password-protected; removed the &lt;query/&gt; wrapper for the &lt;destroy/&gt; element; updated the DTDs.</p> (psa)
    </div><h4>Version 0.9 (2002-10-13)</h4><div class="indent"><p>Added extended presence ('...#user') on entering a room for MUC clients; changed namespace on room creation request to '...#owner'; added a service discovery example using jabber:iq:browse; added information about discussion history; made small fixes to several examples; further defined the presence rules; transferred all implementation notes to a dedicated section; added a Terminology section.</p> (psa)
    </div><h4>Version 0.8 (2002-10-10)</h4><div class="indent"><p>Made further changes to the room creation workflow (finally correct); removed feature discovery use case (this needs to be addressed by a real service discovery protocol!); added ability for room owners to edit the admin list; removed &lt;body/&gt; from invitations generated by the service; removed messages sent to kicked and banned users (handled by unavailable presence with status code); added a number of implementation notes; converted all examples to Shakespeare style.</p> (psa)
    </div><h4>Version 0.7.6 (2002-10-09)</h4><div class="indent"><p>Fixed the room creation workflow; changed some terminology ("join" to "enter" and "leave" to "exit").</p> (psa)
    </div><h4>Version 0.7.5 (2002-10-08)</h4><div class="indent"><p>Specified and improved the handling of invitation-only rooms. In particular, added the ability for room admins to edit the invitation list and added a configuration option that limits the ability to send invitations to room admins only.</p> (psa)
    </div><h4>Version 0.7.4 (2002-10-07)</h4><div class="indent"><p>Changed namespaces from http://jabber.org/protocol/muc/owner etc. to http://jabber.org/protocol/muc#owner etc. per Jabber Council discussion.</p> (psa)
    </div><h4>Version 0.7.3 (2002-10-07)</h4><div class="indent"><p>Changed namespaces to HTTP URIs; left role handling up to the implementation; further clarified presence rules.</p> (psa)
    </div><h4>Version 0.7.2 (2002-10-06)</h4><div class="indent"><p>Disallowed kicking, banning, and revoking voice with respect to room admins and room owners; replaced &lt;x/&gt; with &lt;query/&gt; in the Discovering Room Features and Destroying a Room use cases; corrected some small errors and made many clarifications throughout.</p> (psa)
    </div><h4>Version 0.7.1 (2002-10-04)</h4><div class="indent"><p>Removed &lt;whois/&gt; command (unnecessary since participants with appropriate privileges receive the full JID of all participants in presence stanzas); completed many small fixes throughout.</p> (psa)
    </div><h4>Version 0.7 (2002-10-03)</h4><div class="indent"><p>More clearly delineated participant roles and defined the hierarchy thereof (owner, admin, member, visitor); replaced &lt;voice/&gt; element in extended presence with &lt;item role='member'/&gt;; changed initial room configuration to use IQ rather than message; adjusted presence rules (especially regarding extended presence information); cleaned up examples throughout; updated DTD to track changes.</p> (psa)
    </div><h4>Version 0.6 (2002-09-21)</h4><div class="indent"><p>More clearly defined the scope; removed fully anonymous rooms; changed meaning of semi-anonymous rooms and of non-anonymous rooms; added mechanism for notification of full JIDs in non-anonymous rooms; replaced the &lt;admin/&gt; element in extended presence with a &lt;role/&gt; element (more extensible); changed room passwords to cleartext; added status codes for various messages received from the service; added lists of valid error and status codes associated with the 'http://jabber.org/protocol/muc#user' namespace; added a &lt;reason/&gt; element for invitations; made kick and ban reasons child elements rather than attributes; replaced stopgap feature discovery mechanism with jabber:iq:negotiate; added extended presence element to room creation request and clarified the room creation process; specified presence reflection rules; added method for destroying a room; adjusted DTDs to track all changes.</p> (psa)
    </div><h4>Version 0.5.1 (2002-09-20)</h4><div class="indent"><p>Added DTDs; changed feature discovery to use &lt;x/&gt; element rather than query and made service response come in IQ result; fixed reference to JID spec; changed 'grant' to 'add' and 'revoke' to 'remove' for consistency in the item attributes; made several other small changes.</p> (psa)
    </div><h4>Version 0.5 (2002-09-19)</h4><div class="indent"><p>Changed the kick, ban, and voice protocols; added a few more configuration options; specified the restrictions for roomnicks; and added a stopgap service discovery protocol.</p> (psa)
    </div><h4>Version 0.4 (2002-09-18)</h4><div class="indent"><p>Changed all non-groupchat-1.0 use cases to jabber:gc:* namespaces or jabber:x:data; added use cases for ban list management and room moderation; added protocol for sending notice of admin and voice privileges in presence; cleaned up text and many examples.</p> (psa)
    </div><h4>Version 0.3 (2002-09-17)</h4><div class="indent"><p>Changed admin use cases; cleaned up participant and owner use cases.</p> (psa)
    </div><h4>Version 0.2 (2002-09-12)</h4><div class="indent"><p>Broke content out into three actors (participant, owner, and admin) and added more detail to owner and admin use cases.</p> (psa)
    </div><h4>Version 0.1 (2002-09-09)</h4><div class="indent"><p>Initial version.</p> (psa)
    </div></div><hr /><p>END</p></body></html>
