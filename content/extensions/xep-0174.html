<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0174: Serverless Messaging</title><link rel="stylesheet" type="text/css" href="../xmpp.css" /><link href="../prettify.css" type="text/css" rel="stylesheet" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><script type="text/javascript" src="../prettify.js"></script><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0" /><meta name="DC.Title" content="Serverless Messaging" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Description" content="This specification defines how to communicate over local or wide-area networks using the principles of zero-configuration networking for endpoint discovery and the syntax of XML streams and XMPP messaging for real-time communication. This method uses DNS-based Service Discovery and Multicast DNS to discover entities that support the protocol, including their IP addresses and preferred ports. Any two entities can then negotiate a serverless connection using XML streams in order to exchange XMPP message and IQ stanzas." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2008-11-26" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0174" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright &#xA9; 1999 - 2014 by the XMPP Standards Foundation (XSF)." /></head><body onload="prettyPrint()"><h1>XEP-0174: Serverless Messaging</h1><table><tr valign="top"><td><strong>Abstract:</strong></td><td>This specification defines how to communicate over local or wide-area networks using the principles of zero-configuration networking for endpoint discovery and the syntax of XML streams and XMPP messaging for real-time communication. This method uses DNS-based Service Discovery and Multicast DNS to discover entities that support the protocol, including their IP addresses and preferred ports. Any two entities can then negotiate a serverless connection using XML streams in order to exchange XMPP message and IQ stanzas.</td></tr><tr valign="top"><td><strong>Author:</strong></td><td>Peter Saint-Andre</td></tr><tr valign="top"><td><strong>Copyright:</strong></td><td>© 1999 - 2015 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</td></tr><tr valign="top"><td><strong>Status:</strong></td><td>Final</td></tr><tr valign="top"><td><strong>Type:</strong></td><td>Standards Track</td></tr><tr valign="top"><td><strong>Version:</strong></td><td>2.0</td></tr><tr valign="top"><td><strong>Last Updated:</strong></td><td>2008-11-26</td></tr></table><hr /><p style="color:green">NOTICE: The protocol defined herein is a <strong>Final Standard</strong> of the XMPP Standards Foundation and can be considered a stable technology for implementation and deployment.</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />   
      1.1.  <a href="#motivation">Motivation</a><br />   
      1.2.  <a href="#howitworks">How It Works</a><br />2.  <a href="#glossary">Glossary</a><br />3.  <a href="#dns">DNS Records</a><br />   
      3.1.  <a href="#txt">TXT Record</a><br />4.  <a href="#disco">Discovering Other Users</a><br />5.  <a href="#presence">Exchanging Presence</a><br />6.  <a href="#initiate">Initiating an XML Stream</a><br />7.  <a href="#exchange">Exchanging Stanzas</a><br />8.  <a href="#end">Ending an XML Stream</a><br />9.  <a href="#offline">Going Offline</a><br />10.  <a href="#caps">Discovering Capabilities</a><br />11.  <a href="#impl">Implementation Notes</a><br />   
      11.1.  <a href="#impl-network">Multiple Network Interfaces</a><br />   
      11.2.  <a href="#impl-icons">Buddy Icons</a><br />   
      11.3.  <a href="#impl-port">Port</a><br />   
      11.4.  <a href="#impl-wide">Wide-Area Networks</a><br />   
      11.5.  <a href="#impl-ui">User Interface</a><br />12.  <a href="#i18n">Internationalization Considerations</a><br />13.  <a href="#security">Security Considerations</a><br />   
      13.1.  <a href="#security-auth">Authentication and Encryption</a><br />   
      13.2.  <a href="#security-inject">Stanza Injection</a><br />   
      13.3.  <a href="#security-txt">TXT Record Parameters</a><br />   
      13.4.  <a href="#security-priv">Private Information</a><br />14.  <a href="#iana">IANA Considerations</a><br />15.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      15.1.  <a href="#registrar-linklocal">Link-Local Messaging TXT Record Parameters Registry</a><br />      
      15.1.1.  <a href="#registrar-linklocal-process">Registration Process</a><br />      
      15.1.2.  <a href="#registrar-linklocal-reg">Initial Registration</a><br />16.  <a href="#ack">Acknowledgements</a></p><p><a href="#appendices">Appendices</a><br />    <a href="#appendix-docinfo">A: Document Information</a><br />    <a href="#appendix-authorinfo">B: Author Information</a><br />    <a href="#appendix-legal">C: Legal Notices</a><br />    <a href="#appendix-xmpp">D: Relation to XMPP</a><br />    <a href="#appendix-discuss">E: Discussion Venue</a><br />    <a href="#appendix-conformance">F: Requirements Conformance</a><br />    <a href="#appendix-notes">G: Notes</a><br />    <a href="#appendix-revs">H: Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <div class="indent"><h3>1.1 <a name="motivation" id="motivation">Motivation</a></h3>
    <p>The Extensible Messaging and Presence Protocol (XMPP) as defined in <span class="ref"><a href="http://tools.ietf.org/html/rfc6120">XMPP Core</a></span>  [<a href="#nt-idp1583664">1</a>] does not support direct client-to-client interactions, since it requires authentication with a server: an XMPP client is allowed access to the network only after it has authenticated with a server, and the server will not grant access if authentication fails for any reason. If an unauthenticated client attempts to communicate directly with another client, such communication will fail because all XMPP communications are sent through one or more servers and a client cannot inject messages onto the network unless it first authenticates with a server.</p>
    <p>However, it is possible to establish an XMPP-like communication system on a local (or even wide-area) network using the principles of zero-configuration networking. In this situation, the clients obviate the XMPP requirement for authentication with a server by relying on zero-configuration networking to establish serverless communication using the _presence._tcp DNS SRV service type. Once discovery has been completed, the clients are able to negotiate an XML stream between themselves and then exchange messages and other structured data using the XMPP &lt;message/&gt; and &lt;iq/&gt; stanzas.</p>
    <p>Serverless messaging is typically restricted to a local network (or ad-hoc wide-area network) because of how zero-configuration networking works. It is impossible for clients that communicate via this serverless mode to insert messages into an XMPP network, which is why this kind of "mesh" is most accurately referred to as an XMPP-like system that exists outside the context of existing XMPP networks (though see the <a href="#security">Security Considerations</a> regarding the ability to "forward" messages from a serverless mesh to an XMPP network or vice-versa).</p>
    <p>Such a "mesh" can be quite valuable in certain circumstances. For instance, participants in a trade show or conference, users of the same wifi hotspot, or employees on the same local area network can communicate without the need for a pre-configured server. For this reason, support for serverless messaging has been a feature of Apple's iChat client when operating in Bonjour (formerly Rendezvous) mode since 2002. Because it is desirable for other Jabber/XMPP clients to support such functionality, this document describes how to use zero-configuration networking as the basis for serverless communication, mainly for use on local links (although the protocol can also be used on ad-hoc wide-area networks).</p>
  </div>
  <div class="indent"><h3>1.2 <a name="howitworks" id="howitworks">How It Works</a></h3>
    <p>This section provides a friendly introduction to serverless messaging. The examples show usage on a local link using dynamically configured link-local addresses as described in <span class="ref"><a href="http://tools.ietf.org/html/rfc3927">RFC 3927</a></span>  [<a href="#nt-idp1591136">2</a>] (see the <a href="#impl-wide">Wide-Area Networks</a> section of this document regarding non-local usage).</p>
    <p>Imagine that you are a Shakespearean character named Juliet. You are are using your laptop computer (a machine named "pronto") at a wifi hotspot in downtown Verona and you want to find other people to chat with on an ad-hoc basis (i.e., not people in your normal XMPP roster). Therefore your chat client advertises a serverless address of "juliet@pronto" so that other people can dynamically find you at the hotspot. Your client does this by invoking a daemon on your machine that supports DNS-based Service Discovery ("DNS-SD") as defined in <span class="ref"><a href="http://tools.ietf.org/html/rfc6763">RFC 6763</a></span>  [<a href="#nt-idp1594720">3</a>] and Multicast DNS ("mDNS") as defined in <span class="ref"><a href="http://tools.ietf.org/html/rfc6762">RFC 6762</a></span>  [<a href="#nt-idp1596704">4</a>]. As a result, the daemon (1) publishes the following DNS records to the multicast DNS address 224.0.0.251 (or FF02::FB for IPv6) and (2) listens for multicast DNS queries requesting these records:</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
pronto.local. A 10.2.1.187

juliet@pronto._presence._tcp.local. SRV 5562 pronto.local. 

_presence._tcp.local. PTR juliet@pronto._presence._tcp.local.
    </pre></div>
    <p>The meaning of these records is as follows:</p>
    <ul>
      <li>The A record specifies the IP address 10.2.1.187 at which the "pronto" machine will listen for connections.</li>
      <li>The SRV record (see <span class="ref"><a href="http://tools.ietf.org/html/rfc2782">RFC 2782</a></span>  [<a href="#nt-idp1600352">5</a>]) maps the presence service instance "juliet@pronto" to the machine "pronto.local." on port 5562.</li>
      <li>The PTR ("pointer") record (see <span class="ref"><a href="http://tools.ietf.org/html/rfc2317">RFC 2317</a></span>  [<a href="#nt-idp1602624">6</a>] and <span class="ref"><a href="http://tools.ietf.org/html/rfc1886">RFC 1886</a></span>  [<a href="#nt-idp1604608">7</a>]) says that there is a service of type "presence" on the local subnet (".local.") called "juliet@pronto" and that the service communicates over TCP.</li>
    </ul>
    <p>Your chat client also wants to advertise some information about you (subject to your control so that you don't divulge private information). Therefore it invokes the mDNS daemon to also publish a single DNS TXT record (see <span class="ref"><a href="http://tools.ietf.org/html/rfc1464">RFC 1464</a></span>  [<a href="#nt-idp1607360">8</a>]) that encapsulates some strings of information, where the record name is the same as the SRV record and the record value follows the format described in the <a href="#txt">TXT Record</a> section of this document. The strings are typically key-value pairs such as the following:</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
txtvers=1
1st=Juliet
email=juliet@capulet.lit 
hash=sha-1 
jid=juliet@capulet.lit 
last=Capulet 
msg=Hanging out downtown 
nick=JuliC 
node=http://www.adiumx.com 
phsh=a3839614e1a382bcfebbcf20464f519e81770813 
port.p2pj=5562 
status=avail 
vc=CA! 
ver=QgayPKawpkPSDYmwT/WM94uAlu0=
    </pre></div>
    <p>Other people at the hotspot can also advertise similar DNS records for use on the local link. Essentially, the mDNS daemons running on all of the machines at the hotspot collectively manage the ".local." domain, which has meaning only at the hotspot (not across the broader Internet). Queries and responses for services on the local link occur via multicast DNS over UDP port 5353 instead of via normal DNS unicast over UDP port 53. When a new machine joins the local link, it can send out queries for any number of service types, to which the other machines will reply. For the purpose of serverless messaging we are interested only in the "presence" service, but many other services could exist on the local link (see <a href="http://www.dns-sd.org/">dns-sd.org</a> for a complete list).</p>
    <p>Now let us imagine that a fine young gentleman named Romeo joins the hotspot and that his chat client (actually his mDNS daemon) sends out multicast DNS queries for services of type "presence". To do this, his client essentially reverses the order of DNS record publication (explained above) by asking for pointers to presence services (i.e., PTR records that match "_presence._tcp.local."), querying each service for its service instance and port (i.e., SRV record), mapping each service instance to an IP address (i.e., A record), and finding out additional information about the entity using the service (i.e., TXT record parameters).  [<a href="#nt-idp1610768">9</a>] As a result, Romeo's client will discover any number of local presence services, among them a service named "juliet@pronto" (with some intriguing TXT record parameters) at IP address 10.2.1.187 and port 5562. Being a romantic fellow, he then initiates a chat with you by opening an XML stream to the advertised IP address and port.</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;stream:stream 
        xmlns='jabber:client' 
        xmlns:stream='http://etherx.jabber.org/streams'
        from='romeo@forza'
        to='juliet@pronto'
        version='1.0'&gt;
    </pre></div>
    <p>Your client then responds with a response stream header.</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;stream:stream 
        xmlns='jabber:client' 
        xmlns:stream='http://etherx.jabber.org/streams'
        from='juliet@pronto'
        to='romeo@forza'
        version='1.0'&gt;
    </pre></div>
    <p>Romeo then sends you an XMPP message.</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;message from='romeo@forza' to='juliet@pronto'&gt;
  &lt;body&gt;M'lady, I would be pleased to make your acquaintance.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p>And you reply.</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;message from='juliet@pronto' to='romeo@forza'&gt;
  &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p>You chat with Romeo for a while, then your client closes the stream.</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;/stream:stream&gt;
    </pre></div>
    <p>And Romeo's client does the same.</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;/stream:stream&gt;
    </pre></div>
    <p>Finally you decide to head home, so your mDNS daemon sends a Multicast DNS "Goodbye" packet for your PTR record. As a result, everyone else at the hotspot receives a Multicast DNS "Remove" event, at which point they cancel any outstanding A, SRV, TXT, or NULL record queries related to your presence service.</p>
  </div>
<h2>2.
       <a name="glossary" id="glossary">Glossary</a></h2>
  <div class="indent"><p class="caption"><a name="table-1" id="table-1"></a>Table 1: Terminology</p><table border="1" cellpadding="3" cellspacing="0">
    <tr class="body">
      <th>Term</th>
      <th>Description</th>
    </tr>
    <tr class="body">
      <td>Bonjour</td>
      <td>Apple Computer's implementation of zero-configuration networking, formerly known as Rendezvous. See &lt;<a href="http://www.apple.com/macosx/features/bonjour/">http://www.apple.com/macosx/features/bonjour/</a>&gt;.</td> 
    </tr>
    <tr class="body">
      <td>DNS-SD</td>
      <td>A convention for naming and structuring DNS SRV records such that a client can dynamically discover a domain for a service using only standard DNS queries. See <span class="ref">draft-cheshire-dnsext-dns-sd</span>. For a full list of registered DNS-SD records, see &lt;<a href="http://www.dns-sd.org/ServiceTypes.html">http://www.dns-sd.org/ServiceTypes.html</a>&gt;.</td> 
    </tr>
    <tr class="body">
      <td>Multicast DNS (mDNS)</td>
      <td>A technology that provides the ability to perform DNS-like operations on a local link in the absence of any conventional unicast DNS server. See <span class="ref">draft-cheshire-dnsext-multicastdns</span>.</td>
    </tr>
    <tr class="body">
      <td>Zero-configuration networking</td>
      <td>A set of technologies that enable the use of the Internet Protocol for local or wide-area communications. See &lt;<a href="http://www.zeroconf.org/">http://www.zeroconf.org/</a>&gt;.</td> 
    </tr>
  </table></div>
<h2>3.
       <a name="dns" id="dns">DNS Records</a></h2>
  <p>In order to advertise its availability for serverless messaging, a client MUST publish four different kinds of DNS records:</p>
  <ol>
    <li>
      <p>A PTR record of the following form:</p>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">
_presence._tcp.local. PTR user@machine._presence._tcp.local.
      </pre></div>
    </li>
    <li>
      <p>An address ("A" or "AAAA") record of the following form (where the IP address can be either an IPv4 address or an IPv6 address):</p>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">
machine.local. A ip-address
      </pre></div>
    </li>
    <li>
      <p>An SRV record of the following form:</p>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">
user@machine._presence._tcp.local &lt;ttl&gt; SRV &lt;priority&gt; &lt;weight&gt; port-number machine.local. 
      </pre></div>
    </li>
    <li>
      <p>A TXT record whose name is the same as the SRV record and whose value follows the format described in the <a href="#txt">TXT Record</a> section of this document, consisting of a set of strings that typically represent a series of key-value pairs such as the following:</p>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">
txtvers=1
1st=user-first-name
email=user-email-address
hash=entity-capabilities-algorithm
jid=user-jabber-id
last=user-last-name
msg=freeform-availability-status
n=entity-capabilities-application-name
nick=user-nickname
node=application-identifier
n=entity-capabilities-operating-system
phsh=sha1-hash-of-avatar
port.p2pj=5562
status=avail-away-or-dnd
vc=capabilities-string
ver=entity-capabilities-identity
      </pre></div>
      <p>Note: The DNS-SD specification stipulates that the TXT record MUST be published, but that it MAY contain no more than a single zero byte (e.g., if the user does not wish to publish any personal information).</p>
    </li>
  </ol>
  <p>The "machine" is the name of the computer, the "user" is the system username of the principal currently logged into the computer, the "port" can be any unassigned port number, and the "ip-address" is the physical address of the computer on the local network.</p>
  <p>So, for example, if the machine name is "pronto", the username is "juliet", the chosen port is "5562", the IP address is "10.2.1.187", and the personal information is that plausibly associated with a certain Shakespearean character, the DNS records would be as follows:</p>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
_presence._tcp.local. PTR juliet@pronto._presence._tcp.local.

juliet@pronto._presence._tcp.local. SRV 5562 pronto.local. 

pronto.local. A 10.2.1.187

juliet@pronto._presence._tcp.local. IN TXT 
  "txtvers=1"
  "1st=Juliet"
  "email=juliet@capulet.lit "
  "hash=sha-1"
  "jid=juliet@capulet.lit"
  "last=Capulet"
  "msg=Hanging out downtown"
  "nick=JuliC"
  "node=http://www.adiumx.com"
  "phsh=a3839614e1a382bcfebbcf20464f519e81770813"
  "port.p2pj=5562"
  "status=avail"
  "vc=CA!"
  "ver=QgayPKawpkPSDYmwT/WM94uAlu0=""
  </pre></div>
  <p>The IPv4 and IPv6 addresses associated with a machine might vary depending on the local network to which the machine is connected. For example, on an Ethernet connection the physical address might be "192.168.0.100" but when the machine is connected to a wireless network the physical address might change to "10.10.1.187". See <span class="ref">RFC 3927</span> for details.</p>
  <p>If the machine name asserted by a client is already taken by another machine on the network, the client MUST assert a different machine name, which SHOULD be formed by adding the character "-" and digit "1" to the end of the machine name string (e.g., "pronto-1"), adding the character "-" and digit "2" if the resulting machine name is already taken (e.g., "pronto-2"), and similarly incrementing the digit until a unique machine name is constructed.</p> 
  <p>If the username asserted by a client is already taken by another application on the machine, the client MUST assert a different username, which SHOULD be formed by adding the character "-" and digit "1" to the end of the username string (e.g., "juliet-1"), adding the character "-" and digit "2" if the resulting username is already taken (e.g., "juliet-2"), and similarly incrementing the digit until a unique username is constructed.</p> 
  <div class="indent"><h3>3.1 <a name="txt" id="txt">TXT Record</a></h3>
    <p>DNS-SD enables service definitions to include a TXT record that specifies parameters to be used in the context of the relevant service type. The name of the TXT record is the same as that of the SRV record (i.e., "user@machine._presence._tcp.local."). The value of the TXT record is one or more strings, where each string is a parameter that usually takes the form of a key-value pair.</p>
    <p>In the context of serverless messaging, the following rules apply:</p>
    <ol>
      <li>The entire TXT record needs to comply with the suggested maximum TXT record size (see Section 6.3 of the DNS-SD specification).</li>
      <li>A given key MUST NOT occur more than once in a given TXT record value (see Section 6.4 of the DNS-SD specification).</li>
      <li>The first parameter in the TXT record value SHOULD be "txtvers" (see Section 6.7 of the DNS-SD specification).</li>
    </ol>
    <p>The <span class="ref"><a href="http://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-idp1655744">10</a>] maintains a registry of the parameters that can be used in the TXT record value for the _presence._tcp service type, as specified in the <a href="#registrar">XMPP Registrar Considerations</a> section of this document. Those parameters are not listed here. It is OPTIONAL to include any of these TXT record parameters, and an implementation MUST NOT fail (i.e., MUST enable serverless messaging) even if none of the parameters are provided by another entity. However, as mentioned the TXT record MUST be published (although its value MAY be a single zero byte).</p>
    <p>Most of the registered TXT record parameters relate to human users, in which context certain parameters are of greater interest than others, e.g. "msg", "nick", and "status"; however, serverless messaging can be used by non-human entities (e.g., devices).</p>
    <p>Note: See the <a href="#security">Security Considerations</a> section of this document regarding the inclusion of information that can have an impact on personal privacy (e.g., the "1st", "last", "nick", "email", and "jid" parameters).</p>
  </div>
<h2>4.
       <a name="disco" id="disco">Discovering Other Users</a></h2>
  <p>In order to discover other users, a client sends an mDNS request for PTR records that match "_presence._tcp.local.". The client then receives replies from all machines that advertise support for serverless messaging.  [<a href="#nt-idp1659728">11</a>] In accordance with Section 13 of the DNS-SD specification, these replies can include the SRV, A/AAAA, and TXT records in the Additional Section of the DNS message (subject to the size limits described in Section 19 of the Multicast DNS specification).</p>
  <p>The client MAY then find out detailed information about each machine by sending SRV and TXT queries  [<a href="#nt-idp1660896">12</a>] to "user@machine.local." for each machine; however, to preserve bandwidth, the client SHOULD NOT send these queries unless it is about to initiate communication with the other user, and it MUST cancel the queries after it has received a response). 
  </p>
<h2>5.
       <a name="presence" id="presence">Exchanging Presence</a></h2>
  <p>When the _presence._tcp service is used, presence is exchanged via the format described in the <a href="#txt">TXT Record</a> section of this document. In particular, presence information is not pushed as in XMPP (see <span class="ref"><a href="http://tools.ietf.org/html/rfc3921">RFC 3921</a></span>  [<a href="#nt-idp1665648">13</a>]). Instead, clients listen for presence announcements from other entities on the local link or wide-area network. Recommended rates for sending updates can be found in the Multicast DNS specification.</p>
<h2>6.
       <a name="initiate" id="initiate">Initiating an XML Stream</a></h2>
  <p>In order to exchange serverless messages, the initiator and recipient MUST first establish XML streams between themselves, as is familiar from <span class="ref">RFC 6120</span>.</p>
  <p>First, the initiator opens a TCP connection at the IP address and port discovered via the DNS lookup for an entity and opens an XML stream to the recipient, which SHOULD include 'to' and 'from' address:</p>
  <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Initiator Opens a Stream</p><div class="indent"><pre class="prettyprint">
I: &lt;stream:stream 
           xmlns='jabber:client' 
           xmlns:stream='http://etherx.jabber.org/streams'
           from='romeo@forza'
           to='juliet@pronto'
           version='1.0'&gt;
  </pre></div>
  <p>Note: If the initiator supports stream features and the other stream-related aspects of XMPP 1.0 as specified in <span class="ref">RFC 6120</span>, then it SHOULD include the version='1.0' flag as shown in the previous example.</p>
  <p>The recipient then responds with a stream header as well:</p>
  <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Recipient Sends Stream Header Response</p><div class="indent"><pre class="prettyprint">
R: &lt;stream:stream 
           xmlns='jabber:client' 
           xmlns:stream='http://etherx.jabber.org/streams'
           from='juliet@pronto'
           to='romeo@forza'
           version='1.0'&gt;
  </pre></div>
  <p>If both the initiator and recipient included the version='1.0' flag, the recipient SHOULD also send stream features as specified in <span class="ref">RFC 6120</span>:</p>
  <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Recipient Sends Stream Features</p><div class="indent"><pre class="prettyprint">
R: &lt;stream:features&gt;
     &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'&gt;
       &lt;optional/&gt;
     &lt;/starttls&gt;
   &lt;/stream:features&gt;
  </pre></div>
  <p>The exchange of stream headers results in an unencrypted and unauthenticated channel between the two entities. See the <a href="#security">Security Considerations</a> section of this document regarding methods for authenticating and encrypting the stream.</p>
<h2>7.
       <a name="exchange" id="exchange">Exchanging Stanzas</a></h2>
  <p>Once the streams are established, either entity then can send XMPP message or IQ stanzas by specifying 'to' and 'from' addresses using the logical addresses:  [<a href="#nt-idp1675632">14</a>]</p>
  <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Sending a Message</p><div class="indent"><pre class="prettyprint">
&lt;message from='romeo@forza' to='juliet@pronto'&gt;
  &lt;body&gt;M'lady, I would be pleased to make your acquaintance.&lt;/body&gt;
&lt;/message&gt;
  </pre></div>
  <p class="caption"><a name="example-5" id="example-5"></a>Example 5. A Reply</p><div class="indent"><pre class="prettyprint">
&lt;message from='juliet@pronto' to='romeo@forza'&gt;
  &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
&lt;/message&gt;
  </pre></div>
<h2>8.
       <a name="end" id="end">Ending an XML Stream</a></h2>
  <p>To end the chat, either party closes the XML stream:</p>
  <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Ending the Chat</p><div class="indent"><pre class="prettyprint">
R: &lt;/stream:stream&gt;
  </pre></div>
  <p>The other party MUST then also close the stream in the other direction:</p>
  <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Closing the Stream</p><div class="indent"><pre class="prettyprint">
I: &lt;/stream:stream&gt;
  </pre></div>
  <p>The closing party (i.e., the party that sent the first closing stream tag) then MUST close the TCP connection between them.</p>
  <p>Note: The closing party might receive additional stanzas from the other party after sending its closing stream tag and before receiving a closing stream tag from the other party (e.g., because of network latency or because the other party has messages queued up for delivery when it receives the closing party's closing stream tag). Therefore, the closing party needs to be prepared to handle such messages, which it SHOULD do by presenting them to the controlling user (if any).</p>
<h2>9.
       <a name="offline" id="offline">Going Offline</a></h2>
  <p>In order to go offline, a link-local entity MUST send a Multicast DNS "Goodbye" packet for the user's PTR record as described in Section 11.2 of the Multicast DNS specification. As a result, all other entities on the local network will receive a Multicast DNS "Remove" event, at which point they MUST cancel any outstanding TXT, SRV, or NULL record queries for the offline user.</p>
<h2>10.
       <a name="caps" id="caps">Discovering Capabilities</a></h2>
  <p>Because serverless communication does not involve the exchange of XMPP presence, it is not possible to use <span class="ref"><a href="http://xmpp.org/extensions/xep-0115.html">Entity Capabilities (XEP-0115)</a></span>  [<a href="#nt-idp1687616">15</a>] for capabilities discovery. Therefore, it is RECOMMENDED to instead include the node, hash, and ver TXT record parameters (and OPTIONAL to include the ext parameter). The values of these parameters MUST be the same as the values for the 'node', 'hash', 'ver', and 'ext' attributes that are advertised for the application in normal XMPP presence (if any) via the Entity Capabilities protocol as described in <span class="ref">XEP-0115</span>.</p>
  <p>As with Entity Capabilities over native XMPP networks, a client might not know the <span class="ref"><a href="http://xmpp.org/extensions/xep-0030.html">Service Discovery (XEP-0030)</a></span>  [<a href="#nt-idp1690832">16</a>] features associated with the 'ver' value advertised by another entity. However, in the case of serverless messaging there is no way for the client to discover the entity's supported features without initiating an XML stream to that entity and then sending a Service Discovery information ("disco#info") request over the negotiated stream.</p>
  <p>Unfortunately, full stream negotiation (including TLS and SASL if appropriate) can require a large number of packets. Therefore, as an optimization, it is RECOMMENDED for the receiving entity in a serverless XML stream negotiation to include its disco#info data (including node) as a stream feature, as shown in the following examples.</p>
  <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Initiator Opens a Stream</p><div class="indent"><pre class="prettyprint">
I: &lt;stream:stream 
           xmlns='jabber:client' 
           xmlns:stream='http://etherx.jabber.org/streams'
           from='romeo@forza'
           to='juliet@pronto'
           version='1.0'&gt;
  </pre></div>
  <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Recipient Sends Stream Header Response</p><div class="indent"><pre class="prettyprint">
R: &lt;stream:stream 
           xmlns='jabber:client' 
           xmlns:stream='http://etherx.jabber.org/streams'
           from='juliet@pronto'
           to='romeo@forza'
           version='1.0'&gt;
  </pre></div>
  <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Recipient Sends Stream Features</p><div class="indent"><pre class="prettyprint">
R: &lt;stream:features&gt;
     &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'&gt;
       &lt;optional/&gt;
     &lt;/starttls&gt;
     &lt;query xmlns='http://jabber.org/protocol/disco#info'
            node='http://code.google.com/p/exodus#QgayPKawpkPSDYmwT/WM94uAlu0='&gt;
       &lt;identity category='client' name='Exodus 0.9.1' type='pc'/&gt;
       &lt;feature var='http://jabber.org/protocol/caps'/&gt;
       &lt;feature var='http://jabber.org/protocol/disco#info'/&gt;
       &lt;feature var='http://jabber.org/protocol/disco#items'/&gt;
       &lt;feature var='http://jabber.org/protocol/muc'/&gt;
     &lt;/query&gt;
   &lt;/stream:features&gt;
  </pre></div>
  <p>If the initiating entity was connecting to the receiving entity only to perform a Service Discovery query, it SHOULD then end the stream:</p>
  <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Initiating Entity Terminates XML Stream</p><div class="indent"><pre class="prettyprint">
I: &lt;/stream:stream&gt;
  </pre></div>
  <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Receiving Entity Mirrors Stream Termination</p><div class="indent"><pre class="prettyprint">
R: &lt;/stream:stream&gt;
  </pre></div>
<h2>11.
       <a name="impl" id="impl">Implementation Notes</a></h2>
  <div class="indent"><h3>11.1 <a name="impl-network" id="impl-network">Multiple Network Interfaces</a></h3>
    <p>Devices that use serverless messaging can have multiple network interfaces. As a result, it is possible to discover the same entity multiple times. Even if a client discovers the same presence name on multiple network interfaces, it MUST show only one entity in the serverless roster. In addition, because local IP addresses can be dynamically re-assigned, the client SHOULD NOT store the IP address to be used for communication when it discovers that address in the initial DNS lookup phase; instead, it SHOULD delay sending the Multicast DNS query until the client is ready to communicate with the other entity.</p>
  </div>
  <div class="indent"><h3>11.2 <a name="impl-icons" id="impl-icons">Buddy Icons</a></h3>
    <p>If an entity has an associated icon (e.g., a user avatar or photo), its client SHOULD publish the raw binary data for that image via a DNS NULL record of the following form:</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
_presence._tcp.local. IN NULL raw-binary-data-here
    </pre></div>
    <p>Note: In accordance with <span class="ref"><a href="http://tools.ietf.org/html/rfc1035">RFC 1035</a></span>  [<a href="#nt-idp1704176">17</a>], the data MUST be 65535 octets or less.</p>
    <p>After retrieving the "phsh" value from a Buddy's TXT record, a client SHOULD search its local picture database to learn the last recorded picture hash value for an entity and then compare it to the "phsh" value in the TXT record. If the values are equal, the client SHOULD use the local copy of the icon. If the picture hash values are not equal, the client SHOULD issue a Multicast DNS NULL record query to retrieve the new icon. After retrieving the NULL record, the client SHOULD replace the old "phsh" value in the picture database with the new "phsh" value and save the icon to disk. If the client needs to send a Multicast DNS query in order to retrieve the icon, it MUST cancel the NULL record query immediately after receiving a response containing the new picture data.</p>
    <p>If a user changes their picture, the user's client MUST update the NULL record with the contents of the new picture, calculate a new picture hash, and then update the "phsh" value in the TXT record with the new hash value. Since all users "logged into" serverless presence are monitoring for TXT record changes, they will see that the "phsh" value was changed; if they wish to view the new icon, their clients SHOULD issue a new Multicast DNS query to retrieve the updated picture.</p>
  </div>
  <div class="indent"><h3>11.3 <a name="impl-port" id="impl-port">Port</a></h3>
    <p>The port used for serverless messaging MAY be any unassigned port number, as determined by the messaging application on the device. The chosen port MUST be specified in the SRV record and applications MUST use the port specified in the SRV record. However, the chosen port SHOULD also be specifed in the "port.p2pj" TXT record for backwards-compatibility with older implementations, and if included the port specified in the TXT record MUST be the same as the port specified in the SRV record.</p>
  </div>
  <div class="indent"><h3>11.4 <a name="impl-wide" id="impl-wide">Wide-Area Networks</a></h3>
    <p>Serverless messaging via the _presence._tcp DNS SRV service type is not limited to local networks, since it is possible to advertise this service type via Wide-Area DNS-SD as described at &lt;<a href="http://www.dns-sd.org/iChatWideArea.html">http://www.dns-sd.org/iChatWideArea.html</a>&gt;. Although the protocol is most commonly used on local networks, there is nothing intrinsic to the protocol that limits its use to peers on the same link, and it also works between any two peers that can discover each other via any profile of DNS-SD (whether local or wide-area). Naturally, the DNS records used in Wide-Area DNS-SD will not contain the ".local." domain, since the records are not intended for use over a local link.</p>
  </div>
  <div class="indent"><h3>11.5 <a name="impl-ui" id="impl-ui">User Interface</a></h3>
    <p>The presence name to be used for display in a serverless "roster" SHOULD be obtained from the &lt;Instance&gt; portion of the received PTR record for each user; however, the client MAY instead display a name or nickname derived from the TXT record if available.</p>
    <p>A client MAY require user approval before allowing a human user to chat with other users over serverless messaging.</p>
  </div>
<h2>12.
       <a name="i18n" id="i18n">Internationalization Considerations</a></h2>
  <p><span class="ref">RFC 1035</span> does not allow characters outside the <span class="ref">US-ASCII</span>  [<a href="#nt-idp1716672">18</a>] character range in DNS A records. Therefore the "machine" portion of an A record as used for serverless messaging MUST NOT contain characters outside the US-ASCII character range.</p>
  <p>Although <span class="ref">RFC 2317</span> and <span class="ref">RFC 2782</span> do not allow characters outside the US-ASCII character range in PTR and SRV records respectively, Section 4.1 of <span class="ref">DNS-Based Service Discovery</span> recommends support for UTF-8-encoded Unicode characters in the &lt;Instance&gt; portion of Service Instance Names, which in serverless messaging is the "user@machine" portion of the PTR or SRV record. This document adheres to the recommendation in <span class="ref">DNS-Based Service Discovery</span>. However, as mentioned above, the "machine" portion of the &lt;Instance&gt; portion MUST NOT contain characters outside the US-ASCII range.</p>
  <p>Although <span class="ref">RFC 1464</span> does not allow characters outside the US-ASCII character range in TXT records, Section 6.5 of <span class="ref">DNS-Based Service Discovery</span> mentions support for UTF-8-encoded Unicode characters in text record values (e.g., values of the TXT "msg" name). This document adheres to the recommendation in <span class="ref">DNS-Based Service Discovery</span>.</p>
<h2>13.
       <a name="security" id="security">Security Considerations</a></h2>
  <div class="indent"><h3>13.1 <a name="security-auth" id="security-auth">Authentication and Encryption</a></h3>
    <p>XMPP networks use TLS (<span class="ref"><a href="http://tools.ietf.org/html/rfc5246">RFC 5246</a></span>  [<a href="#nt-idp1725136">19</a>]) for channel encryption, SASL (<span class="ref"><a href="http://tools.ietf.org/html/rfc4422">RFC 4422</a></span>  [<a href="#nt-idp1727728">20</a>]) for authentication, and the Domain Name System (<span class="ref"><a href="http://tools.ietf.org/html/rfc1034">RFC 1034</a></span>  [<a href="#nt-idp1730368">21</a>]) for weak validation of server hostnames; these technologies help to ensure the identity of sending entities and to encrypt XML streams. By contrast, zero-configuration networking uses dynamic discovery and asserted machine names as the basis of sender identity. Therefore, serverless messaging does not result in authenticated identities in the same way that XMPP itself does, nor does it provide for an encrypted channel between entities.</p>
    <p>To secure communications between serverless entities, it is RECOMMENDED to negotiate the use of TLS and SASL for the XML stream as described in <span class="ref">RFC 6120</span>. However, subject to client configuration and local service policies, an entity MAY accept an unauthenticated and unencrypted channel, in which case the client SHOULD warn the human user that the channel is unauthenticated and unencrypted.</p>
  </div>
  <div class="indent"><h3>13.2 <a name="security-inject" id="security-inject">Stanza Injection</a></h3>
    <p>Because of fundamental differences between a true XMPP network and a serverless client "mesh", entities communicating via serverless messaging MUST NOT attempt to inject serverless traffic onto an XMPP network and an XMPP server MUST reject communications until an entity is properly authenticated in accordance with the rules defined in <span class="ref">RFC 6120</span>. However, a client on a serverless mesh MAY forward traffic to an XMPP network after having properly authenticated on such a network (e.g., to forward a message received on a serverless client mesh to a contact on an XMPP network).</p>
  </div>
  <div class="indent"><h3>13.3 <a name="security-txt" id="security-txt">TXT Record Parameters</a></h3>
    <p>Because there is no mechanism for validating the information that is published in DNS TXT records, it is possible for clients to "poison" this information (e.g., by publishing email addresses or Jabber IDs that are controlled by or associated with other users).</p>
  </div>
  <div class="indent"><h3>13.4 <a name="security-priv" id="security-priv">Private Information</a></h3>
    <p>The TXT record parameters optionally advertised as part of this protocol MAY result in exposure of privacy-sensitive information about a human user (such as full name, email address, and Jabber ID). A client MUST allow a user to disable publication of this personal information (e.g., via client configuration).</p>
  </div>
<h2>14.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p>DNS-SD service type names are not yet managed by the <span class="ref"><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-idp1740416">22</a>]. Section 19 of <span class="ref">DNS-Based Service Discovery</span> proposes an IANA allocation policy for unique application protocol or service type names. Until the proposal is adopted and in force, Section 19 points to &lt;<a href="http://www.dns-sd.org/ServiceTypes.html">http://www.dns-sd.org/ServiceTypes.html</a>&gt; regarding registration of service type names for DNS-SD.</p>
  <p>Before this specification was written, there was an existing registration for the "presence" service type, with registration information as follows:</p>
  <div class="indent">
    <ol>
      <li>Short name: presence</li>
      <li>Long name: iChat AV</li>
      <li>Responsible person: Jens Alfke &lt;jens at apple.com&gt;</li>
      <li>Defined TXT keys: txtvers, port.p2pj, phsh, vc, 1st, AIM, msg, status, last</li>
    </ol>
  </div>
  <p>On 2007-05-14, the XMPP Registrar submitted the following proposed modification to the existing registration, which was accepted on 2007-05-30:</p>
  <div class="indent">
    <ol>
      <li>Short name: presence</li>
      <li>Long name: Link-Local Messaging</li>
      <li>Responsible person: XMPP Registrar &lt;registrar at xmpp.org&gt;</li>
      <li>Protocol URL: http://www.xmpp.org/extensions/xep-0174.html</li>
      <li>Primary transport protocol: _tcp</li>
      <li>TXT record URL: http://www.xmpp.org/registrar/linklocal.html</li>
    </ol>
  </div>
<h2>15.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
  <div class="indent"><h3>15.1 <a name="registrar-linklocal" id="registrar-linklocal">Link-Local Messaging TXT Record Parameters Registry</a></h3>
    <p>The <span class="ref"><a href="http://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-idp1752048">23</a>] maintains a registry of parameter strings contained in the TXT record advertised for serverless messaging (see &lt;<a href="http://xmpp.org/registrar/linklocal.html">http://xmpp.org/registrar/linklocal.html</a>&gt;).</p>
    <div class="indent"><h3>15.1.1 <a name="registrar-linklocal-process" id="registrar-linklocal-process">Registration Process</a></h3>
      <p>In order to submit new values to this registry, the registrant shall define an XML fragment of the following form and either include it in the relevant XMPP Extension Protocol or send it to the email address &lt;registrar@xmpp.org&gt;:</p>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;param&gt;
  &lt;name&gt;The name of the parameter as used a key-value pair.&lt;/name&gt;
  &lt;desc&gt;A natural-language description of the parameter.&lt;/desc&gt;
  &lt;status&gt;
    The requirements status of the record. Should be one of: 
      - required
      - recommended 
      - optional
      - deprecated
      - obsolete
 &lt;/status&gt;
&lt;/param&gt;
      </pre></div>
      <p>The registrant can register more than one parameter at a time, each contained in a separate &lt;record/&gt; element.</p>
    </div>
    <div class="indent"><h3>15.1.2 <a name="registrar-linklocal-reg" id="registrar-linklocal-reg">Initial Registration</a></h3>
      <p>The following submission registers parameters in use as of June 2007. Refer to the registry itself for a complete and current list of parameters (this specification might or might not be revised when new parameters are registered).</p>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">

&lt;param&gt;
  &lt;name&gt;1st&lt;/name&gt;
  &lt;desc&gt;The given or first name of the user.&lt;/desc&gt;
  &lt;status&gt;optional&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;email&lt;/name&gt;
  &lt;desc&gt;
    The email address of the user; can contain a space-separated list 
    of more than one email address.
  &lt;/desc&gt;
  &lt;status&gt;optional&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;ext&lt;/name&gt;
  &lt;desc&gt;
    A space-separated list of extensions; the value of this record MUST 
    be the same as that provided via normal XMPP presence (if applicable) 
    in the 'ext' attribute specified in Entity Capabilities (XEP-0115).
  &lt;/desc&gt;
  &lt;status&gt;optional&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;hash&lt;/name&gt;
  &lt;desc&gt;
    The hashing algorithm used to generated the 'ver' attribute in 
    Entity Capabilities (XEP-0115) and therefore the ver parameter
    in Link-Local Messaging.
  &lt;/desc&gt;
  &lt;status&gt;recommended&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;jid&lt;/name&gt;
  &lt;desc&gt;
    The Jabber ID of the user; can contain a space-separated list of 
    more than one JID.
  &lt;/desc&gt;
  &lt;status&gt;recommended&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;last&lt;/name&gt;
  &lt;desc&gt;The family or last name of the user.&lt;/desc&gt;
  &lt;status&gt;optional&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;msg&lt;/name&gt;
  &lt;desc&gt;
    Natural-language text describing the user's state. This is 
    equivalent to the XMPP &amp;lt;status/&amp;gt;; element.
  &lt;/desc&gt;
  &lt;status&gt;optional&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;nick&lt;/name&gt;
  &lt;desc&gt;A friendly or informal name for the user.&lt;/desc&gt;
  &lt;status&gt;recommended&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;node&lt;/name&gt;
  &lt;desc&gt;
    A unique identifier for the application; the value of this record MUST 
    be the same as that provided via normal XMPP presence (if applicable) 
    in the 'node' attribute specified in Entity Capabilities (XEP-0115).
  &lt;/desc&gt;
  &lt;status&gt;recommended&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;phsh&lt;/name&gt;
  &lt;desc&gt;
    The SHA-1 hash of the user's avatar icon or photo. This SHOULD be 
    requested using mDNS in unicast mode by sending a DNS query to the 
    mDNS multicast address (224.0.0.251 or its IPv6 equivalent FF02::FB).
    The client SHOULD keep a local cache of icons keyed by hash. If the 
    phsh value is not in the cache, the client SHOULD fetch the unknown 
    icon and then cache it. Implementations SHOULD also include logic for 
    expiring avatar icons.
  &lt;/desc&gt;
  &lt;status&gt;optional&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;port.p2pj&lt;/name&gt;
  &lt;desc&gt;
    The port for serverless communication. This MUST be the same as the
    value provided for SRV lookups. Clients MUST use the port discovered 
    via SRV lookups and MUST ignore the value of this parameter. However, 
    clients SHOULD advertise this parameter if it is important to ensure
    backwards-compatibility with some existing implementations. (Note: In
    some existing implementations this value was hardcoded to "5298".)
  &lt;/desc&gt;
  &lt;status&gt;deprecated&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;status&lt;/name&gt;
  &lt;desc&gt;
    The presence availability of the user. Allowable values are "avail", 
    "away", and "dnd", which map to mere XMPP presence (the user is 
    available) and the XMPP &amp;lt;show/&amp;gt; values of "away" and "dnd", 
    respectively; if the status record is not included, the status SHOULD 
    be assumed to be "avail".
  &lt;/desc&gt;
  &lt;status&gt;recommended&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;txtvers&lt;/name&gt;
  &lt;desc&gt;
    The version of the TXT record supported by the client. For backwards 
    compatibility this is hardcoded at "1". This parameter SHOULD be the
    first one provided, in accordance with the DNS-SD specification.
  &lt;/desc&gt;
  &lt;status&gt;deprecated&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;vc&lt;/name&gt;
  &lt;desc&gt;
    A flag advertising the user's ability to engage in audio or video 
    conferencing. If the user is able to engage in audio conferencing, 
    the string MUST include the "A" character. If the user is able to 
    engage in video conferencing, the string MUST include the "V" 
    character. If the user is able to engage in conferencing with more 
    than one participant, the string MUST include the "C" character. If 
    the user is not currently engaged in an audio or video conference, 
    the string MUST include the "!" character. The order of characters 
    in the string is immaterial. NOTE: This flag is included only for
    backwards-compatibility; implementations SHOULD use the node, ver, 
    and ext parameters for more robust capabilities discovery as described 
    in the Discovering Capabilities section of XEP-0174.
  &lt;/desc&gt;
  &lt;status&gt;optional&lt;/status&gt;
&lt;/param&gt;

&lt;param&gt;
  &lt;name&gt;ver&lt;/name&gt;
  &lt;desc&gt;
    A hashed string that defines the XMPP service discovery (XEP-0030) 
    identity of the application and the XMPP service discovery features 
    supported by the application; the value of this record MUST be the 
    same as that provided via normal XMPP presence (if applicable) in 
    the 'ver' attribute specified in Entity Capabilities (XEP-0115).
  &lt;/desc&gt;
  &lt;status&gt;recommended&lt;/status&gt;
&lt;/param&gt;

      </pre></div>
    </div>
  </div>
<h2>16.
       <a name="ack" id="ack">Acknowledgements</a></h2>
  <p>Thanks to Emanuele Aina, Jens Alfke, Marco Barisione, Stuart Cheshire, Justin Karneges, Marc Krochmal, Eric St. Onge, and Sjoerd Simons for their input. Some of the explanatory concepts were loosely borrowed from <span class="ref"><a href="http://tools.ietf.org/html/draft-lee-sip-dns-sd-uri">SIP URI Service Discovery using DNS-SD</a></span>  [<a href="#nt-idp1761184">24</a>].</p>
<hr /><a name="appendices" id="appendices"></a><h2>Appendices</h2><hr /><a name="appendix-docinfo" id="appendix-docinfo"></a><h3>Appendix A: Document Information</h3><p class="indent">
            Series: <a href="http://xmpp.org/extensions/">XEP</a><br />
            Number: 0174<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://xmpp.org/extensions/xep-0001.html#states-Final">Final</a><br />
            Type:
            <a href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 2.0<br />
            Last Updated: 2008-11-26<br />
                Approving Body: <a href="http://xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XMPP IM, RFC 3927, RFC 6762, RFC 6763<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: linklocal<br />
              Registry: 
              
              &lt;<a href="http://xmpp.org/registrar/linklocal.html">http://xmpp.org/registrar/linklocal.html</a>&gt;
              <br />
              Source Control: 
                <a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0174.xml">HTML</a><br />
            This document in other formats: 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0174.xml">XML</a> 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0174.pdf">PDF</a></p><hr /><a name="appendix-authorinfo" id="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3><div class="indent"><h3>Peter Saint-Andre</h3><p class="indent">
        Email:
        <a href="mailto:peter@andyet.net">peter@andyet.net</a><br />
        JabberID: 
        <a href="xmpp:stpeter@stpeter.im">stpeter@stpeter.im</a><br />
        URI: 
        <a href="https://stpeter.im/">https://stpeter.im/</a><br /></p></div><hr /><a name="appendix-legal" id="appendix-legal"></a><h3>Appendix C: Legal Notices</h3><div class="indent"><h4>Copyright</h4>This XMPP Extension Protocol is copyright © 1999 - 2014 by the <a href="http://xmpp.org/">XMPP Standards Foundation</a> (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="http://xmpp.org/about-xmpp/xsf/xsf-ipr-policy/">http://xmpp.org/about-xmpp/xsf/xsf-ipr-policy/</a>&gt; or obtained by writing to XMPP Standards Foundation, 1899 Wynkoop Street, Suite 600, Denver, CO 80202 USA).</div><hr /><a name="appendix-xmpp" id="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><hr /><a name="appendix-discuss" id="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Given that this XMPP Extension Protocol normatively references IETF technologies, discussion on the &lt;<a href="http://mail.jabber.org/mailman/listinfo/xsf-ietf">xsf-ietf@xmpp.org</a>&gt; list might also be appropriate.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><hr /><a name="appendix-conformance" id="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><a name="appendix-notes" id="appendix-notes"></a><h3>Appendix G: Notes</h3><div class="indent"><p><a name="nt-idp1583664" id="nt-idp1583664">1</a>. RFC 6120: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc6120">http://tools.ietf.org/html/rfc6120</a>&gt;.</p><p><a name="nt-idp1591136" id="nt-idp1591136">2</a>. RFC 3927: Dynamic Configuration of IPv4 Link-Local Addresses &lt;<a href="http://tools.ietf.org/html/rfc3927">http://tools.ietf.org/html/rfc3927</a>&gt;.</p><p><a name="nt-idp1594720" id="nt-idp1594720">3</a>. RFC 6763: DNS-Based Service Discovery &lt;<a href="http://tools.ietf.org/html/rfc6763">http://tools.ietf.org/html/rfc6763</a>&gt;.</p><p><a name="nt-idp1596704" id="nt-idp1596704">4</a>. RFC 6762: Multicast DNS &lt;<a href="http://tools.ietf.org/html/rfc6762">http://tools.ietf.org/html/rfc6762</a>&gt;.</p><p><a name="nt-idp1600352" id="nt-idp1600352">5</a>. RFC 2782: A DNS RR for specifying the location of services (DNS SRV) &lt;<a href="http://tools.ietf.org/html/rfc2782">http://tools.ietf.org/html/rfc2782</a>&gt;.</p><p><a name="nt-idp1602624" id="nt-idp1602624">6</a>. RFC 2317: Classless IN-ADDR.ARPA delegation &lt;<a href="http://tools.ietf.org/html/rfc2317">http://tools.ietf.org/html/rfc2317</a>&gt;.</p><p><a name="nt-idp1604608" id="nt-idp1604608">7</a>. RFC 1886: DNS Extensions to support IP version 6 &lt;<a href="http://tools.ietf.org/html/rfc1886">http://tools.ietf.org/html/rfc1886</a>&gt;.</p><p><a name="nt-idp1607360" id="nt-idp1607360">8</a>. RFC 1464: Using the Domain Name System To Store Arbitrary String Attributes &lt;<a href="http://tools.ietf.org/html/rfc1464">http://tools.ietf.org/html/rfc1464</a>&gt;.</p><p><a name="nt-idp1610768" id="nt-idp1610768">9</a>. As explained in the DNS-SD specification, these queries might all be returned in the same answer.</p><p><a name="nt-idp1655744" id="nt-idp1655744">10</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://xmpp.org/registrar/">http://xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-idp1659728" id="nt-idp1659728">11</a>. The replies will include a record corresponding to the client itself; the client MUST filter out this result.</p><p><a name="nt-idp1660896" id="nt-idp1660896">12</a>. These questions MAY all be sent in one DNS query packet.</p><p><a name="nt-idp1665648" id="nt-idp1665648">13</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc3921">http://tools.ietf.org/html/rfc3921</a>&gt;.</p><p><a name="nt-idp1675632" id="nt-idp1675632">14</a>. The to and from addresses MUST be of the form "user@machine" as discovered via SRV (this is the &lt;Instance&gt; portion of the Service Instance Name).</p><p><a name="nt-idp1687616" id="nt-idp1687616">15</a>. XEP-0115: Entity Capabilities &lt;<a href="http://xmpp.org/extensions/xep-0115.html">http://xmpp.org/extensions/xep-0115.html</a>&gt;.</p><p><a name="nt-idp1690832" id="nt-idp1690832">16</a>. XEP-0030: Service Discovery &lt;<a href="http://xmpp.org/extensions/xep-0030.html">http://xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-idp1704176" id="nt-idp1704176">17</a>. RFC 1035: Domain Names - Implementation and Specification &lt;<a href="http://tools.ietf.org/html/rfc1035">http://tools.ietf.org/html/rfc1035</a>&gt;.</p><p><a name="nt-idp1716672" id="nt-idp1716672">18</a>. Coded Character Set - 7-bit American Standard Code for Information Interchange (American National Standards Institute X3.4, 1986).</p><p><a name="nt-idp1725136" id="nt-idp1725136">19</a>. RFC 5246: The Transport Layer Security (TLS) Protocol Version 1.2 &lt;<a href="http://tools.ietf.org/html/rfc5246">http://tools.ietf.org/html/rfc5246</a>&gt;.</p><p><a name="nt-idp1727728" id="nt-idp1727728">20</a>. RFC 4422: Simple Authentication and Security Layer (SASL) &lt;<a href="http://tools.ietf.org/html/rfc4422">http://tools.ietf.org/html/rfc4422</a>&gt;.</p><p><a name="nt-idp1730368" id="nt-idp1730368">21</a>. RFC 1034: Domain Names - Concepts and Facilities &lt;<a href="http://tools.ietf.org/html/rfc1034">http://tools.ietf.org/html/rfc1034</a>&gt;.</p><p><a name="nt-idp1740416" id="nt-idp1740416">22</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-idp1752048" id="nt-idp1752048">23</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://xmpp.org/registrar/">http://xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-idp1761184" id="nt-idp1761184">24</a>. SIP URI Service Discovery using DNS-SD &lt;<a href="http://tools.ietf.org/html/draft-lee-sip-dns-sd-uri">http://tools.ietf.org/html/draft-lee-sip-dns-sd-uri</a>&gt;. Work in progress.</p></div><hr /><a name="appendix-revs" id="appendix-revs"></a><h3>Appendix H: Revision History</h3><p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p><div class="indent"><h4>Version 2.0 (2008-11-26)</h4><div class="indent"><p>Per a vote of the XMPP Council, advanced specification to Final; corrected TXT record format in conformance with draft-cheshire-dnsext-dns-sd; clarified a number of issues related to DNS-SD and Multicast DNS; as an optimization, recommended sending of disco#info data in stream features; removed reference to Encrypted Sessions specification from the security considerations.</p> (psa)
    </div><h4>Version 1.2 (2008-09-03)</h4><div class="indent"><p>Clarified handling of stream closes.</p> (psa)
    </div><h4>Version 1.1 (2008-03-05)</h4><div class="indent"><p>Clarified order of publishing and querying DNS records; corrected several DNS errors in the text and examples; added friendly How It Works section; added implementation note about port choice; updated TXT records to reflect version 1.5 of XEP-0115; updated registry; generalized text to handle usage of wide-area DNS-SD.</p> (psa)
    </div><h4>Version 1.0 (2007-06-12)</h4><div class="indent"><p>Per a vote of the XMPP Council, advanced status to Draft; XMPP Registrar assigned linklocal shortname and created appropriate registry.</p> (psa)
    </div><h4>Version 0.16 (2007-05-30)</h4><div class="indent"><p>Updated the definition of port.p2pj TXT record so that it is not hardcoded to 5298 but instead tracks the port advertised via SRV; updated the IANA considerations to reflect acceptance of the proposed registration change by the maintainers of the http://www.dns-sd.org/ServiceTypes.html website.</p> (psa)
    </div><h4>Version 0.15 (2007-05-14)</h4><div class="indent"><p>Updated IANA Considerations to reflect proposed modifications to DNS-SD registration.</p> (psa)
    </div><h4>Version 0.14 (2007-05-11)</h4><div class="indent"><p>Specified that email and jid TXT values can contain a space-separated list of addresses; clarified roster display rules; clarified rules for handling presence name collisions; added security consideration about lack of validation for TXT record data.</p> (psa)
    </div><h4>Version 0.13 (2007-03-28)</h4><div class="indent"><p>Clarified handling of stream version.</p> (psa)
    </div><h4>Version 0.12 (2007-03-26)</h4><div class="indent"><p>Specified creation of registry for TXT records and hardcoded txtvers record value at 1.</p> (psa)
    </div><h4>Version 0.11 (2007-03-14)</h4><div class="indent"><p>Added section on capabilities discovery; added TXT records corresponding to the node, ver, and ext attributes from XEP-0115; changed textvers value to 2.</p> (psa)
    </div><h4>Version 0.10 (2007-03-13)</h4><div class="indent"><p>Added nick TXT key; added note about use of AAAA records with IPv6; specified that from and to addresses are recommended for stream headers; encouraged implementations to send XMPP stream features.</p> (psa)
    </div><h4>Version 0.9 (2006-12-22)</h4><div class="indent"><p>Updated the security considerations to recommend either TLS+SASL at the stream layer or encrypted sessions at the messaging layer.</p> (psa)
    </div><h4>Version 0.8 (2006-07-31)</h4><div class="indent"><p>Recommended use of TLS and SASL for stream security.</p> (psa)
    </div><h4>Version 0.7 (2006-06-06)</h4><div class="indent"><p>Further clarified internationalization considerations.</p> (psa)
    </div><h4>Version 0.6 (2006-06-05)</h4><div class="indent"><p>Clarified internationalization considerations and use of mDNS in unicast mode for avatar retrieval.</p> (psa)
    </div><h4>Version 0.5 (2006-04-14)</h4><div class="indent"><p>Specified presence name conflict resolution procedure, offline procedure, use of DNS NULL record for icons, and handling of multiple network interfaces.</p> (psa)
    </div><h4>Version 0.4 (2006-03-16)</h4><div class="indent"><p>Corrected PTR format and client discovery process.</p> (psa)
    </div><h4>Version 0.3 (2006-02-23)</h4><div class="indent"><p>Added more details about DNS setup and stream initiation; specified internationalization considerations.</p> (psa)
    </div><h4>Version 0.2 (2006-02-22)</h4><div class="indent"><p>Corrected information about Service Instance Name format, p2pj port, and presence discovery process.</p> (psa)
    </div><h4>Version 0.1 (2006-02-09)</h4><div class="indent"><p>Initial version; changed title to Link-Local Messaging.</p> (psa)
    </div><h4>Version 0.0.1 (2006-02-07)</h4><div class="indent"><p>First draft.</p> (psa)
    </div></div><hr /><p>END</p></body></html>
